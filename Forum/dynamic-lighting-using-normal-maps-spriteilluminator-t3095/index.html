<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>Moai Forum &bull; View topic - Dynamic lighting using normal maps / SpriteIlluminator</title>

<link rel="alternate" type="application/atom+xml" title="Feed - Moai Forum" href="../feed.php.html" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="../feed.php%3Fmode=forums.html" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="../feed.php%3Fmode=topics.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="../feed.php%3Fmode=topics_active.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Game Development" href="../feed.php%3Ff=16.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - Dynamic lighting using normal maps / SpriteIlluminator" href="http://192.168.20.226:3000/forums/feed.php?f=16&amp;t=3095" />

<!--
	phpBB style name: proFormell
	Based on style:   prosilver (this is the default phpBB3 style)
	Inspired by:	  Formell (Joomla Style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  	  Marc Alexander
	
	NOTE: This page was generated by phpBB, the free open-source bulletin board package.
	      The phpBB Group is not responsible for the content of this page and forum. For more information
	      about phpBB please visit http://www.phpbb.com
-->

<script type="text/javascript">
// <![CDATA[
	var jump_page = 'Enter the page number you wish to go to:';
	var on_page = '1';
	var per_page = '';
	var base_url = '';
	var style_cookie = 'phpBBstyle';
	var style_cookie_settings = '; path=/';
	var onload_functions = new Array();
	var onunload_functions = new Array();
	var is_ie6 = false;

	/**
	* Find a member
	*/
	function find_username(url)
	{
		popup(url, 760, 570, '_usersearch');
		return false;
	}

	/**
	* New function for handling multiple calls to window.onload and window.unload by pentapenguin
	*/
	window.onload = function()
	{
		for (var i = 0; i < onload_functions.length; i++)
		{
			eval(onload_functions[i]);
		}
	}

	window.onunload = function()
	{
		for (var i = 0; i < onunload_functions.length; i++)
		{
			eval(onunload_functions[i]);
		}
	}

// ]]>
</script>
<!--[if lt IE 7]>
<script type="text/javascript">
// <![CDATA[
var is_ie6 = true;
// ]]>
</script>
<![endif]-->


<link href="../styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />

<link href="../style.css" rel="stylesheet" type="text/css" media="screen, projection" />



<link href="../styles/proFormell/theme/images/favicon.ico" rel="shortcut icon" />

<script type="text/javascript" src="../styles/prosilver/template/forum_fn.js"></script>
<script src="../styles/prosilver/template/jquery-1.4.4.min.js" type="text/javascript"></script>

<script type="text/javascript">
// <![CDATA[
/**
* New pop-up functions
* based on  http://yensdesign.com/2008/09/how-to-create-a-stunning-and-smooth-popup-using-jquery/
*/

//SETTING UP OUR POPUP
//0 means disabled; 1 means enabled;
var popupStatus = 0;
var openPopup = '';

//loading popup with jQuery magic!
function loadPopup()
{
	//loads popup only if it is disabled
	if(popupStatus==0)
	{
		$('#backgroundPopup').css({'opacity': '0.7'});
		// Now let's make sure we actually see the image
		var scroll = $(window).scrollTop();
		$('#popupPM').animate({marginTop: scroll}, 'fast', function() {
			// Animation complete.
			});
		$('#backgroundPopup').fadeIn('slow');
		$('#popupPM').fadeIn('slow');
		popupStatus = 1;
		openPopup = 'PM';
	}
}

//disabling popup with jQuery magic!
function disablePopup()
{
	//disables popup only if it is enabled
	if(popupStatus==1 && openPopup == 'PM')
	{
		$('#backgroundPopup').fadeOut('slow');
		$('#popupPM').fadeOut('slow');
		popupStatus = 0;
		openPopup = '';
	}
}

//centering popup
function centerPopup()
{
	//request data for centering
	var windowWidth = document.documentElement.clientWidth;
	var windowHeight = document.documentElement.clientHeight;
	var popupHeight = $('#popupPM').height();
	var popupWidth = $('#popupPM').width();
	//centering
	$('#popupPM').css({
	'position': 'absolute',
	'top': windowHeight/2-popupHeight/2,
	'left': windowWidth/2-popupWidth/2
	});
	//only need force for IE6
	$('#backgroundPopup').css({'height': windowHeight});
}

$(document).ready(function(){
	
	resize_images();
	
	
	// IE6 and below PNG fix (not really)
	if(is_ie6)
	{
		replace_png();
	}
	
	//CLOSING POPUP
	//Click the x event!
	$('#popupPMClose').click(function(){
		disablePopup();
	});
	//Click out event!
	$('#backgroundPopup').click(function(){
		disablePopup();
		disableImage();
	});
	//Press Escape event!
	$(document).keypress(function(e){
		if(e.keyCode==27 && popupStatus==1)
		{
			disablePopup();
			disableImage();
		}
	});
	
	
	// Image popup
	$('img', 'dt.attach-image').click(function(){
		image_load($(this).attr('src'), $(this).attr('alt'));
		centerImage();
	});
	
	$('.content img').click(function(){
		var check = $(this).parent().hasClass('content');
		if(check)
		{
			image_load($(this).attr('src'), $(this).attr('alt'));
			centerImage();
		}
	});
	
	// Closing Image popup
	//Click the x event!
	$('#popupImageClose').click(function(){
		disableImage();
	});
	
	//Click image box event
	$('#popupImage').click(function(){
		disableImage();
	});
	
	//Click image event
	$('#ImagePopup img').click(function(){
		disableImage();
	});
	

});

/**
* Replaces weird looking PNG files with the respectie GIF file
* Only run this if the browser is IE6 or below
*/
function replace_png()
{
	// Fix Logo
	var str = $('#logo img').attr('src'); 
	$('#logo img').attr('src', str.substring(0, str.length - 3) + 'gif');
	
	// Fix forum icons
	$('dl.icon').each(function() {
		var str = $(this).css('background-image');
		if(str != '')
		{
			$(this).css('background-image', str.substring(0, str.length - 5) + 'gif")');
		}
	});
}


/**
* Image resizer
*/
function resize_images()
{
	var hello = $('dl.attachbox dd dl.file dt.attach-image img').innerWidth();
	var maxWidth = $('div.content').innerWidth() - 30;
	
	// resize the attached images
	$('img', 'dt.attach-image').each(function(i){
		// check the width of the image
		if ($(this).width() > maxWidth)
		{
			// calculate new image dimensions
			newWidth = maxWidth;
			newHeight = $(this).height() / ( $(this).width() / maxWidth );
			   
			// set new image dimensions
			$(this).height(newHeight).width(newWidth);
		}
	});
	
	// resize the images that were added via [img] bbcode
	$('img', 'div.content').each(function(i){
		// check the width of the image
		$(this).css('max-width', maxWidth); // fix for IE
		if ($(this).width() > maxWidth)
		{
			// calculate new image dimensions
			newWidth = maxWidth;
			newHeight = $(this).height() / ( $(this).width() / maxWidth );
			   
			// set new image dimensions
			$(this).height(newHeight).width(newWidth);
		}
	});
}

/**
* Image pop-up
*/
function image_load(src, alt)
{
	//loads popup only if it is disabled
	if(popupStatus==0)
	{
		$('#ImagePopup').html('<img id="imgpopup" src="http://192.168.20.226:3000/forums/dynamic-lighting-using-normal-maps-spriteilluminator-t3095/'&#32;+&#32;src&#32;+&#32;'" alt="' + alt + '" />');
		var windowWidth = document.documentElement.clientWidth;
		var windowHeight = document.documentElement.clientHeight;
		var maxWidth = windowWidth * 0.85;
		var maxHeight = windowHeight * 0.85;
		$('#popupImage img').css('max-width', maxWidth);
		$('#popupImage img').css('max-height', maxHeight);
		$('#backgroundPopup').css({'opacity': '0.7'});
		// Now let's make sure we actually see the image
		var scroll = $(window).scrollTop();
		$('#popupImage').animate({marginTop: scroll}, 'fast', function() {
			// Animation complete.
			});
		$('#backgroundPopup').fadeIn('slow');
		$('#popupImage').fadeIn('slow');
		popupStatus = 1;
		openPopup = 'Image';
	}
}

//centering popup
function centerImage()
{
	//request data for centering
	var windowWidth = document.documentElement.clientWidth;
	var windowHeight = document.documentElement.clientHeight;
	var popupHeight = $('#popupImage').height();
	var popupWidth = $('#popupImage').width();
	var newTop = windowHeight/2-popupHeight/2;
	var newLeft = windowWidth/2-popupWidth/2;
	//centering
	$('#popupImage').css({
	'position': 'absolute',
	'top': newTop,
	'left': newLeft
	});
	
	//only need force for IE6
	$('#backgroundPopup').css({'height': windowHeight});
}

//disabling popup with jQuery magic!
function disableImage()
{
	//disables popup only if it is enabled
	if(popupStatus==1 && openPopup == 'Image')
	{
		$('#backgroundPopup').fadeOut('slow');
		$('#popupImage').fadeOut('slow');
		popupStatus = 0;
		openPopup = '';
	}
}


// ]]>
</script>

</head>

<body id="phpbb" class="section-viewtopic ltr">
<!--- box border START -->
<div id="box">

<div class="top-left"></div><div class="top-center"></div><div class="top-right"></div>
<div id="left-border">
<div id="right-border">


<!--- box border END -->
<div class="inside">
 <div class="notopgap">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar">
			<div class="inner"><!-- <span class="corners-top"><span></span></span> -->
			<div style="height: 140px ;">
			<div id="site-description">
				<div class="header-pad"><a href="index.html" title="" id="logo"><img src="../styles/proFormell/imageset/site-logo.png" width="410" height="98" alt="" title="" /></a></div>
			
		<!--		<p class="site-desc">The mobile platform for pro game developers</p> -->
				<p class="skiplink"><a href="index.html#start_here">Skip to content</a></p>
			</div>

		
			<div id="search-box">
				<form action="../search.php.html" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="text" maxlength="128" title="Search for keywords" class="inputbox search" value="Search…" onclick="if(this.value=='Search…')this.value='';" onblur="if(this.value=='')this.value='Search…';" /> 
					<input class="button2" value="Search" type="submit" /><br />
					<a href="../search.php.html" title="View the advanced search options">Advanced search</a> <input type="hidden" name="sid" value="de2d556bf3f0e66038a4cf0bca137a95" />

				</fieldset>
				</form>
			</div>
		
    </div>

			<span class="corners-bottom"><span></span></span></div>
		</div>

		<div class="navbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<ul class="linklist navlinks">
				<li class="icon-home"><a href="../index.html" accesskey="h">Board index</a>  <strong>&#8249;</strong> <a href="../additional-f14.html">Additional</a> <strong>&#8249;</strong> <a href="../game-development-f16.html">Game Development</a></li>

				<li class="rightside"><a href="index.html#" onclick="fontsizeup(); return false;" onkeypress="return fontsizeup(event);" class="fontsize" title="Change font size">Change font size</a></li>

				<li class="rightside"><a href="http://192.168.20.226:3000/forums/viewtopic.php?f=16&amp;t=3095&amp;start=0&amp;view=print&amp;sid=de2d556bf3f0e66038a4cf0bca137a95" title="Print view" accesskey="p" class="print">Print view</a></li>
			</ul>

			

			<ul class="linklist rightside">
				<li class="icon-faq"><a href="http://192.168.20.226:3000/forums/faq.php?sid=de2d556bf3f0e66038a4cf0bca137a95" title="Frequently Asked Questions">FAQ</a></li>
				
				<li class="icon-register"><a href="http://192.168.20.226:3000/forums/ucp.php?mode=register&amp;sid=de2d556bf3f0e66038a4cf0bca137a95">Register</a></li>
					<li class="icon-logout"><a href="http://192.168.20.226:3000/forums/ucp.php?mode=login&amp;sid=de2d556bf3f0e66038a4cf0bca137a95" title="Login" accesskey="x">Login</a></li>
				
			</ul>

			<span class="corners-bottom"><span></span></span></div>
		</div>
	</div>

	<a name="start_here"></a>
	<div id="page-body">
		
<h2><a href="index.html">Dynamic lighting using normal maps / SpriteIlluminator</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body --><div style="display: none !important;">General discussion of game creation, including ai, shaders, and other topics.<br /></div>
	<p>
		
			<strong>Moderators:</strong> <a href="../member1551.html" style="color: #AA0000;" class="username-coloured">naturally</a>, <a href="../member1202.html" style="color: #AA0000;" class="username-coloured">ezraanderson</a>
		

	</p>


<div class="topic-actions">

	<div class="buttons">
	
		<div class="reply-icon"><a href="http://192.168.20.226:3000/forums/posting.php?mode=reply&amp;f=16&amp;t=3095&amp;sid=de2d556bf3f0e66038a4cf0bca137a95" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="search-box">
			<form method="get" id="topic-search" action="../search.php.html">
			<fieldset>
				<input class="inputbox search tiny"  type="text" name="keywords" id="search_keywords" size="20" value="Search this topic…" onclick="if(this.value=='Search this topic…')this.value='';" onblur="if(this.value=='')this.value='Search this topic…';" />
				<input class="button2" type="submit" value="Search" />
				<input type="hidden" name="t" value="3095" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="de2d556bf3f0e66038a4cf0bca137a95" />

			</fieldset>
			</form>
		</div>
	
		<div class="pagination">
			13 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	

</div>
<div class="clear"></div>


	<div id="p16998" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 class="first"><a href="index.html#p16998">Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post16998.html#p16998"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Fri Mar 27, 2015 2:24 am </p>

			

			<div class="content">I've been using a lot of third party graphical plugins and tools for enhancing Moai's capabilities and efficiency, like Spriter/Spine, TexturePacker etc. and the other day I got a mail from them about SpriteIlluminator for dynamic lighting using normal maps:<br /><br /><!-- m --><a class="postlink" href="https://www.codeandweb.com/spriteilluminator">https://www.codeandweb.com/spriteilluminator</a><!-- m --><br /><br />It has integrations for Unity, Cocos2D, libgdx and many other major engines. I was wondering if there is a Moai plugin for this or any plans for one, or if there is some capability within the engine to do realistic 2D lighting like this easily.</div>

			

		</div>

		
			<dl class="postprofile" id="profile16998">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17004" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17004">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17004.html#p17004"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1427.html">Vavius</a></strong> &raquo; Fri Mar 27, 2015 9:36 am </p>

			

			<div class="content">This is just a custom multitexture shader, nothing more. Couple of lines of lua code.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17004">
			<dt>
				<a href="../member1427.html">Vavius</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 264</dd><dd><strong>Joined:</strong> Mon Apr 29, 2013 6:04 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17005" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17005">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17005.html#p17005"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Sat Mar 28, 2015 1:20 am </p>

			

			<div class="content">Thanks for pointing in the right direction Vavius, guess I'm a noob at shaders so I didn't know it was something that simple. I'll look into and play around with some of the shader code posted around and see if I make some headaway.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17005">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17006" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17006">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17006.html#p17006"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1556.html">Motig</a></strong> &raquo; Sat Mar 28, 2015 7:23 am </p>

			

			<div class="content">Would be cool to see what you come up with and how you did it!</div>

			

		</div>

		
			<dl class="postprofile" id="profile17006">
			<dt>
				<a href="../member1556.html">Motig</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 92</dd><dd><strong>Joined:</strong> Thu Sep 05, 2013 7:55 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17010" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17010">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17010.html#p17010"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member2101.html">Bartho</a></strong> &raquo; Sun Mar 29, 2015 10:11 am </p>

			

			<div class="content">Wow, this SpriteIlluminator looks cool! I used TexturePacker in my current project and it is fine. Out of subject maybe but did anyone tried PhysicsEditor? Is it better than RUBE?</div>

			

		</div>

		
			<dl class="postprofile" id="profile17010">
			<dt>
				<a href="../member2101.html"><img src="../download/file.php%253favatar%253d2101_1421666274.jpg" width="120" height="120" alt="User avatar" /></a><br />
				<a href="../member2101.html">Bartho</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 60</dd><dd><strong>Joined:</strong> Mon Jan 19, 2015 4:13 am</dd><dd><strong>Location:</strong> France</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17011" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17011">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17011.html#p17011"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1427.html">Vavius</a></strong> &raquo; Sun Mar 29, 2015 10:53 am </p>

			

			<div class="content"><blockquote><div><cite>Bartho wrote:</cite>Out of subject maybe but did anyone tried PhysicsEditor? Is it better than RUBE?</div></blockquote><br />PhysicsEditor is just a shape/fixture editor, while RUBE is a full featured world editor.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17011">
			<dt>
				<a href="../member1427.html">Vavius</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 264</dd><dd><strong>Joined:</strong> Mon Apr 29, 2013 6:04 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17014" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17014">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17014.html#p17014"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member990.html">monkan</a></strong> &raquo; Sun Mar 29, 2015 1:07 pm </p>

			

			<div class="content">I thought this SpriteIlluminator thing looked pretty cool so I thought I'd have a look, I wanted to have a little play around with shaders anyway as it's something I've never really done much. I still find it all a bit confusing. Here's what I got.<br /><br />main.lua<br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">MOAISim<span style="color: #66cc66;">.</span>openWindow <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">&quot;test&quot;</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">800</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">600</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">viewport <span style="color: #66cc66;">=</span> MOAIViewport<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">viewport<span style="color: #66cc66;">:</span>setSize <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">800</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">600</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">viewport<span style="color: #66cc66;">:</span>setScale <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">800</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">600</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">layer <span style="color: #66cc66;">=</span> MOAILayer2D<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">layer<span style="color: #66cc66;">:</span>setViewport <span style="color: #66cc66;">&#40;</span> viewport <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">MOAISim<span style="color: #66cc66;">.</span>pushRenderPass <span style="color: #66cc66;">&#40;</span> layer <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">file <span style="color: #66cc66;">=</span> <span style="color: #0000aa;">assert</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #0000aa;">io.open</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">'shader.vsh'</span><span style="color: #66cc66;">,</span> mode <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">vsh <span style="color: #66cc66;">=</span> file<span style="color: #66cc66;">:</span><span style="color: #0000aa;">read</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">'*all'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">file<span style="color: #66cc66;">:</span>close <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">file <span style="color: #66cc66;">=</span> <span style="color: #0000aa;">assert</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #0000aa;">io.open</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">'shader.fsh'</span><span style="color: #66cc66;">,</span> mode <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">fsh <span style="color: #66cc66;">=</span> file<span style="color: #66cc66;">:</span><span style="color: #0000aa;">read</span> <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">'*all'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">file<span style="color: #66cc66;">:</span>close <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader <span style="color: #66cc66;">=</span> MOAIShader<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>reserveUniforms <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">11</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniformSampler<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'diffuseMap'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniformSampler<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'normalMap'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">2</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'worldMatrix'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_WORLD <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'viewProjMatrix'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_VIEW_PROJ <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'worldViewProjMatrix'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_WORLD_VIEW_PROJ <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">6</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightX'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">7</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightY'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">8</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightZ'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">9</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourR'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">10</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourG'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourB'</span><span style="color: #66cc66;">,</span> MOAIShader<span style="color: #66cc66;">.</span>UNIFORM_FLOAT <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #808080; font-style: italic;">-- Light position</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">lightZ <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">0.05</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">7</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">,</span> lightZ<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #808080; font-style: italic;">-- Light colour</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">9</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>seekAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">9</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">5.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>seekAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">5.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>seekAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">5.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'position'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'uv'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'colour'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> vsh<span style="color: #66cc66;">,</span> fsh <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">multitexture <span style="color: #66cc66;">=</span> MOAIMultiTexture<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">multitexture<span style="color: #66cc66;">:</span>reserve <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">diffuse <span style="color: #66cc66;">=</span> MOAITexture<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">diffuse<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">&quot;image.png&quot;</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">multitexture<span style="color: #66cc66;">:</span>setTexture <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> diffuse <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">normal <span style="color: #66cc66;">=</span> MOAITexture<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">normal<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> <span style="color: #ff6666;">&quot;image_n.png&quot;</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">multitexture<span style="color: #66cc66;">:</span>setTexture <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> normal <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">gfxQuad <span style="color: #66cc66;">=</span> MOAIGfxQuad2D<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">gfxQuad<span style="color: #66cc66;">:</span>setTexture <span style="color: #66cc66;">&#40;</span> multitexture <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">gfxQuad<span style="color: #66cc66;">:</span>setRect <span style="color: #66cc66;">&#40;</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">128</span><span style="color: #66cc66;">,</span> <span style="color: #66cc66;">-</span><span style="color: #cc66cc;">128</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">128</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">128</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">gfxQuad<span style="color: #66cc66;">:</span>setUVRect <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">prop <span style="color: #66cc66;">=</span> MOAIProp2D<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">prop<span style="color: #66cc66;">:</span>setDeck <span style="color: #66cc66;">&#40;</span> gfxQuad <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">prop<span style="color: #66cc66;">:</span>setShader <span style="color: #66cc66;">&#40;</span> shader <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">prop<span style="color: #66cc66;">:</span>moveRot <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">360</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">50.0</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">layer<span style="color: #66cc66;">:</span>insertProp <span style="color: #66cc66;">&#40;</span> prop <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">prop<span style="color: #66cc66;">:</span>setLoc<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">function</span> onPointerEvent<span style="color: #66cc66;">&#40;</span>x<span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; x<span style="color: #66cc66;">,</span> y <span style="color: #66cc66;">=</span> layer<span style="color: #66cc66;">:</span>wndToWorld<span style="color: #66cc66;">&#40;</span>x<span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">,</span> x<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">7</span><span style="color: #66cc66;">,</span> y<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">MOAIInputMgr<span style="color: #66cc66;">.</span>device<span style="color: #66cc66;">.</span>pointer<span style="color: #66cc66;">:</span>setCallback<span style="color: #66cc66;">&#40;</span>onPointerEvent<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">function</span> onKeyboardEvent<span style="color: #66cc66;">&#40;</span> key<span style="color: #66cc66;">,</span> down <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> keyChar <span style="color: #66cc66;">=</span> <span style="color: #0000aa;">string.char</span><span style="color: #66cc66;">&#40;</span>key<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">if</span> down <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">if</span> keyChar <span style="color: #66cc66;">==</span> <span style="color: #ff6666;">&quot;w&quot;</span> <span style="color: #aa9900; font-weight: bold;">or</span> keyChar <span style="color: #66cc66;">==</span> <span style="color: #ff6666;">&quot;W&quot;</span> <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lightZ <span style="color: #66cc66;">=</span> lightZ <span style="color: #66cc66;">-</span> <span style="color: #cc66cc;">0.01</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">elseif</span> keyChar <span style="color: #66cc66;">==</span> <span style="color: #ff6666;">&quot;s&quot;</span> <span style="color: #aa9900; font-weight: bold;">or</span> keyChar <span style="color: #66cc66;">==</span> <span style="color: #ff6666;">&quot;S&quot;</span> <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lightZ <span style="color: #66cc66;">=</span> lightZ <span style="color: #66cc66;">+</span> <span style="color: #cc66cc;">0.01</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000aa;">print</span><span style="color: #66cc66;">&#40;</span><span style="color: #ff6666;">'Light Z'</span><span style="color: #66cc66;">,</span> lightZ<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shader<span style="color: #66cc66;">:</span>setAttr<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">8</span><span style="color: #66cc66;">,</span> lightZ<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">MOAIInputMgr<span style="color: #66cc66;">.</span>device<span style="color: #66cc66;">.</span>keyboard<span style="color: #66cc66;">:</span>setCallback<span style="color: #66cc66;">&#40;</span> onKeyboardEvent <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />shader.fsh<br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="glsl" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> MEDP <span style="color: #000066; font-weight: bold;">vec2</span> uvVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> MEDP <span style="color: #000066; font-weight: bold;">vec4</span> positionVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> MEDP <span style="color: #000066; font-weight: bold;">vec4</span> colourVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">sampler2D</span> diffuseMap<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">sampler2D</span> normalMap<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightColourR<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightColourG<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightColourB<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> worldMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">// Sum of all MOAITransforms on object</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> viewProjMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span style="color: #666666; font-style: italic;">// Projection matrix (camera)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> worldViewProjMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">// Projection matrix (camera)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightX<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightY<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> MEDP <span style="color: #000066; font-weight: bold;">float</span> lightZ<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform vec3 ambientColor;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">vec3</span> ambientColor <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec3</span><span style="color: #000066;">&#40;</span><span style="color: #0000ff;">1.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform float ambientIntensity;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">float</span> ambientIntensity <span style="color: #000066;">=</span> <span style="color: #0000ff;">0.05</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform vec2 resolution;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">vec2</span> resolution <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec2</span><span style="color: #000066;">&#40;</span><span style="color: #0000ff;">1.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform bool useNormals;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">bool</span> useNormals <span style="color: #000066;">=</span> <span style="color: #333399; font-weight: bold;">true</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform bool useShadow;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">bool</span> useShadow <span style="color: #000066;">=</span> <span style="color: #333399; font-weight: bold;">true</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">//uniform vec3 attenuation;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">vec3</span> attenuation <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec3</span><span style="color: #000066;">&#40;</span><span style="color: #0000ff;">1.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">void</span> main<span style="color: #000066;">&#40;</span><span style="color: #000066;">&#41;</span> </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec4</span> light <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec4</span><span style="color: #000066;">&#40;</span>lightX<span style="color: #000066;">,</span> lightY<span style="color: #000066;">,</span> lightZ<span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span> <span style="color: #000066;">*</span> viewProjMatrix<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> lightColour <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec3</span><span style="color: #000066;">&#40;</span>lightColourR<span style="color: #000066;">,</span> lightColourG<span style="color: #000066;">,</span> lightColourB<span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//sample color &amp; normals from our textures</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec4</span> color <span style="color: #000066;">=</span> <span style="color: #993333; font-weight: bold;">texture2D</span><span style="color: #000066;">&#40;</span>diffuseMap<span style="color: #000066;">,</span> uvVarying<span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> nColor <span style="color: #000066;">=</span> <span style="color: #993333; font-weight: bold;">texture2D</span><span style="color: #000066;">&#40;</span>normalMap<span style="color: #000066;">,</span> uvVarying<span style="color: #000066;">&#41;</span><span style="color: #000066;">.</span><span style="color: #006600;">rgb</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//normals need to be converted to [-1.0, 1.0] range and normalized</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> normal <span style="color: #000066;">=</span> <span style="color: #993333; font-weight: bold;">normalize</span><span style="color: #000066;">&#40;</span>nColor <span style="color: #000066;">*</span> <span style="color: #0000ff;">2.0</span> <span style="color: #000066;">-</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//here we do a simple distance calculation</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> deltaPos <span style="color: #000066;">=</span> <span style="color: #000066; font-weight: bold;">vec3</span><span style="color: #000066;">&#40;</span> <span style="color: #000066;">&#40;</span>light<span style="color: #000066;">.</span><span style="color: #006600;">xy</span> <span style="color: #000066;">-</span> positionVarying<span style="color: #000066;">.</span><span style="color: #006600;">xy</span><span style="color: #000066;">&#41;</span> <span style="color: #000066;">/</span> resolution<span style="color: #000066;">.</span><span style="color: #006600;">xy</span><span style="color: #000066;">,</span> light<span style="color: #000066;">.</span><span style="color: #006600;">z</span> <span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> lightDir <span style="color: #000066;">=</span> <span style="color: #993333; font-weight: bold;">normalize</span><span style="color: #000066;">&#40;</span>deltaPos<span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">float</span> lambert <span style="color: #000066;">=</span> useNormals <span style="color: #000066;">?</span> <span style="color: #993333; font-weight: bold;">clamp</span><span style="color: #000066;">&#40;</span><span style="color: #993333; font-weight: bold;">dot</span><span style="color: #000066;">&#40;</span>normal<span style="color: #000066;">,</span> lightDir<span style="color: #000066;">&#41;</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">0.0</span><span style="color: #000066;">,</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">&#41;</span> <span style="color: #000066;">:</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//now let's get a nice little falloff</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">float</span> d <span style="color: #000066;">=</span> <span style="color: #993333; font-weight: bold;">sqrt</span><span style="color: #000066;">&#40;</span><span style="color: #993333; font-weight: bold;">dot</span><span style="color: #000066;">&#40;</span>deltaPos<span style="color: #000066;">,</span> deltaPos<span style="color: #000066;">&#41;</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">float</span> att <span style="color: #000066;">=</span> useShadow <span style="color: #000066;">?</span> <span style="color: #0000ff;">1.0</span> <span style="color: #000066;">/</span> <span style="color: #000066;">&#40;</span> attenuation<span style="color: #000066;">.</span><span style="color: #006600;">x</span> <span style="color: #000066;">+</span> <span style="color: #000066;">&#40;</span>attenuation<span style="color: #000066;">.</span><span style="color: #006600;">y</span><span style="color: #000066;">*</span>d<span style="color: #000066;">&#41;</span> <span style="color: #000066;">+</span> <span style="color: #000066;">&#40;</span>attenuation<span style="color: #000066;">.</span><span style="color: #006600;">z</span><span style="color: #000066;">*</span>d<span style="color: #000066;">*</span>d<span style="color: #000066;">&#41;</span> <span style="color: #000066;">&#41;</span> <span style="color: #000066;">:</span> <span style="color: #0000ff;">1.0</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066; font-weight: bold;">vec3</span> result <span style="color: #000066;">=</span> <span style="color: #000066;">&#40;</span>ambientColor <span style="color: #000066;">*</span> ambientIntensity<span style="color: #000066;">&#41;</span> <span style="color: #000066;">+</span> <span style="color: #000066;">&#40;</span>lightColour<span style="color: #000066;">.</span><span style="color: #006600;">rgb</span> <span style="color: #000066;">*</span> lambert<span style="color: #000066;">&#41;</span> <span style="color: #000066;">*</span> att<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; result <span style="color: #000066;">*=</span> color<span style="color: #000066;">.</span><span style="color: #006600;">rgb</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #551111;">gl_FragColor</span> <span style="color: #000066;">=</span> colourVarying <span style="color: #000066;">*</span> <span style="color: #000066; font-weight: bold;">vec4</span><span style="color: #000066;">&#40;</span>result<span style="color: #000066;">,</span> color<span style="color: #000066;">.</span><span style="color: #006600;">a</span><span style="color: #000066;">&#41;</span><span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />shader.vsh<br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="glsl" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">attribute</span> <span style="color: #000066; font-weight: bold;">vec4</span> position<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">attribute</span> <span style="color: #000066; font-weight: bold;">vec2</span> uv<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">attribute</span> <span style="color: #000066; font-weight: bold;">vec4</span> colour<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> <span style="color: #000066; font-weight: bold;">vec4</span> colourVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> <span style="color: #000066; font-weight: bold;">vec2</span> uvVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">varying</span> <span style="color: #000066; font-weight: bold;">vec3</span> positionVarying<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> worldMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">// Sum of all MOAITransforms on object</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> viewProjMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span style="color: #666666; font-style: italic;">// Projection matrix (camera)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #333399; font-weight: bold;">uniform</span> <span style="color: #000066; font-weight: bold;">mat4</span> worldViewProjMatrix<span style="color: #000066;">;</span> &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">// Projection matrix (camera)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066; font-weight: bold;">void</span> main <span style="color: #000066;">&#40;</span><span style="color: #000066;">&#41;</span> <span style="color: #000066;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; uvVarying <span style="color: #000066;">=</span> uv<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; colourVarying <span style="color: #000066;">=</span> colour<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; positionVarying <span style="color: #000066;">=</span> position<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #551111;">gl_Position</span> <span style="color: #000066;">=</span> position<span style="color: #000066;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000066;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />I got the shader code from here - <a href="http://www.java-gaming.org/index.php?topic=27516.0" class="postlink">http://www.java-gaming.org/index.php?topic=27516.0</a><br /><br />The light seems to work and looks pretty cool. SpriteIlluminator looks like a pretty cool program.<br /><br />Does anyone know if there is a way / how to use MOAIMultitextures with SpriteSheets? Currently I'm using TexturePacker to make a sprite sheet and loading it into a MOAIGfxQuadDeck2D. Is there a way to use both methods?<br /><br />Cheers.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17014">
			<dt>
				<a href="../member990.html">monkan</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 76</dd><dd><strong>Joined:</strong> Sat Jul 14, 2012 1:05 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17018" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17018">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17018.html#p17018"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1427.html">Vavius</a></strong> &raquo; Sun Mar 29, 2015 11:02 pm </p>

			

			<div class="content"><blockquote><div><cite>monkan wrote:</cite>Does anyone know if there is a way / how to use MOAIMultitextures with SpriteSheets? Currently I'm using TexturePacker to make a sprite sheet and loading it into a MOAIGfxQuadDeck2D. Is there a way to use both methods?</div></blockquote><br />If all your textures have identical layout (all sprites on all textures have the same uv), then you can use MOAIGfxQuadDeck2D. <br /><br />In more complex Multitexture scenarios you may want to have different uv sets. This means non-default vertex format. I've used a custom TexturePacker loader that writes positions and uv into vertex attributes for MOAIMesh.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17018">
			<dt>
				<a href="../member1427.html">Vavius</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 264</dd><dd><strong>Joined:</strong> Mon Apr 29, 2013 6:04 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17051" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17051">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17051.html#p17051"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member967.html">RurouniGPL</a></strong> &raquo; Thu Apr 02, 2015 3:56 am </p>

			

			<div class="content">AwesomeBump is Open Source and maybe it can be used to create normal maps:<br /><br /><!-- m --><a class="postlink" href="http://awesomebump.besaba.com/gallery/">http://awesomebump.besaba.com/gallery/</a><!-- m --><br /><br />But I think &quot;Unflattener&quot; is easier and more similar to SpriteIlluminator, also Open Source:<br /><br /><!-- m --><a class="postlink" href="https://github.com/dbohdan/unflattener/">https://github.com/dbohdan/unflattener/</a><!-- m --></div>

			

		</div>

		
			<dl class="postprofile" id="profile17051">
			<dt>
				<a href="../member967.html">RurouniGPL</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 238</dd><dd><strong>Joined:</strong> Wed Jun 27, 2012 11:54 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17118" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17118">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17118.html#p17118"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Sat Apr 18, 2015 1:37 am </p>

			

			<div class="content">Wow I hadn't checked this thread but instead asked nosheet for help with the calculations in the meantime and made an alternate one. Thanks for the shader code monkan, will try it out as well.<br /><br />The one I got is very similar, a simple point + ambient lighting 2D shader, but without any normal or bump maps yet. Here are the results with it:<br /><br /><img src="http://i.imgur.com/0aEpEqj.jpg" alt="Image" /><br /><br />Apparently it's a lot like the lighting system used by Broken Age. Here's the final shader function if anyone else is interested. It's adapted to plug and play directly for props and quads rather than meshes, so it works nicely out of the box with frameworks like RapaNui and Hanappe:<br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">function</span> point_lighting_shader<span style="color: #66cc66;">&#40;</span>lightx<span style="color: #66cc66;">,</span> lighty<span style="color: #66cc66;">,</span> lightz<span style="color: #66cc66;">,</span> intensity<span style="color: #66cc66;">,</span> range<span style="color: #66cc66;">,</span> red<span style="color: #66cc66;">,</span> green<span style="color: #66cc66;">,</span> blue<span style="color: #66cc66;">,</span> am_red<span style="color: #66cc66;">,</span> am_green<span style="color: #66cc66;">,</span> am_blue<span style="color: #66cc66;">&#41;</span> &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> vsh <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">&#91;</span> &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; attribute vec4 v_pos<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; attribute vec2 v_uv<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; attribute vec4 v_col<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> Note<span style="color: #66cc66;">:</span> NO NORMALS!</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> UNIFORMS</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> X<span style="color: #66cc66;">,</span> Y <span style="color: #aa9900; font-weight: bold;">and</span> Z position of the point light<span style="color: #66cc66;">.</span> </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform float light_x<span style="color: #66cc66;">,</span> light_y<span style="color: #66cc66;">,</span> light_z<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> Light range is a distance at which the light intensity will decay to zero<span style="color: #66cc66;">.</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform float light_intensity<span style="color: #66cc66;">,</span> light_range<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> Point light color</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform float light_red<span style="color: #66cc66;">,</span> light_green<span style="color: #66cc66;">,</span> light_blue<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> Ambient light color</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform float ambient_red<span style="color: #66cc66;">,</span> ambient_green<span style="color: #66cc66;">,</span> ambient_blue<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> VARYINGS</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying vec4 frag_color<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying vec2 frag_uv<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; void main <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>vec4 vertex_position <span style="color: #66cc66;">=</span> v_pos</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Find the distance between the vertex <span style="color: #aa9900; font-weight: bold;">and</span> the light source</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; float vertex_dist <span style="color: #66cc66;">=</span> length <span style="color: #66cc66;">&#40;</span>vec3<span style="color: #66cc66;">&#40;</span> light_x<span style="color: #66cc66;">,</span> light_y<span style="color: #66cc66;">,</span> light_z <span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">-</span> vec3<span style="color: #66cc66;">&#40;</span> v_pos<span style="color: #66cc66;">.</span>x<span style="color: #66cc66;">,</span> v_pos<span style="color: #66cc66;">.</span>y<span style="color: #66cc66;">,</span> v_pos<span style="color: #66cc66;">.</span>z <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Decay light factor depending on the vertex distance from light source</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; float decay <span style="color: #66cc66;">=</span> <span style="color: #0000aa;">max</span><span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">,</span> <span style="color: #66cc66;">&#40;</span>light_range <span style="color: #66cc66;">-</span> vertex_dist <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">/</span> light_range <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Color of the point light</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; vec4 light_color <span style="color: #66cc66;">=</span> vec4<span style="color: #66cc66;">&#40;</span> light_red<span style="color: #66cc66;">,</span> light_green<span style="color: #66cc66;">,</span> light_blue<span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span> <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Color of the ambient light</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; vec4 ambient_color <span style="color: #66cc66;">=</span> vec4<span style="color: #66cc66;">&#40;</span> ambient_red<span style="color: #66cc66;">,</span> ambient_green<span style="color: #66cc66;">,</span> ambient_blue<span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span> <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; frag_color <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">&#40;</span>v_col <span style="color: #66cc66;">*</span> light_color <span style="color: #66cc66;">*</span> light_intensity <span style="color: #66cc66;">*</span> decay<span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">+</span> ambient_color<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Alpha channel</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; frag_color<span style="color: #66cc66;">.</span>w <span style="color: #66cc66;">=</span> v_col<span style="color: #66cc66;">.</span>w<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Output UV</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; frag_uv <span style="color: #66cc66;">=</span> v_uv<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Multiply vertex position with projection matrix to get its on<span style="color: #66cc66;">-</span>screen position<span style="color: #66cc66;">.</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; gl_Position <span style="color: #66cc66;">=</span> v_pos<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #66cc66;">&#93;</span><span style="color: #66cc66;">&#93;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> fsh <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">&#91;</span> </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> UNIFORMS</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform sampler2D map_diffuse<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">//</span> VARYINGS</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying LOWP vec4 frag_color<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec2 frag_uv<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; void main<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; gl_FragColor <span style="color: #66cc66;">=</span> frag_color <span style="color: #66cc66;">*</span> <span style="color: #66cc66;">&#40;</span> texture2D<span style="color: #66cc66;">&#40;</span> map_diffuse<span style="color: #66cc66;">,</span> frag_uv <span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #66cc66;">&#93;</span><span style="color: #66cc66;">&#93;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> shader <span style="color: #66cc66;">=</span> MOAIShader<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>reserveUniforms <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">11</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_x'</span><span style="color: #66cc66;">,</span> lightx <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_y'</span><span style="color: #66cc66;">,</span> lighty <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_z'</span><span style="color: #66cc66;">,</span> lightz <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_intensity'</span><span style="color: #66cc66;">,</span> intensity <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_range'</span><span style="color: #66cc66;">,</span> range <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">6</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_red'</span><span style="color: #66cc66;">,</span> red <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">7</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_green'</span><span style="color: #66cc66;">,</span> green <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">8</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_blue'</span><span style="color: #66cc66;">,</span> blue <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">9</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambient_red'</span><span style="color: #66cc66;">,</span> am_red <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">10</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambient_green'</span><span style="color: #66cc66;">,</span> am_green <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambient_blue'</span><span style="color: #66cc66;">,</span> am_blue <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>setVertexAttribute<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'v_pos'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>setVertexAttribute<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'v_uv'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>setVertexAttribute<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'v_col'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; shader<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> vsh<span style="color: #66cc66;">,</span> fsh <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">return</span> shader</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />Since it's wrapped in a function, it's just a simple couple of lines in your main lua code instead of having to set attributes every time. <br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">shader <span style="color: #66cc66;">=</span> point_lighting_shader<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">0.48</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.17</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.5</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.5</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.77</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.80</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.001</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.19</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.50</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">myProp<span style="color: #66cc66;">:</span>setShader<span style="color: #66cc66;">&#40;</span>shader<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />I might try to work in Monkan's normal map bit as well.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17118">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17120" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17120">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17120.html#p17120"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1556.html">Motig</a></strong> &raquo; Sat Apr 18, 2015 5:08 am </p>

			

			<div class="content">Looking good! Thanks for sharing the code, that'll be helpful I'm sure!</div>

			

		</div>

		
			<dl class="postprofile" id="profile17120">
			<dt>
				<a href="../member1556.html">Motig</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 92</dd><dd><strong>Joined:</strong> Thu Sep 05, 2013 7:55 am</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17312" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17312">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17312.html#p17312"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Sun Jun 14, 2015 5:03 am </p>

			

			<div class="content">I switched to the normal maps shader with SpriteIlluminator posted  here after some tweaks, and it definitely looks a lot better and more realistic with the folds and texturing compared to the vanilla lighting shader I had. <br /><br />The only problem is that this shader seems to flip around whenever I flip the sprite around by multiplying the x-scale by -1. This is not desired behavior, as it then looks like the light is suddenly coming from the opposite direction whenever the player changes direction. This was not the case in the vanilla lighting shader, which seems to flip the character without flipping around the shader. Is it because the old one was doing the calculations in the vertex shader and the normal maps one is doing them in the fragment shader? Both the codes are posted here, anyone have any ideas? <br /><br />Just to make it clear, here's what I mean with the flipping (please ignore the rough normal map, intend to fine tune later):<br /><br />Correct directional lighting here<br /><img src="http://i.imgur.com/8rWj2NU.jpg" alt="Image" /><br />Flipped around and the light source seems to flip with it:<br /><img src="http://i.imgur.com/I5gR9gm.jpg" alt="Image" /><br /><br />But not happening with old shader<br /><img src="http://i.imgur.com/r29zAYG.jpg" alt="Image" /><br /><img src="http://i.imgur.com/RlDKhWs.jpg" alt="Image" /></div>

			

		</div>

		
			<dl class="postprofile" id="profile17312">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17742" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17742">Re: Dynamic lighting using normal maps / SpriteIlluminator</a></h3>
			<p class="author"><a href="../post17742.html#p17742"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member2211.html">andreiS</a></strong> &raquo; Mon Oct 26, 2015 3:30 pm </p>

			

			<div class="content">Hi, i'm a total noob when it comes to shaders, I've just had the first encounter with them actually. I also got the shader code from here: <!-- m --><a class="postlink" href="http://www.java-gaming.org/index.php?topic=27516.0">http://www.java-gaming.org/index.php?topic=27516.0</a><!-- m --> but i don't know how to add more textures/sprites and more light sources, I can only use one texture at a time. Can anyone help me?</div>

			

		</div>

		
			<dl class="postprofile" id="profile17742">
			<dt>
				<a href="../member2211.html">andreiS</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 1</dd><dd><strong>Joined:</strong> Mon Oct 26, 2015 3:25 pm</dd>

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<form id="viewtopic" method="post" action="index.html">

	<fieldset class="display-options" style="margin-top: 0; ">
		
		<label>Display posts from previous: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
		<label>Sort by <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label> <label><select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select> <input type="submit" name="sort" value="Go" class="button2" /></label>
		
	</fieldset>

	</form>
	<hr />


<div class="topic-actions">
	<div class="buttons">
	
		<div class="reply-icon"><a href="http://192.168.20.226:3000/forums/posting.php?mode=reply&amp;f=16&amp;t=3095&amp;sid=de2d556bf3f0e66038a4cf0bca137a95" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="pagination">
			13 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	
</div>


	<p></p><p><a href="../game-development-f16.html" class="left-box left" accesskey="r">Return to Game Development</a></p>

	<form method="post" id="jumpbox" action="http://192.168.20.226:3000/forums/viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	
		<fieldset class="jumpbox">
	
			<label for="f" accesskey="j">Jump to:</label>
			<select name="f" id="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">
			
				<option value="-1">Select a forum</option>
			<option value="-1">------------------</option>
				<option value="4">Moai Development Forums</option>
			
				<option value="7">&nbsp; &nbsp;Moai SDK</option>
			
				<option value="9">&nbsp; &nbsp;Questions and Tips</option>
			
				<option value="10">&nbsp; &nbsp;Bug Reports</option>
			
				<option value="3">Moai Community Forums</option>
			
				<option value="11">&nbsp; &nbsp;Community Contributions</option>
			
				<option value="25">&nbsp; &nbsp;&nbsp; &nbsp;Flower</option>
			
				<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Rapanui</option>
			
				<option value="26">&nbsp; &nbsp;&nbsp; &nbsp;Snippets</option>
			
				<option value="5">&nbsp; &nbsp;Moai Roadmap</option>
			
				<option value="6">&nbsp; &nbsp;Made With Moai</option>
			
				<option value="12">Platform Specifics</option>
			
				<option value="17">&nbsp; &nbsp;Android</option>
			
				<option value="18">&nbsp; &nbsp;Apple</option>
			
				<option value="20">&nbsp; &nbsp;Linux</option>
			
				<option value="19">&nbsp; &nbsp;Windows</option>
			
				<option value="21">&nbsp; &nbsp;Browser + Other</option>
			
				<option value="13">Third Party Libraries and Plugins</option>
			
				<option value="22">&nbsp; &nbsp;Physics</option>
			
				<option value="23">&nbsp; &nbsp;Sound + Music</option>
			
				<option value="24">&nbsp; &nbsp;Advertising + Networking + IAPs</option>
			
				<option value="14">Additional</option>
			
				<option value="16" selected="selected">&nbsp; &nbsp;Game Development</option>
			
				<option value="27">&nbsp; &nbsp;Off Topic</option>
			
			</select>
			<input type="submit" value="Go" class="button2" />
		</fieldset>
	</form>


	<h3>Who is online</h3>
	<p>Users browsing this forum: No registered users and 1 guest</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner"><span class="corners-top"><span></span></span>

		<ul class="linklist">
			<li class="icon-home"><a href="../index.html" accesskey="h">Board index</a></li>
				
			<li class="rightside"><a href="../the-team.html">The team</a> &bull; <a href="http://192.168.20.226:3000/forums/ucp.php?mode=delete_cookies&amp;sid=de2d556bf3f0e66038a4cf0bca137a95">Delete all board cookies</a> &bull; All times are UTC - 8 hours [ <abbr title="Daylight Saving Time">DST</abbr> ]</li>
		</ul>

		<span class="corners-bottom"><span></span></span></div>
	</div>
	
	<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group<br />Style by <a href="http://www.m-a-styles.de">Marc Alexander</a> &copy;
		<br /><br /><a href="http://www.phpbb-seo.com/" title="Search Engine Optimization"><img src="../images/phpbb-seo.png" alt="phpBB SEO"/></a><br />Time : 0.106s | 11 Queries | GZIP : Off
	</div>
</div>

</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	<img src="../cron.php%3Fcron_type=tidy_warnings&amp;sid=de2d556bf3f0e66038a4cf0bca137a95" width="1" height="1" alt="cron" />
	</div>
	</div>
<div class="nobottomgap"></div>
</div>
<!--- end of box border -->
</div></div>
<!-- -->
<div class="bottom-left"></div><div class="bottom-center"></div><div class="bottom-right"></div>
</div>
<!-- JQuery Pop Up --><!-- PM Popup --><!-- PM Popup end --><!-- Image Popup -->
<div id="popupImage">
	<p id="ImagePopup"></p>
	<a id="popupImageClose">x</a> 
</div>
<!-- Image Popup -->
<div id="backgroundPopup"></div> 
<!-- JQuery Pop Up END -->
</body>
</html>