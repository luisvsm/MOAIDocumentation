<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />

<title>Moai Forum &bull; View topic - 1.6+ MoaiShader and MOAIShaderProgram breaking</title>

<link rel="alternate" type="application/atom+xml" title="Feed - Moai Forum" href="../feed.php.html" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="../feed.php%3Fmode=forums.html" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="../feed.php%3Fmode=topics.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="../feed.php%3Fmode=topics_active.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - Moai SDK" href="../feed.php%3Ff=7.html" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - 1.6+ MoaiShader and MOAIShaderProgram breaking" href="http://192.168.20.226:3000/forums/feed.php?f=7&amp;t=3231" />

<!--
	phpBB style name: proFormell
	Based on style:   prosilver (this is the default phpBB3 style)
	Inspired by:	  Formell (Joomla Style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  	  Marc Alexander
	
	NOTE: This page was generated by phpBB, the free open-source bulletin board package.
	      The phpBB Group is not responsible for the content of this page and forum. For more information
	      about phpBB please visit http://www.phpbb.com
-->

<script type="text/javascript">
// <![CDATA[
	var jump_page = 'Enter the page number you wish to go to:';
	var on_page = '1';
	var per_page = '';
	var base_url = '';
	var style_cookie = 'phpBBstyle';
	var style_cookie_settings = '; path=/';
	var onload_functions = new Array();
	var onunload_functions = new Array();
	var is_ie6 = false;

	/**
	* Find a member
	*/
	function find_username(url)
	{
		popup(url, 760, 570, '_usersearch');
		return false;
	}

	/**
	* New function for handling multiple calls to window.onload and window.unload by pentapenguin
	*/
	window.onload = function()
	{
		for (var i = 0; i < onload_functions.length; i++)
		{
			eval(onload_functions[i]);
		}
	}

	window.onunload = function()
	{
		for (var i = 0; i < onunload_functions.length; i++)
		{
			eval(onunload_functions[i]);
		}
	}

// ]]>
</script>
<!--[if lt IE 7]>
<script type="text/javascript">
// <![CDATA[
var is_ie6 = true;
// ]]>
</script>
<![endif]-->


<link href="../styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />

<link href="../style.css" rel="stylesheet" type="text/css" media="screen, projection" />



<link href="../styles/proFormell/theme/images/favicon.ico" rel="shortcut icon" />

<script type="text/javascript" src="../styles/prosilver/template/forum_fn.js"></script>
<script src="../styles/prosilver/template/jquery-1.4.4.min.js" type="text/javascript"></script>

<script type="text/javascript">
// <![CDATA[
/**
* New pop-up functions
* based on  http://yensdesign.com/2008/09/how-to-create-a-stunning-and-smooth-popup-using-jquery/
*/

//SETTING UP OUR POPUP
//0 means disabled; 1 means enabled;
var popupStatus = 0;
var openPopup = '';

//loading popup with jQuery magic!
function loadPopup()
{
	//loads popup only if it is disabled
	if(popupStatus==0)
	{
		$('#backgroundPopup').css({'opacity': '0.7'});
		// Now let's make sure we actually see the image
		var scroll = $(window).scrollTop();
		$('#popupPM').animate({marginTop: scroll}, 'fast', function() {
			// Animation complete.
			});
		$('#backgroundPopup').fadeIn('slow');
		$('#popupPM').fadeIn('slow');
		popupStatus = 1;
		openPopup = 'PM';
	}
}

//disabling popup with jQuery magic!
function disablePopup()
{
	//disables popup only if it is enabled
	if(popupStatus==1 && openPopup == 'PM')
	{
		$('#backgroundPopup').fadeOut('slow');
		$('#popupPM').fadeOut('slow');
		popupStatus = 0;
		openPopup = '';
	}
}

//centering popup
function centerPopup()
{
	//request data for centering
	var windowWidth = document.documentElement.clientWidth;
	var windowHeight = document.documentElement.clientHeight;
	var popupHeight = $('#popupPM').height();
	var popupWidth = $('#popupPM').width();
	//centering
	$('#popupPM').css({
	'position': 'absolute',
	'top': windowHeight/2-popupHeight/2,
	'left': windowWidth/2-popupWidth/2
	});
	//only need force for IE6
	$('#backgroundPopup').css({'height': windowHeight});
}

$(document).ready(function(){
	
	resize_images();
	
	
	// IE6 and below PNG fix (not really)
	if(is_ie6)
	{
		replace_png();
	}
	
	//CLOSING POPUP
	//Click the x event!
	$('#popupPMClose').click(function(){
		disablePopup();
	});
	//Click out event!
	$('#backgroundPopup').click(function(){
		disablePopup();
		disableImage();
	});
	//Press Escape event!
	$(document).keypress(function(e){
		if(e.keyCode==27 && popupStatus==1)
		{
			disablePopup();
			disableImage();
		}
	});
	
	
	// Image popup
	$('img', 'dt.attach-image').click(function(){
		image_load($(this).attr('src'), $(this).attr('alt'));
		centerImage();
	});
	
	$('.content img').click(function(){
		var check = $(this).parent().hasClass('content');
		if(check)
		{
			image_load($(this).attr('src'), $(this).attr('alt'));
			centerImage();
		}
	});
	
	// Closing Image popup
	//Click the x event!
	$('#popupImageClose').click(function(){
		disableImage();
	});
	
	//Click image box event
	$('#popupImage').click(function(){
		disableImage();
	});
	
	//Click image event
	$('#ImagePopup img').click(function(){
		disableImage();
	});
	

});

/**
* Replaces weird looking PNG files with the respectie GIF file
* Only run this if the browser is IE6 or below
*/
function replace_png()
{
	// Fix Logo
	var str = $('#logo img').attr('src'); 
	$('#logo img').attr('src', str.substring(0, str.length - 3) + 'gif');
	
	// Fix forum icons
	$('dl.icon').each(function() {
		var str = $(this).css('background-image');
		if(str != '')
		{
			$(this).css('background-image', str.substring(0, str.length - 5) + 'gif")');
		}
	});
}


/**
* Image resizer
*/
function resize_images()
{
	var hello = $('dl.attachbox dd dl.file dt.attach-image img').innerWidth();
	var maxWidth = $('div.content').innerWidth() - 30;
	
	// resize the attached images
	$('img', 'dt.attach-image').each(function(i){
		// check the width of the image
		if ($(this).width() > maxWidth)
		{
			// calculate new image dimensions
			newWidth = maxWidth;
			newHeight = $(this).height() / ( $(this).width() / maxWidth );
			   
			// set new image dimensions
			$(this).height(newHeight).width(newWidth);
		}
	});
	
	// resize the images that were added via [img] bbcode
	$('img', 'div.content').each(function(i){
		// check the width of the image
		$(this).css('max-width', maxWidth); // fix for IE
		if ($(this).width() > maxWidth)
		{
			// calculate new image dimensions
			newWidth = maxWidth;
			newHeight = $(this).height() / ( $(this).width() / maxWidth );
			   
			// set new image dimensions
			$(this).height(newHeight).width(newWidth);
		}
	});
}

/**
* Image pop-up
*/
function image_load(src, alt)
{
	//loads popup only if it is disabled
	if(popupStatus==0)
	{
		$('#ImagePopup').html('<img id="imgpopup" src="http://192.168.20.226:3000/forums/1-6-moaishader-and-moaishaderprogram-breaking-t3231/'&#32;+&#32;src&#32;+&#32;'" alt="' + alt + '" />');
		var windowWidth = document.documentElement.clientWidth;
		var windowHeight = document.documentElement.clientHeight;
		var maxWidth = windowWidth * 0.85;
		var maxHeight = windowHeight * 0.85;
		$('#popupImage img').css('max-width', maxWidth);
		$('#popupImage img').css('max-height', maxHeight);
		$('#backgroundPopup').css({'opacity': '0.7'});
		// Now let's make sure we actually see the image
		var scroll = $(window).scrollTop();
		$('#popupImage').animate({marginTop: scroll}, 'fast', function() {
			// Animation complete.
			});
		$('#backgroundPopup').fadeIn('slow');
		$('#popupImage').fadeIn('slow');
		popupStatus = 1;
		openPopup = 'Image';
	}
}

//centering popup
function centerImage()
{
	//request data for centering
	var windowWidth = document.documentElement.clientWidth;
	var windowHeight = document.documentElement.clientHeight;
	var popupHeight = $('#popupImage').height();
	var popupWidth = $('#popupImage').width();
	var newTop = windowHeight/2-popupHeight/2;
	var newLeft = windowWidth/2-popupWidth/2;
	//centering
	$('#popupImage').css({
	'position': 'absolute',
	'top': newTop,
	'left': newLeft
	});
	
	//only need force for IE6
	$('#backgroundPopup').css({'height': windowHeight});
}

//disabling popup with jQuery magic!
function disableImage()
{
	//disables popup only if it is enabled
	if(popupStatus==1 && openPopup == 'Image')
	{
		$('#backgroundPopup').fadeOut('slow');
		$('#popupImage').fadeOut('slow');
		popupStatus = 0;
		openPopup = '';
	}
}


// ]]>
</script>

</head>

<body id="phpbb" class="section-viewtopic ltr">
<!--- box border START -->
<div id="box">

<div class="top-left"></div><div class="top-center"></div><div class="top-right"></div>
<div id="left-border">
<div id="right-border">


<!--- box border END -->
<div class="inside">
 <div class="notopgap">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar">
			<div class="inner"><!-- <span class="corners-top"><span></span></span> -->
			<div style="height: 140px ;">
			<div id="site-description">
				<div class="header-pad"><a href="index.html" title="" id="logo"><img src="../styles/proFormell/imageset/site-logo.png" width="410" height="98" alt="" title="" /></a></div>
			
		<!--		<p class="site-desc">The mobile platform for pro game developers</p> -->
				<p class="skiplink"><a href="index.html#start_here">Skip to content</a></p>
			</div>

		
			<div id="search-box">
				<form action="../search.php.html" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="text" maxlength="128" title="Search for keywords" class="inputbox search" value="Search…" onclick="if(this.value=='Search…')this.value='';" onblur="if(this.value=='')this.value='Search…';" /> 
					<input class="button2" value="Search" type="submit" /><br />
					<a href="../search.php.html" title="View the advanced search options">Advanced search</a> <input type="hidden" name="sid" value="4bd8ae158b723d4718c9e82d9902d47c" />

				</fieldset>
				</form>
			</div>
		
    </div>

			<span class="corners-bottom"><span></span></span></div>
		</div>

		<div class="navbar">
			<div class="inner"><span class="corners-top"><span></span></span>

			<ul class="linklist navlinks">
				<li class="icon-home"><a href="../index.html" accesskey="h">Board index</a>  <strong>&#8249;</strong> <a href="../moai-development-forums.html">Moai Development Forums</a> <strong>&#8249;</strong> <a href="../moai-sdk-developer-support.html">Moai SDK</a></li>

				<li class="rightside"><a href="index.html#" onclick="fontsizeup(); return false;" onkeypress="return fontsizeup(event);" class="fontsize" title="Change font size">Change font size</a></li>

				<li class="rightside"><a href="http://192.168.20.226:3000/forums/viewtopic.php?f=7&amp;t=3231&amp;start=0&amp;view=print&amp;sid=4bd8ae158b723d4718c9e82d9902d47c" title="Print view" accesskey="p" class="print">Print view</a></li>
			</ul>

			

			<ul class="linklist rightside">
				<li class="icon-faq"><a href="http://192.168.20.226:3000/forums/faq.php?sid=4bd8ae158b723d4718c9e82d9902d47c" title="Frequently Asked Questions">FAQ</a></li>
				
				<li class="icon-register"><a href="http://192.168.20.226:3000/forums/ucp.php?mode=register&amp;sid=4bd8ae158b723d4718c9e82d9902d47c">Register</a></li>
					<li class="icon-logout"><a href="http://192.168.20.226:3000/forums/ucp.php?mode=login&amp;sid=4bd8ae158b723d4718c9e82d9902d47c" title="Login" accesskey="x">Login</a></li>
				
			</ul>

			<span class="corners-bottom"><span></span></span></div>
		</div>
	</div>

	<a name="start_here"></a>
	<div id="page-body">
		
<h2><a href="index.html">1.6+ MoaiShader and MOAIShaderProgram breaking</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body --><div style="display: none !important;">Discussion about using Moai SDK - post questions, issues, and ideas here.<br /></div>
	<p>
		
			<strong>Moderators:</strong> <a href="../member1551.html" style="color: #AA0000;" class="username-coloured">naturally</a>, <a href="../member1298.html">seebs</a>, <a href="../member1202.html" style="color: #AA0000;" class="username-coloured">ezraanderson</a>
		

	</p>


<div class="topic-actions">

	<div class="buttons">
	
		<div class="reply-icon"><a href="http://192.168.20.226:3000/forums/posting.php?mode=reply&amp;f=7&amp;t=3231&amp;sid=4bd8ae158b723d4718c9e82d9902d47c" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="search-box">
			<form method="get" id="topic-search" action="../search.php.html">
			<fieldset>
				<input class="inputbox search tiny"  type="text" name="keywords" id="search_keywords" size="20" value="Search this topic…" onclick="if(this.value=='Search this topic…')this.value='';" onblur="if(this.value=='')this.value='Search this topic…';" />
				<input class="button2" type="submit" value="Search" />
				<input type="hidden" name="t" value="3231" />
<input type="hidden" name="sf" value="msgonly" />
<input type="hidden" name="sid" value="4bd8ae158b723d4718c9e82d9902d47c" />

			</fieldset>
			</form>
		</div>
	
		<div class="pagination">
			7 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	

</div>
<div class="clear"></div>


	<div id="p17789" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 class="first"><a href="index.html#p17789">1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17789.html#p17789"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Wed Nov 25, 2015 12:41 am </p>

			

			<div class="content">In order to release a game update on iOS it looks we need to update to 1.6 to get 64 bit iOS compilation working, without which the app store is no longer accepting updates.<br /><br />So I updated to 1.6, but it breaks a lot of the game. First the shader initialisation has been redone with the new MOAIShaderProgram stuff which isn't documented anywhere, but I figure what the heck, it's just some minor code switches based on the version. However, whatever I do, the shader uniforms don't seem to get passed properly. Basically the props get completely garbled, and after debugging it looks like none of the values are being passed to the shader.<br /><br />Here's the code, after the attempted adjustments for 1.6. The first one is just the relevant bit, the next one has the full shader function.<br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">if</span> MOAIShaderProgram <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #808080; font-style: italic;">-- V1.6</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> program <span style="color: #66cc66;">=</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>new <span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'position'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'uv'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setVertexAttribute <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'colour'</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>reserveUniforms <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">15</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformSampler<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'diffuseMap'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformSampler<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'normalMap'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">2</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightX'</span><span style="color: #66cc66;">,</span> lightx <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">4</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightY'</span><span style="color: #66cc66;">,</span> lighty <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">5</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightZ'</span><span style="color: #66cc66;">,</span> lightz <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">6</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourR'</span><span style="color: #66cc66;">,</span> red<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat <span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">7</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourG'</span><span style="color: #66cc66;">,</span> green <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">8</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'lightColourB'</span><span style="color: #66cc66;">,</span> blue <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">9</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_intensity'</span><span style="color: #66cc66;">,</span> <span style="color: #66cc66;">&#40;</span>intensity <span style="color: #66cc66;">*</span> <span style="color: #cc66cc;">.4</span><span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">10</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'light_range'</span><span style="color: #66cc66;">,</span> range <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambientColourR'</span><span style="color: #66cc66;">,</span> am_red<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">12</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambientColourG'</span><span style="color: #66cc66;">,</span> am_green <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">13</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'ambientColourB'</span><span style="color: #66cc66;">,</span> am_blue <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">if</span> move_with_prop <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">14</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'moveWithProp'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">else</span> </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">14</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'moveWithProp'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">if</span> isBlack <span style="color: #aa9900; font-weight: bold;">then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">15</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'isBlack'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">else</span> </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniformFloat<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">15</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'isBlack'</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #aa9900; font-weight: bold;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>reserveGlobals<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">3</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setGlobal<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'worldMatrix'</span><span style="color: #66cc66;">,</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>UNIFORM_WORLD <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setGlobal<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">2</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'viewProjMatrix'</span><span style="color: #66cc66;">,</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>UNIFORM_VIEW_PROJ <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setGlobal<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">3</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'worldViewProjMatrix'</span><span style="color: #66cc66;">,</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>UNIFORM_WORLD_VIEW_PROJ <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> vsh<span style="color: #66cc66;">,</span> fsh <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; shader<span style="color: #66cc66;">:</span>setProgram<span style="color: #66cc66;">&#40;</span>program<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">/</span>b<span style="color: #66cc66;">&#93;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">else</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #aa9900; font-weight: bold;">function</span> point_lighting_shader<span style="color: #66cc66;">&#40;</span>lightx<span style="color: #66cc66;">,</span> lighty<span style="color: #66cc66;">,</span> lightz<span style="color: #66cc66;">,</span> intensity<span style="color: #66cc66;">,</span> range<span style="color: #66cc66;">,</span> red<span style="color: #66cc66;">,</span> green<span style="color: #66cc66;">,</span> blue<span style="color: #66cc66;">,</span> am_red<span style="color: #66cc66;">,</span> am_green<span style="color: #66cc66;">,</span> am_blue<span style="color: #66cc66;">,</span> move_with_prop<span style="color: #66cc66;">,</span> isBlack<span style="color: #66cc66;">&#41;</span> &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; <span style="color: #aa9900; font-weight: bold;">local</span> fsh <span style="color: #66cc66;">=</span> <span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">&#91;</span> &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec2 uvVarying<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec4 positionVarying<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec4 colourVarying<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec4 light<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; varying MEDP vec3 lightColour<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform MEDP float isBlack<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform sampler2D diffuseMap<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform sampler2D normalMap<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform float light_intensity<span style="color: #66cc66;">,</span> light_range<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform MEDP float ambientColourR<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform MEDP float ambientColourG<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; uniform MEDP float ambientColourB<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; vec2 resolution <span style="color: #66cc66;">=</span> vec2<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; vec3 attenuation <span style="color: #66cc66;">=</span> vec3<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; void main<span style="color: #66cc66;">&#40;</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; <span style="color: #66cc66;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>sample color &amp; normals from our textures</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; vec4 color <span style="color: #66cc66;">=</span> texture2D<span style="color: #66cc66;">&#40;</span>diffuseMap<span style="color: #66cc66;">,</span> uvVarying<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; vec3 nColor <span style="color: #66cc66;">=</span> texture2D<span style="color: #66cc66;">&#40;</span>normalMap<span style="color: #66cc66;">,</span> uvVarying<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">.</span>rgb<span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>normals need to be converted to <span style="color: #66cc66;">&#91;</span><span style="color: #66cc66;">-</span><span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#93;</span> range <span style="color: #aa9900; font-weight: bold;">and</span> normalized</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; vec3 normal <span style="color: #66cc66;">=</span> normalize<span style="color: #66cc66;">&#40;</span>nColor <span style="color: #66cc66;">*</span> <span style="color: #cc66cc;">2.0</span> <span style="color: #66cc66;">-</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>here we <span style="color: #aa9900; font-weight: bold;">do</span> a simple distance calculation</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; vec3 deltaPos <span style="color: #66cc66;">=</span> vec3<span style="color: #66cc66;">&#40;</span>light<span style="color: #66cc66;">.</span>xy <span style="color: #66cc66;">-</span> positionVarying<span style="color: #66cc66;">.</span>xy<span style="color: #66cc66;">,</span> light<span style="color: #66cc66;">.</span>z <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; float vertex_dist <span style="color: #66cc66;">=</span> length <span style="color: #66cc66;">&#40;</span>deltaPos<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>gl_FragColor <span style="color: #66cc66;">=</span> vec4<span style="color: #66cc66;">&#40;</span>deltaPos<span style="color: #66cc66;">,</span> light<span style="color: #66cc66;">.</span>a<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span> Decay light factor depending on the vertex distance from light source</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; float decay <span style="color: #66cc66;">=</span> <span style="color: #0000aa;">max</span><span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">,</span> <span style="color: #66cc66;">&#40;</span>light_range <span style="color: #66cc66;">-</span> vertex_dist <span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">/</span> light_range <span style="color: #66cc66;">&#41;</span> <span style="color: #66cc66;">*</span> <span style="color: #cc66cc;">2.0</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; vec3 lightDir <span style="color: #66cc66;">=</span> normalize<span style="color: #66cc66;">&#40;</span>deltaPos<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; float lambert <span style="color: #66cc66;">=</span> clamp<span style="color: #66cc66;">&#40;</span>dot<span style="color: #66cc66;">&#40;</span>normal<span style="color: #66cc66;">,</span> lightDir<span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">0.0</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">1.0</span><span style="color: #66cc66;">&#41;</span><span style="color: #66cc66;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #66cc66;">//</span>now let<span style="color: #ff6666;">'s get a nice little falloff</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;float d = sqrt(dot(deltaPos, deltaPos)); &nbsp; &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;float att = ( attenuation.x + (attenuation.y*d) + (attenuation.z*d*d) );</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;vec3 ambientColor = vec3(ambientColourR, ambientColourG, ambientColourB);</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;vec3 result = ambientColor + (lightColour.rgb * lambert * light_intensity * decay) * att;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;result *= color.rgb;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;if(isBlack == 1.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;result *= vec3(.35, .35, .35);</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor = vec4(result, color.a);</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;}</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;]]</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;local vsh = [[ </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;attribute vec4 position;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;attribute vec2 uv;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightX;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightY;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightZ;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightColourR;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightColourG;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float lightColourB;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform MEDP float moveWithProp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform mat4 worldMatrix; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Sum of all MOAITransforms on object</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform mat4 viewProjMatrix; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Projection matrix (camera)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;uniform mat4 worldViewProjMatrix; &nbsp; &nbsp; &nbsp; // Projection matrix (camera</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;varying vec2 uvVarying;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;varying vec4 positionVarying; &nbsp; </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;varying vec4 light;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;varying vec3 lightColour;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;void main () {</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;uvVarying = uv;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;positionVarying = position * worldMatrix;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;if(moveWithProp &gt; 0.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;light = positionVarying + vec4(lightX, lightY, lightZ, 1.0);</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;else</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp; &nbsp;light = vec4(lightX, lightY, lightZ, 1.0) * worldMatrix;// * viewProjMatrix;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;lightColour = vec3(lightColourR, lightColourG, lightColourB);</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;gl_Position = position;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;}</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;]]</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;local shader = MOAIShader.new ()</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;&lt;span style=&quot;font-weight: bold&quot;&gt;if MOAIShaderProgram then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;-- V1.6</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;local program = MOAIShaderProgram.new ()</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setVertexAttribute ( 1, '</span>position<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setVertexAttribute ( 2, '</span>uv<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setVertexAttribute ( 3, '</span>colour<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:reserveUniforms ( 15 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformSampler( 1, '</span>diffuseMap<span style="color: #ff6666;">', 1 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformSampler( 2, '</span>normalMap<span style="color: #ff6666;">', 2 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 3, '</span>lightX<span style="color: #ff6666;">', lightx )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 4, '</span>lightY<span style="color: #ff6666;">', lighty )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 5, '</span>lightZ<span style="color: #ff6666;">', lightz )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 6, '</span>lightColourR<span style="color: #ff6666;">', red)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat ( 7, '</span>lightColourG<span style="color: #ff6666;">', green )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 8, '</span>lightColourB<span style="color: #ff6666;">', blue )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 9, '</span>light_intensity<span style="color: #ff6666;">', (intensity * .4) )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 10, '</span>light_range<span style="color: #ff6666;">', range )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 11, '</span>ambientColourR<span style="color: #ff6666;">', am_red)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 12, '</span>ambientColourG<span style="color: #ff6666;">', am_green )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:declareUniformFloat( 13, '</span>ambientColourB<span style="color: #ff6666;">', am_blue )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;if move_with_prop then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;program:declareUniformFloat( 14, '</span>moveWithProp<span style="color: #ff6666;">', 1.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;else </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;program:declareUniformFloat( 14, '</span>moveWithProp<span style="color: #ff6666;">', 0.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;if isBlack then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;program:declareUniformFloat( 15, '</span>isBlack<span style="color: #ff6666;">', 1.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;else </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;program:declareUniformFloat( 15, '</span>isBlack<span style="color: #ff6666;">', 0.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:reserveGlobals(3)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setGlobal( 1, '</span>worldMatrix<span style="color: #ff6666;">', MOAIShaderProgram.UNIFORM_WORLD )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setGlobal( 2, '</span>viewProjMatrix<span style="color: #ff6666;">', MOAIShaderProgram.UNIFORM_VIEW_PROJ )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:setGlobal( 3, '</span>worldViewProjMatrix<span style="color: #ff6666;">', MOAIShaderProgram.UNIFORM_WORLD_VIEW_PROJ )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;program:load ( vsh, fsh )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:setProgram(program)&lt;/span&gt;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;else</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:setVertexAttribute ( 1, '</span>position<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:setVertexAttribute ( 2, '</span>uv<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:setVertexAttribute ( 3, '</span>colour<span style="color: #ff6666;">' )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:reserveUniforms ( 18 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformSampler( 1, '</span>diffuseMap<span style="color: #ff6666;">', 1 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformSampler( 2, '</span>normalMap<span style="color: #ff6666;">', 2 )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 3, '</span>lightX<span style="color: #ff6666;">', lightx )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 4, '</span>lightY<span style="color: #ff6666;">', lighty )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 5, '</span>lightZ<span style="color: #ff6666;">', lightz )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 6, '</span>lightColourR<span style="color: #ff6666;">', red)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat ( 7, '</span>lightColourG<span style="color: #ff6666;">', green )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 8, '</span>lightColourB<span style="color: #ff6666;">', blue )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 9, '</span>light_intensity<span style="color: #ff6666;">', (intensity * .4) )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 10, '</span>light_range<span style="color: #ff6666;">', range )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 11, '</span>ambientColourR<span style="color: #ff6666;">', am_red)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 12, '</span>ambientColourG<span style="color: #ff6666;">', am_green )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniformFloat( 13, '</span>ambientColourB<span style="color: #ff6666;">', am_blue )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;if move_with_prop then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;shader:declareUniformFloat( 14, '</span>moveWithProp<span style="color: #ff6666;">', 1.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;else </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;shader:declareUniformFloat( 14, '</span>moveWithProp<span style="color: #ff6666;">', 0.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniform( 15, '</span>worldMatrix<span style="color: #ff6666;">', MOAIShader.UNIFORM_WORLD )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniform( 16, '</span>viewProjMatrix<span style="color: #ff6666;">', MOAIShader.UNIFORM_VIEW_PROJ )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:declareUniform( 17, '</span>worldViewProjMatrix<span style="color: #ff6666;">', MOAIShader.UNIFORM_WORLD_VIEW_PROJ )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;if isBlack then</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;shader:declareUniformFloat( 18, '</span>isBlack<span style="color: #ff6666;">', 1.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;else </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp; &nbsp;shader:declareUniformFloat( 18, '</span>isBlack<span style="color: #ff6666;">', 0.0)</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp; &nbsp;shader:load ( vsh, fsh )</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;"> &nbsp;return shader</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #ff6666;">end</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />Am I doing something wrong here? What needs to be done to get these values passed properly</div>

			

		</div>

		
			<dl class="postprofile" id="profile17789">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17794" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17794">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17794.html#p17794"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member262.html" style="color: #AA0000;" class="username-coloured">ibisum</a></strong> &raquo; Fri Nov 27, 2015 1:02 am </p>

			

			<div class="content">Check out the develop branch - this is MOAI 1.7, where we have been addressing a lot of these issues already.</div>

			<div id="sig17794" class="signature">;<br />--<br />Email: <!-- e --><a href="mailto:ibisum@gmail.com">ibisum@gmail.com</a><!-- e -->  <br />IRC:  torpor on FreeNode, see you in the #moai channel<br />Got a MOAI snippet?  Please consider adding it to <a href="http://moaisnippets.info/" class="postlink">http://moaisnippets.info/</a></div>

		</div>

		
			<dl class="postprofile" id="profile17794">
			<dt>
				<a href="../member262.html"><img src="../download/file.php%253favatar%253d262_1340630942.png" width="120" height="90" alt="User avatar" /></a><br />
				<a href="../member262.html" style="color: #AA0000;" class="username-coloured">ibisum</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 1499</dd><dd><strong>Joined:</strong> Mon Oct 17, 2011 1:11 am</dd><dd><strong>Location:</strong> Vienna, Austria</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="https://www.google.com/profiles/102544789920860459725" title="WWW: https://www.google.com/profiles/102544789920860459725"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17795" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17795">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17795.html#p17795"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Sat Nov 28, 2015 8:41 am </p>

			

			<div class="content">EDIT: All other issues solved except one below.</div>

			
				<div class="notice">Last edited by <a href="../member1389.html">sshukul</a> on Tue Dec 01, 2015 1:44 am, edited 1 time in total.
					
				</div>
			

		</div>

		
			<dl class="postprofile" id="profile17795">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17796" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17796">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17796.html#p17796"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Tue Dec 01, 2015 1:44 am </p>

			

			<div class="content">Thanks ibisum, after upgrading to 1.7 some digging around and adjusting things a little, all of the issues seem to be fixed and the shader is almost back to normal.<br /><br />The only issue is that the world transform matrix (GLOBAL_WORLD) doesn't seem to be getting passed. I'm assuming this is the correct way to set it now?<br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="lua" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>declareUniform<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">16</span><span style="color: #66cc66;">,</span> <span style="color: #ff6666;">'worldMatrix'</span><span style="color: #66cc66;">,</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>UNIFORM_MATRIX_F4 <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>reserveGlobals<span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>setGlobal<span style="color: #66cc66;">&#40;</span> <span style="color: #cc66cc;">1</span><span style="color: #66cc66;">,</span> <span style="color: #cc66cc;">16</span><span style="color: #66cc66;">,</span> MOAIShaderProgram<span style="color: #66cc66;">.</span>GLOBAL_WORLD <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; program<span style="color: #66cc66;">:</span>load <span style="color: #66cc66;">&#40;</span> vsh<span style="color: #66cc66;">,</span> fsh <span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; shader<span style="color: #66cc66;">:</span>setProgram<span style="color: #66cc66;">&#40;</span>program<span style="color: #66cc66;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />This seems to initialise an f4 matrix but doesn't seem to set the actual world transform which would allow the shader to account for scales, rotations etc. as it did before.<br /><br />Is this something still being worked on or do I need to set it differently? Thanks</div>

			

		</div>

		
			<dl class="postprofile" id="profile17796">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17799" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17799">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17799.html#p17799"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member262.html" style="color: #AA0000;" class="username-coloured">ibisum</a></strong> &raquo; Wed Dec 02, 2015 5:39 am </p>

			

			<div class="content">I'm not familiar with this issue, so can't comment on the details specifically .. But generally, we are moving slowly towards having a stable 1.7 release at the moment and things like this may be occurring because of late-changing fixes that didn't get tested, etc.  So if you can participate in the debugging, it helps us stabilize ..<br /><br />So please make an issue for it on the repo:<br /><br /><!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/issues">https://github.com/moai/moai-dev/issues</a><!-- m --><br /><br />.. or add your details if you see it already reported.<br /><br />We're meeting on Slack on a regular basis to discuss these issues - I know that patrick and halfnelson and the other devs *do* get notifications when issues are reported on github ..</div>

			<div id="sig17799" class="signature">;<br />--<br />Email: <!-- e --><a href="mailto:ibisum@gmail.com">ibisum@gmail.com</a><!-- e -->  <br />IRC:  torpor on FreeNode, see you in the #moai channel<br />Got a MOAI snippet?  Please consider adding it to <a href="http://moaisnippets.info/" class="postlink">http://moaisnippets.info/</a></div>

		</div>

		
			<dl class="postprofile" id="profile17799">
			<dt>
				<a href="../member262.html"><img src="../download/file.php%253favatar%253d262_1340630942.png" width="120" height="90" alt="User avatar" /></a><br />
				<a href="../member262.html" style="color: #AA0000;" class="username-coloured">ibisum</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 1499</dd><dd><strong>Joined:</strong> Mon Oct 17, 2011 1:11 am</dd><dd><strong>Location:</strong> Vienna, Austria</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="https://www.google.com/profiles/102544789920860459725" title="WWW: https://www.google.com/profiles/102544789920860459725"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17800" class="post bg1">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17800">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="http://192.168.20.226:3000/forums/post17800.html#p17800"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Thu Dec 03, 2015 12:39 am </p>

			

			<div class="content">Ok thanks, I've added the issue here:<br /><br /><!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/issues/1168">https://github.com/moai/moai-dev/issues/1168</a><!-- m --></div>

			

		</div>

		
			<dl class="postprofile" id="profile17800">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<div id="p17813" class="post bg2">
		<div class="inner"><span class="corners-top"><span></span></span>

		<div class="postbody">
			

			<h3 ><a href="index.html#p17813">Re: 1.6+ MoaiShader and MOAIShaderProgram breaking</a></h3>
			<p class="author"><a href="../post17813.html#p17813"><img src="../styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" /></a>by <strong><a href="../member1389.html">sshukul</a></strong> &raquo; Sun Dec 20, 2015 12:34 am </p>

			

			<div class="content">So I looked into this a bit more and got the issue &quot;semi-fixed&quot; now by adding this to line 241 of MOAIGfxDeviceMtxCache.cpp inside SetVertexTransform()<br /><br /><dl class="codebox"><dt>Code: <a href="index.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="cpp" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; this<span style="color: #000040;">-</span><span style="color: #000080;">&gt;</span>UpdateShaderGlobals <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />It looks like there was an UpdatePipelineTransforms() call at the end of the SetVertexTransform() function in 1.5 but this is missing from 1.7. The UpdateShaderGlobals() function looks like it's new equivalent. <br /><br />This almost fixes the issue to where the world global is being updated for things like scale. <br /><br />The problem is it's not consistent and occasionally doesn't update ... for example, in my game I've got a player character that's made of a MOAITransform which is the parent to many separate MOAIProp2D objects for the body parts (like head, arms, legs etc.). It's done that way using a Moai plugin for Spriter. With this new fix, the world transform updates most of the time, but after a few switches back and forth to the scale, one of the props will not get the updated transform, so it's lighting is backwards compared to the rest of the body, like so:<br /><br /><img src="http://i.imgur.com/txDV56e.jpg" alt="Image" /><br /><br />Notice the shoulder / upper arm prop is lighted backwards compared to the rest ... this is because it's GLOBAL_WORLD matrix is not being updated in the shader after the -1 scale is applied to the prop, even when the rest of the props are updated with the correct matrix value.<br /><br />Any guesses as to why this could be happening or where I should look to investigate further guys? This has me stumped for the last few days even after making what looks like progress on the issue.</div>

			

		</div>

		
			<dl class="postprofile" id="profile17813">
			<dt>
				<a href="../member1389.html"><img src="../download/file.php%253favatar%253d1389_1402231553.jpg" width="100" height="100" alt="User avatar" /></a><br />
				<a href="../member1389.html">sshukul</a>
			</dt>

			

		<dd>&nbsp;</dd>

		<dd><strong>Posts:</strong> 100</dd><dd><strong>Joined:</strong> Wed Mar 27, 2013 1:44 am</dd>
			<dd>
				<ul class="profile-icons">
					<li class="web-icon"><a href="http://www.elev8games.com" title="WWW: http://www.elev8games.com"><span>Website</span></a></li>
				</ul>
			</dd>
		

		</dl>
	

		<div class="back2top"><a href="index.html#wrap" class="top" title="Top">Top</a></div>

		<span class="corners-bottom"><span></span></span></div>
	</div>

	<hr class="divider" />

	<form id="viewtopic" method="post" action="index.html">

	<fieldset class="display-options" style="margin-top: 0; ">
		
		<label>Display posts from previous: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
		<label>Sort by <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label> <label><select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select> <input type="submit" name="sort" value="Go" class="button2" /></label>
		
	</fieldset>

	</form>
	<hr />


<div class="topic-actions">
	<div class="buttons">
	
		<div class="reply-icon"><a href="http://192.168.20.226:3000/forums/posting.php?mode=reply&amp;f=7&amp;t=3231&amp;sid=4bd8ae158b723d4718c9e82d9902d47c" title="Post a reply"><span></span>Post a reply</a></div>
	
	</div>

	
		<div class="pagination">
			7 posts
			 &bull; Page <strong>1</strong> of <strong>1</strong>
		</div>
	
</div>


	<p></p><p><a href="../moai-sdk-developer-support.html" class="left-box left" accesskey="r">Return to Moai SDK</a></p>

	<form method="post" id="jumpbox" action="http://192.168.20.226:3000/forums/viewforum.php" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	
		<fieldset class="jumpbox">
	
			<label for="f" accesskey="j">Jump to:</label>
			<select name="f" id="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">
			
				<option value="-1">Select a forum</option>
			<option value="-1">------------------</option>
				<option value="4">Moai Development Forums</option>
			
				<option value="7" selected="selected">&nbsp; &nbsp;Moai SDK</option>
			
				<option value="9">&nbsp; &nbsp;Questions and Tips</option>
			
				<option value="10">&nbsp; &nbsp;Bug Reports</option>
			
				<option value="3">Moai Community Forums</option>
			
				<option value="11">&nbsp; &nbsp;Community Contributions</option>
			
				<option value="25">&nbsp; &nbsp;&nbsp; &nbsp;Flower</option>
			
				<option value="28">&nbsp; &nbsp;&nbsp; &nbsp;Rapanui</option>
			
				<option value="26">&nbsp; &nbsp;&nbsp; &nbsp;Snippets</option>
			
				<option value="5">&nbsp; &nbsp;Moai Roadmap</option>
			
				<option value="6">&nbsp; &nbsp;Made With Moai</option>
			
				<option value="12">Platform Specifics</option>
			
				<option value="17">&nbsp; &nbsp;Android</option>
			
				<option value="18">&nbsp; &nbsp;Apple</option>
			
				<option value="20">&nbsp; &nbsp;Linux</option>
			
				<option value="19">&nbsp; &nbsp;Windows</option>
			
				<option value="21">&nbsp; &nbsp;Browser + Other</option>
			
				<option value="13">Third Party Libraries and Plugins</option>
			
				<option value="22">&nbsp; &nbsp;Physics</option>
			
				<option value="23">&nbsp; &nbsp;Sound + Music</option>
			
				<option value="24">&nbsp; &nbsp;Advertising + Networking + IAPs</option>
			
				<option value="14">Additional</option>
			
				<option value="16">&nbsp; &nbsp;Game Development</option>
			
				<option value="27">&nbsp; &nbsp;Off Topic</option>
			
			</select>
			<input type="submit" value="Go" class="button2" />
		</fieldset>
	</form>


	<h3>Who is online</h3>
	<p>Users browsing this forum: No registered users and 1 guest</p>
</div>

<div id="page-footer">

	<div class="navbar">
		<div class="inner"><span class="corners-top"><span></span></span>

		<ul class="linklist">
			<li class="icon-home"><a href="../index.html" accesskey="h">Board index</a></li>
				
			<li class="rightside"><a href="../the-team.html">The team</a> &bull; <a href="http://192.168.20.226:3000/forums/ucp.php?mode=delete_cookies&amp;sid=4bd8ae158b723d4718c9e82d9902d47c">Delete all board cookies</a> &bull; All times are UTC - 8 hours [ <abbr title="Daylight Saving Time">DST</abbr> ]</li>
		</ul>

		<span class="corners-bottom"><span></span></span></div>
	</div>
	
	<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Group<br />Style by <a href="http://www.m-a-styles.de">Marc Alexander</a> &copy;
		<br /><br /><a href="http://www.phpbb-seo.com/" title="Search Engine Optimization"><img src="../images/phpbb-seo.png" alt="phpBB SEO"/></a><br />Time : 0.088s | 13 Queries | GZIP : Off
	</div>
</div>

</div>

<div>
	<a id="bottom" name="bottom" accesskey="z"></a>
	<img src="../cron.php%3Fcron_type=tidy_sessions&amp;sid=4bd8ae158b723d4718c9e82d9902d47c" width="1" height="1" alt="cron" />
	</div>
	</div>
<div class="nobottomgap"></div>
</div>
<!--- end of box border -->
</div></div>
<!-- -->
<div class="bottom-left"></div><div class="bottom-center"></div><div class="bottom-right"></div>
</div>
<!-- JQuery Pop Up --><!-- PM Popup --><!-- PM Popup end --><!-- Image Popup -->
<div id="popupImage">
	<p id="ImagePopup"></p>
	<a id="popupImageClose">x</a> 
</div>
<!-- Image Popup -->
<div id="backgroundPopup"></div> 
<!-- JQuery Pop Up END -->
</body>
</html>