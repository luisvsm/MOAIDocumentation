<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>Moai Forum &bull; View topic - Android 1.5 back button crash on 4.4</title>

<link href="styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" />
<link type="image/vnd.microsoft.icon" rel="shortcut icon" href="styles/proFormell/theme/images/favicon.ico">
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>Moai Forum</h1>
		<p>The mobile platform for pro game developers<br /><a href="index.html">/forums/</a></p>

		<h2>Android 1.5 back button crash on 4.4</h2>
		<p><a href="android-1-5-back-button-crash-on-4-4-t2561/index.html">/forums/android-1-5-back-button-crash-on-4-4-t2561/</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
		
			<div class="post">
				<h3>Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Mar 05, 2014 5:09 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">Has anyone else tested MOAI 1.5 on Android Kit Kat? I'm getting a crash when pressing the back button to close the app. I haven't set up a function to handle the back button, but in previous versions the app would close fine. I only have a Nexus 5 to test this on but I assume it happens on other phones as well if it isn't some build issue. It works fine on older Android versions for me.<br /><br />I built against android sdk version 10.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 07, 2014 4:27 am</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">Doing some investigation, here's an error from adb logcat<br /><br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="java" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; Force finishing activity com.<span style="color: #006633;">getmoai</span>.<span style="color: #006633;">samples</span><span style="color: #339933;">/</span>.<span style="color: #006633;">MoaiActivity</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>InputDispatcher<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> channel <span style="color: #0000ff;">'661d8108 com.getmoai.samples/com.getmoai.samples.MoaiActivity (server)'</span> ~ Consumer closed input channel or an error occurred. &nbsp;<span style="color: #006633;">events</span><span style="color: #339933;">=</span>0xd</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">E<span style="color: #339933;">/</span>InputDispatcher<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> channel <span style="color: #0000ff;">'661d8108 com.getmoai.samples/com.getmoai.samples.MoaiActivity (server)'</span> ~ Channel is unrecoverably broken and will be disposed<span style="color: #339933;">!</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>InputDispatcher<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> Attempted to unregister already unregistered input channel <span style="color: #0000ff;">'661d8108 com.getmoai.samples/com.getmoai.samples.MoaiActivity (server)'</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">I<span style="color: #339933;">/</span>WindowState<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> WIN DEATH<span style="color: #339933;">:</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awindow+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Window</span></a><span style="color: #009900;">&#123;</span>661d8108 u0 com.<span style="color: #006633;">getmoai</span>.<span style="color: #006633;">samples</span><span style="color: #339933;">/</span>com.<span style="color: #006633;">getmoai</span>.<span style="color: #006633;">samples</span>.<span style="color: #006633;">MoaiActivity</span><span style="color: #009900;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">I<span style="color: #339933;">/</span>WindowState<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> WIN DEATH<span style="color: #339933;">:</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Awindow+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Window</span></a><span style="color: #009900;">&#123;</span>661f43c8 u0 SurfaceView<span style="color: #009900;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">I<span style="color: #339933;">/</span>art &nbsp; &nbsp; <span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">181</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aprocess+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Process</span></a> <span style="color: #cc66cc;">19464</span> terminated by signal <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Aexception+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Exception</span></a> thrown during pause</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> android.<span style="color: #006633;">os</span>.<span style="color: #006633;">DeadObjectException</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at android.<span style="color: #006633;">os</span>.<span style="color: #006633;">BinderProxy</span>.<span style="color: #006633;">transact</span><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">Native</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Amethod+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">Method</span></a><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at android.<span style="color: #006633;">app</span>.<span style="color: #006633;">ApplicationThreadProxy</span>.<span style="color: #006633;">schedulePauseActivity</span><span style="color: #009900;">&#40;</span>ApplicationThreadNative.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">660</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityStack</span>.<span style="color: #006633;">startPausingLocked</span><span style="color: #009900;">&#40;</span>ActivityStack.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">761</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityStack</span>.<span style="color: #006633;">finishActivityLocked</span><span style="color: #009900;">&#40;</span>ActivityStack.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">2455</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityStack</span>.<span style="color: #006633;">finishTopRunningActivityLocked</span><span style="color: #009900;">&#40;</span>ActivityStack.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">2329</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityStackSupervisor</span>.<span style="color: #006633;">finishTopRunningActivityLocked</span><span style="color: #009900;">&#40;</span>ActivityStackSupervisor.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">2035</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityManagerService</span>.<span style="color: #006633;">handleAppCrashLocked</span><span style="color: #009900;">&#40;</span>ActivityManagerService.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">9543</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityManagerService</span>.<span style="color: #006633;">makeAppCrashingLocked</span><span style="color: #009900;">&#40;</span>ActivityManagerService.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">9436</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityManagerService</span>.<span style="color: #006633;">crashApplication</span><span style="color: #009900;">&#40;</span>ActivityManagerService.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">10081</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">ActivityManagerService</span>.<span style="color: #006633;">handleApplicationCrashInner</span><span style="color: #009900;">&#40;</span>ActivityManagerService.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">9632</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">W<span style="color: #339933;">/</span>ActivityManager<span style="color: #009900;">&#40;</span> &nbsp;<span style="color: #cc66cc;">757</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span> &nbsp; &nbsp; &nbsp; at com.<span style="color: #006633;">android</span>.<span style="color: #006633;">server</span>.<span style="color: #006633;">am</span>.<span style="color: #006633;">NativeCrashListener</span>$NativeCrashReporter.<span style="color: #006633;">run</span><span style="color: #009900;">&#40;</span>NativeCrashListener.<span style="color: #006633;">java</span><span style="color: #339933;">:</span><span style="color: #cc66cc;">86</span><span style="color: #009900;">&#41;</span></div></li><br /></ol></code></dd></dl><br /><br />Another thought, it could be related to me using the art runtime instead of dalvik.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 07, 2014 3:58 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">I found a &quot;fix&quot;<br /><br />MOAIAppAndroid.setListener(MOAIAppAndroid.BACK_BUTTON_PRESSED, function() os.exit() return true end)<br /><br />Only difference is that the screen goes black for a very short period because of the os.exi, but that's only on exit so it's not a big deal.<br /><br />*Edit: Apparently it's not fixed completely yet with this. For some reason when I attach a different function to the listener and call it in a different gamestate I get the same error.<br /><br />*Edit2: The only reason the os.exit() works is because it stops the entire program before it can finish the rest of the back button code I guess. That's why it doesn't work in my other game states, those don't use os.exit(). So the error is definitely related to the back button event, has to be something in the way moai handles it and/or 4.4 (with art). Should probably test to see if it happens with the dalvik runtime before continuing. MOAI 1.3 worked fine.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 07, 2014 7:10 pm</strong></div>
				<div class="author">by <strong>ezraanderson</strong></div>
				<div class="content">~<br />Edit the flowing to see if its working<br /><ul><li> <!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/blob/1.5-stable/ant/host-source/source/project/src/moai/LinearLayoutIMETrap.java">https://github.com/moai/moai-dev/blob/1 ... ETrap.java</a><!-- m --></li></ul>lines:61<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="java" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> Moai.<span style="color: #006633;">backButtonPressed</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; Log.<span style="color: #006633;">v</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;EGL&quot;</span>, <span style="color: #0000ff;">&quot;back button pressed&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> &nbsp;<span style="color: #666666; font-style: italic;">//IS THIS BEING PRINTED TO LOGCAT</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #009900;">&#125;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Mar 07, 2014 7:32 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">Well the back buttong prints were definitely being printend in logcat, I saw the events for down and up.<br /><br />In the mean time I found a temporary fix.. I'm really not sure why this works or what kind of effects it has, but it works on both my devices.<br /><br />I commented out the the following function in LinearLayoutIMETrap.java<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">public boolean dispatchKeyEventPreIme <span class="br0">&#40;</span> KeyEvent event <span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><br /></ol></code></dd></dl><br /><br />In my main menu I setup a handler for back button:<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">MOAIAppAndroid.setListener<span class="br0">&#40;</span>MOAIAppAndroid.BACK_BUTTON_PRESSED, function<span class="br0">&#40;</span><span class="br0">&#41;</span> os.exit<span class="br0">&#40;</span><span class="br0">&#41;</span> return true end<span class="br0">&#41;</span></div></li><br /></ol></code></dd></dl><br /><br />And in my other game states I make it change gamestates. It doesn't crash anymore and closes now, but I'm sure killing the app like this is not good practice?<br /><br />The error definitely has to do with that function though.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Mar 15, 2014 3:07 am</strong></div>
				<div class="author">by <strong>halfnelson</strong></div>
				<div class="content"><!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/pull/859">https://github.com/moai/moai-dev/pull/859</a><!-- m --><br /><br />I think this might be the problem. It happens on dalvik too, just not as loudly.<br />Could you give this a go and let us people on 4.1 or earlier know?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun Mar 16, 2014 12:09 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">Sorry I haven't been able to do much work the past 2 days but I will be testing this hopefully today. <br /><br />I have also encountered a serious battery draining bug with moai that happens on both kitkat and older versions when you minimize the app instead of closing it. Only kitkat seems to accurately show it in the battery usage stats, on older versions the batter usage % of the app doesn't go up but it is the one causing it. The app is consuming a lot of cpu time when minimized. <br /><br />Now this could be related to me commentating out the java function dispatchKeyEventPreIme. I am running a test with an old 1.3 moai build now. I hope it is because I don't remember seeing this before.<br /><br />*Edit; It doesn't seem to happen on 1.3, building a new 1.5 for Android now to see if back button is fixed.<br /><br />*Edit 2: Back button crash seems fixed, very nice! Hopefully the battery drain is gone too.<br /><br />*Edit 3: Back button behavior seems different, it's calling the back button pressed function on action_down, should be action_up I think?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun Mar 16, 2014 2:27 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">Fixed the weird back button behavior. For some reason the custom back button function was being called in moaiactivity.java and lienarlayoutimetrap.java<br /><br />My changes:<br /><br />Changed thisfunction in MoaiActivity.java<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="java" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">//----------------------------------------------------------------//</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> onKeyDown <span style="color: #009900;">&#40;</span> <span style="color: #000066; font-weight: bold;">int</span> keyCode, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Akeyevent+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">KeyEvent</span></a> event <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MoaiLog.<span style="color: #006633;">i</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;MoaiActivity onKeyDown, keycode &quot;</span> <span style="color: #339933;">+</span> keyCode <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; event: &quot;</span> <span style="color: #339933;">+</span> event <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #666666; font-style: italic;">/*</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( keyCode == KeyEvent.KEYCODE_BACK ) {</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( Moai.backButtonPressed ()) {</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return true;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #666666; font-style: italic;">&nbsp; &nbsp; &nbsp; &nbsp; */</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000000; font-weight: bold;">super</span>.<span style="color: #006633;">onKeyDown</span> <span style="color: #009900;">&#40;</span> keyCode, event <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #009900;">&#125;</span></div></li><br /></ol></code></dd></dl><br /><br />Changed this if conditional in LinearLayoutIMETrap.java (function dispatchKeyEventPreIme) so it only triggers on back button up.<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=17&amp;t=2561&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="java" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> imm.<span style="color: #006633;">isActive</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> event.<span style="color: #006633;">getKeyCode</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Akeyevent+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">KeyEvent</span></a>.<span style="color: #006633;">KEYCODE_BACK</span> <span style="color: #339933;">&amp;&amp;</span> event.<span style="color: #006633;">getAction</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Akeyevent+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky"><span style="color: #003399;">KeyEvent</span></a>.<span style="color: #006633;">ACTION_UP</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />Once my battery is fully charged I will be testing the battery drain.<br /><br />Should this be pushed to 1.5? I've not heard anyone else complain, maybe it's just me who has problems with it? But it seems weird to be calling this from 2 places...<br /><br />*Edit: I guess this might also have been one of the causes of the back button crash? It being called twice?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Android 1.5 back button crash on 4.4</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun Mar 16, 2014 3:38 pm</strong></div>
				<div class="author">by <strong>Motig</strong></div>
				<div class="content">T-t-t-triple post!<br /><br />But bad news, the battery drain is still present. <br /><br />*Edit: I've created a new thread: <a href="moai-1-5-android-battery-drain-t2576/index.html" class="postlink">/forums/moai-1-5-android-battery-drain-t2576/</a><br /><br />*Edit 2: I've also posted my solution here: <!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/pull/859">https://github.com/moai/moai-dev/pull/859</a><!-- m --> <br />But it seems it might not be a correct fix.</div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>