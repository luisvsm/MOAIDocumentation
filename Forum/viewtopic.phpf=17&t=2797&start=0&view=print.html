<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>Moai Forum &bull; View topic - Anyone else had problems with &quot;stuck&quot; touches on Android?</title>

<link href="styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" />
<link type="image/vnd.microsoft.icon" rel="shortcut icon" href="styles/proFormell/theme/images/favicon.ico">
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>Moai Forum</h1>
		<p>The mobile platform for pro game developers<br /><a href="index.html">/forums/</a></p>

		<h2>Anyone else had problems with &quot;stuck&quot; touches on Android?</h2>
		<p><a href="anyone-else-had-problems-with-stuck-touches-on-android-t2797/index.html">/forums/anyone-else-had-problems-with-stuck-touches-on-android-t2797/</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
		
			<div class="post">
				<h3>Anyone else had problems with &quot;stuck&quot; touches on Android?</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Sep 10, 2014 3:39 pm</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content">Very rarely I get a touch in my game while playing on my nexus pad that just gets stuck (I have some virtual buttons that you can hold down) until I touch somewhere again and then it releases. Anyone experienced anything similar? I have yet to see it on any of my iOS devices.<br /><br />I have also noticed I sometimes get a MOVE event for a pointer ID without having a corresponding DOWN event for that pointer before - but this is not what causes the problem I believe. Also something I have yet to see on any iOS device.<br /><br />I have looked through the Android code down through to the touch sensor and have not been able to spot anything fishy, it all looks very good.<br /><br />Anyway I have now made an alternative implementation bypassing all inputmanager/touchsensor stuff to just get to the location of the current touches. Basicly it just doesn't care about event codes or anything and just gets the pointer locations from the latest MotionEvent. If the problem disappears I'll make sure to post about the workaround.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Sep 10, 2014 4:58 pm</strong></div>
				<div class="author">by <strong>naturally</strong></div>
				<div class="content">I have experienced this too... but like you said, it's really rare, and never caused a major problem, and I've never been able to reproduce it consistently.  It's been a while since I look into it, but I think my solution was to clear all active inputs when user opened a menu, giving them a way to get out of it if they were stuck.  But it's been a lot of months since I've encountered this, so I figured I must have fixed my own faulty code.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Sep 10, 2014 7:46 pm</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content">Yeah I cant rule out that its my own code thats causing it <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /> we will see what happens, gotta be patient with these rare occuring ones</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Wed Sep 10, 2014 10:44 pm</strong></div>
				<div class="author">by <strong>naturally</strong></div>
				<div class="content">I'm inclined to think it's an Android glitch that went away after an upgrade.  <br /><br />What version of Android do you get this problem?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Sep 11, 2014 5:41 am</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content"><blockquote><div><cite>naturally wrote:</cite>I'm inclined to think it's an Android glitch that went away after an upgrade.  <br /><br />What version of Android do you get this problem?</div></blockquote><br /><br />Unfortunately its a very new version! 4.4 something.<br /><br />But it can also be device specific I guess, Google Nexus 7. But I'm certain that my lua code sometimes gets a TOUCH_MOVE event for a pointer id that did not yet receive a TOUCH_DOWN event. This has happened on many Android devices. So something isn't perfect with the touch handling on Android. Still not sure if this happens on iOS!</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Sep 12, 2014 12:45 am</strong></div>
				<div class="author">by <strong>naturally</strong></div>
				<div class="content">If a MOVE event comes without a DOWN event, couldn't you just react to it as if it were a DOWN event?  Since it would be a new idx value...</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Sep 12, 2014 1:36 am</strong></div>
				<div class="author">by <strong>halfnelson</strong></div>
				<div class="content"><!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/blob/1.5-development/ant/libmoai/jni/src/moai.cpp#L56">https://github.com/moai/moai-dev/blob/1 ... ai.cpp#L56</a><!-- m --><br />so android queues them up in some kind of lockingqueue waiting for the next sim.update, It looks like there is a limit to the number of events it can queue up before each update (100), and the code for dealing with going over the limit is to throw the entire queue away!?, at least that is how I read the code.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Sep 12, 2014 1:38 am</strong></div>
				<div class="author">by <strong>halfnelson</strong></div>
				<div class="content">It also looks like touch cancel might be commented out? <!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/blob/1016b53e85f73094f2b5bef65b6a15f098429b9b/ant/host-source/source/project/src/app/MoaiView.java#L96">https://github.com/moai/moai-dev/blob/1 ... w.java#L96</a><!-- m --></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri Sep 12, 2014 5:23 am</strong></div>
				<div class="author">by <strong>Vavius</strong></div>
				<div class="content">I've experienced that too. It's Android only issue. <br />AFAIK, the reason is that android can send DOWN, MOVE and UP events all in one frame (and sometimes in wrong order - like MOVE after UP). This breaks MOAIInputMgr. I've done some monkey patching in MOAIInputMgr - it helped a bit, but problem wasn't solved completely. <br />Patrick had reworked input handling, maybe he experienced that bug too =)</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Sep 15, 2014 7:42 am</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content"><blockquote><div><cite>naturally wrote:</cite>If a MOVE event comes without a DOWN event, couldn't you just react to it as if it were a DOWN event?  Since it would be a new idx value...</div></blockquote><br /><br />Yeah thats what I do but the stuck stuff is the real problem</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Sep 15, 2014 7:44 am</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content"><blockquote><div><cite>halfnelson wrote:</cite>https://github.com/moai/moai-dev/blob/1.5-development/ant/libmoai/jni/src/moai.cpp#L56<br />so android queues them up in some kind of lockingqueue waiting for the next sim.update, It looks like there is a limit to the number of events it can queue up before each update (100), and the code for dealing with going over the limit is to throw the entire queue away!?, at least that is how I read the code.</div></blockquote><br /><br /><blockquote><div><cite>halfnelson wrote:</cite>It also looks like touch cancel might be commented out? <!-- m --><a class="postlink" href="https://github.com/moai/moai-dev/blob/1016b53e85f73094f2b5bef65b6a15f098429b9b/ant/host-source/source/project/src/app/MoaiView.java#L96">https://github.com/moai/moai-dev/blob/1 ... w.java#L96</a><!-- m --></div></blockquote><br /><br />I don't think it ever will hit 100 so no problem there. I actually implemented touch cancel for android, but it didn't make any difference in these cases. I think it's when you lock the screen and stuff. Or you app gets minimized maybe.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Sep 15, 2014 7:44 am</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content"><blockquote><div><cite>Vavius wrote:</cite>I've experienced that too. It's Android only issue. <br />AFAIK, the reason is that android can send DOWN, MOVE and UP events all in one frame (and sometimes in wrong order - like MOVE after UP). This breaks MOAIInputMgr. I've done some monkey patching in MOAIInputMgr - it helped a bit, but problem wasn't solved completely. <br />Patrick had reworked input handling, maybe he experienced that bug too =)</div></blockquote><br /><br />Thanks for the feedback! Yeah I saw Patrick was doing some stuff, maybe we will get to his code eventually <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Anyone else had problems with &quot;stuck&quot; touches on Android</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Sep 15, 2014 8:08 am</strong></div>
				<div class="author">by <strong>JDance</strong></div>
				<div class="content">So far my new code for getting the touches straight from the latest MotionEvent without any regard for event order seems to work pretty well. This cannot be used for event handling but it can be used to query current touches. I will post the code but I had a crash in it probably due to some race condition with touches. So I have tried to make it thread safe now by synchronizing in Java but I have not yet played my game enough to confirm that its safe.<br /><br /><!-- m --><a class="postlink" href="https://github.com/JDaance/moai-gettouches-android">https://github.com/JDaance/moai-gettouches-android</a><!-- m --></div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>