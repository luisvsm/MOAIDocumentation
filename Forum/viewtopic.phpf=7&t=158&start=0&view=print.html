<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>Moai Forum &bull; View topic - MOAITileDeck2D and non pow2 images in macosx and iphone behaves in different ways</title>

<link href="styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" />
<link type="image/vnd.microsoft.icon" rel="shortcut icon" href="styles/proFormell/theme/images/favicon.ico">
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>Moai Forum</h1>
		<p>The mobile platform for pro game developers<br /><a href="index.html">/forums/</a></p>

		<h2>MOAITileDeck2D and non pow2 images in macosx and iphone behaves in different ways</h2>
		<p><a href="moaitiledeck2d-and-non-pow2-images-in-macosx-and-iphone-behaves-in-different-ways-t158/index.html">/forums/moaitiledeck2d-and-non-pow2-images-in-macosx-and-iphone-behaves-in-different-ways-t158/</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
		
			<div class="post">
				<h3>MOAITileDeck2D and non pow2 images in macosx and iphone behaves in different ways</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Oct 22, 2011 8:13 am</strong></div>
				<div class="author">by <strong>stefano.linguerri</strong></div>
				<div class="content">We found that the MOAITileDeck2D in macosx and iphone behaves in different ways:
<br />
<br />We used the code of anim-flipbook with a little change:
<br />
<br />MOAISim.openWindow("test", 320, 480)
<br />
<br />viewport = MOAIViewport.new()
<br />viewport:setSize(320, 480)
<br />viewport:setScale(320, 480)
<br />
<br />layer = MOAILayer2D.new()
<br />layer:setViewport(viewport)
<br />MOAISim.pushRenderPass(layer)
<br />
<br />tileLib = MOAITileDeck2D.new()
<br />image = MOAIImage.new()
<br />image:load("images/lilia.png", MOAIImage.TRUECOLOR + MOAIImage.PREMULTIPLY_ALPHA)
<br />
<br />
<br />tileLib:setTexture(image)
<br />-- the tiles are 3 col x 4 rows
<br />tileLib:setSize(3, 4)
<br />
<br />-- bigger area to show the frame
<br />tileLib:setRect(-32, -32, 32, 32)
<br />
<br />prop = MOAIProp2D.new()
<br />prop:setDeck(tileLib)
<br />layer:insertProp(prop)
<br />
<br />curve = MOAIAnimCurve.new()
<br />
<br />curve:reserveKeys(5)
<br />curve:setKey(1, 0.00, 1, MOAIEaseType.FLAT)
<br />curve:setKey(2, 0.25, 2, MOAIEaseType.FLAT)
<br />curve:setKey(3, 0.50, 3, MOAIEaseType.FLAT)
<br />curve:setKey(4, 0.75, 4, MOAIEaseType.FLAT)
<br />curve:setKey(5, 1.00, 1, MOAIEaseType.FLAT)
<br />
<br />anim = MOAIAnim:new()
<br />anim:reserveLinks(1)
<br />anim:setLink(1, curve, prop, MOAIProp2D.ATTR_INDEX)
<br />anim:setMode(MOAITimer.LOOP)
<br />anim:start()
<br />
<br />The sprite used is a "Final Fantasy old school" like
<br />
<br />We used a 96wx128h image as spritesheet, non quad pow2 image. It works fine in macosx moai build but it doesn't work in the iphone simulator (black square in the center, we used a background image for debug)
<br />
<br />If we do image:padToPow2() the image shows up but (as expeted) all frames are "shifted"
<br />
<br />As I know we need to pow2 normal image to show up them, do we have to trick with pow2 and UV to do a workaround on iphone?
<br />
<br />Any hint?
<br />
<br />thanks in advance</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>MOAITileDeck2D and non pow2 images in macosx and iphone behaves in different ways</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat Oct 22, 2011 3:44 pm</strong></div>
				<div class="author">by <strong>patrick</strong></div>
				<div class="content">The UVs would need to be scaled to respect the proportional change - that's why you're seeing a 'shift.' If you detect the iPhone case before you call tileLib:setSize, you can use an extended version of that function to align your image grid over a subset of the bigger texture. You can actually do some pretty wild things with the extended set size including selecting an arbitrary source grid from UV space and adding padding between tiles.
<br />
<br />That said, best practice IMHO (and what we do here) is to use the common denominator: all square, power of two textures (and as few of those as possible). That will make sure you can run on any GL hardware. If you pre-pad, empty spaces on images compress out and won't bloat up your app bundle. It will also help your load time. For our projects here we like to use big 1024x1024 textures and pack everything we can into them. All characters one one big sprite sheet, for example.</div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>