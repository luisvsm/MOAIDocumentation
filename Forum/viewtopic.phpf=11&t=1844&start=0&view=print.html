<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="robots" content="noindex" />

<title>Moai Forum | The mobile platform for pro game developers &bull; View topic - [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</title>

<link href="styles/proFormell/theme/print.css" rel="stylesheet" type="text/css" />
<link type="image/vnd.microsoft.icon" rel="shortcut icon" href="styles/proFormell/theme/images/favicon.ico">
</head>

<body id="phpbb">
<div id="wrap">
	<a id="top" name="top" accesskey="t"></a>

	<div id="page-header">
		<h1>Moai Forum | The mobile platform for pro game developers</h1>
		<p>The mobile platform for pro game developers<br /><a href="index.html">/forums/</a></p>

		<h2>[CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h2>
		<p><a href="easy-to-use-ios-host-with-landscape-and-gyro-t1844/index.html">/forums/easy-to-use-ios-host-with-landscape-and-gyro-t1844/</a></p>
	</div>

	<div id="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>2</strong></div>
		
			<div class="post">
				<h3>[CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri May 10, 2013 3:57 pm</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">Hello,<br />I wanted to share an iOS template that I've been working on, that fixes a couple of things from the iOS host that's distributed with Moai, and has a couple of other features. Most notably, I think it's much easier to use than the default iOS host that comes with Moai, because you can basically just copy paste it and add your code.<br /><br /><br /><span style="font-weight: bold">FEATURES OF THIS IOS HOST</span><br />(step by step instructions below)<br />- This host is a <span style="font-weight: bold">ready-to-go</span> solution that you can just duplicate and add your Lua code.<br />- <span style="font-weight: bold">Landscape or Portrait orientation</span>, whatever you prefer.<br />- <span style="font-weight: bold">Gyroscope support</span> (quick fix without touching libmoai), that you can optionally turn on and it will replace accelerometer (more info below)<br />- <span style="font-weight: bold">Turn on/off location services</span> via one flag only.<br /><br />The host should work with an out-of-the-box Moai, no need to touch source code<br />(that's why a few compromises have been made, see below)<br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">EXAMPLES</span><br /><br />There are two Lua examples that come with the host (find it in /lua/ folder).<br />To run a particular example, rename its filename to &quot;moai.lua&quot; and run the project from XCode.<br />You can also run Example 1 in your desktop simulator.<br />For details about how examples work with host, see step by step guilde below.<br /><br /><span style="font-weight: bold">Example 1: simple_landscape.lua</span><br /><br />Simple example that doesn't require any high-level framework, this example shows how to set up landscape mode in Lua, and how to create viewport in such a way that it always fill the entire device screen regardless of the device used (tested on iOS devices).<br /><br />Here are the results on various devices simulated via OSX host.<br />Please note how the main view area we defined as 640x960 pixels is always centered on screen (marked by 32x32grid), but actual viewport is full screen (you'll see that when you run the code)<br /><img src="http://www.no-sheet.com/temp/moai_forum/simple_landscape.jpg" alt="Image" /><br /><br /><br /><br /><br /><span style="font-weight: bold">Example 2: simple_gyro.lua</span><br /><br />This example wires up a level event to rotate a quad in 3D.<br /><br />A photo of a sample in action:<br /><img src="http://www.no-sheet.com/temp/moai_forum/gyroscope.jpg" alt="Image" /><br /><br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">STEP BY STEP GUIDE</span><br /><br /><span style="font-weight: bold">1) Download host</span><br />The download link:<br /><a href="http://no-sheet.com/temp/moai_forum/ios_host.zip" class="postlink">http://no-sheet.com/temp/moai_forum/ios_host.zip</a><br /><br /><span style="font-weight: bold">2) Unpack and open moai.xcodeproj</span><br />Unpack the files (anywhere you like), you will see a folder called<br />_IOS_HOST_TEMPLATE.<br /><br /><br /><span style="font-weight: bold">3) Link binary with libraries</span><br /><br />Now you need to find the place where you downloaded and unpacked Moai<br />(from getmoai.com website), especially two folders are important:<br />/include/<br />/lib/ios/universal/<br /><br />Select MOAISample target &gt; Build Phases &gt; Link Binary With Libraries,<br />Click on [+] button (Add Items) at the bottom left to add libraries:<br /><img src="http://www.no-sheet.com/temp/moai_forum/link-lib_1.gif" alt="Image" /><br /><br />Click on [Add Other...] button when a window pops up:<br /><img src="http://www.no-sheet.com/temp/moai_forum/link-lib_2.gif" alt="Image" /><br /><br />Now look for the /lib/ios/universal/ folder of your Moai installation<br />and select all the library files:<br /><img src="http://www.no-sheet.com/temp/moai_forum/link-lib_3.gif" alt="Image" /><br /><br /><span style="font-weight: bold">4) Check for missing system frameworks</span><br />If you are using different version of the XCode than the v4.6, it is very possible that some (or all) of the system frameworks are missing (this means that your version of XCode by default builds for different version for iOS). Here's how to check if XCode can't find the system frameworks:<br /><img src="http://www.no-sheet.com/temp/moai_forum/frameworks.gif" alt="Image" /><br /><br />If the frameworks are missing, add them through the same interface as<br />linking binary with libraries in the previous step, only instead of<br />[Add Other...], select the frameworks that are missing from the list:<br /><img src="http://www.no-sheet.com/temp/moai_forum/frameworks_2.gif" alt="Image" /><br /><br /><br /><span style="font-weight: bold">5) Set up paths to Moai libraries and headers to be included</span><br /><br />Remember the /include/ and /universal/ folders I mentioned in the previous step?<br />We'll use them now.<br /><br />Click on Project &gt; Build Setting &gt; (+) Add Build Setting &gt; Add User-Defined Setting<br />Name the setting: MOAI_DIR_INCLUDE in the left field, and then in the right field<br />write down the absolute or relative path to /include/ folder of your Moai installation.<br /><br />Then do the above again to add another user defined setting.<br />Call it: MOAI_DIR_LIB and in the right text field write down the absolute or relative<br />path to /universal/ folder of your Moai installation.<br /><br />Here's a screenshot that shows how to do set build settings	:<br /><img src="http://www.no-sheet.com/temp/moai_forum/build_settings.gif" alt="Image" /><br /><br /><br /><br />At this point, your iOS host is ready and you should be able to compile and<br />run it on device without any problem.<br /><br />You will likely need to do steps 1-5 only once, after you first download the host template from the web. After you've done this once, in order to prepare the new iOS project with this template, just duplicate entire _IOS_HOST_TEMPLATE and save it whenever you like (it's ok to rename the folder name from _IOS_HOST_TEMPLATE to anything else), and then add your own Lua code.<br /><br /><br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">How To Add Your Lua Code</span><br />In order to execute your lua code, just replace the content of<br />/lua folder with your code. No need to touch anything in XCode.<br /><br /><br />Great, now we can customize stuff:<br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">How To Set Up Landscape or Portrait Mode</span><br /><br />Disclaimer:<br />This host can only handle landscape or only portrait mode.<br />If you want an app that should work in both landscape and portrait modes,<br />some changes to the Moai source code need to be done, which could be<br />a topic for a separate article.<br /><br />Landscape mode is already set by default in this iOS host template, but you should know there are 2 steps that you need to take (in a case you want to switch from/to Portrait mode):<br /><br /><span style="font-weight: bold">1) Select desired orientations from target sumamry</span><br />Select MOAISample target &gt; Summary tab, as in following screenshot:<br /><img src="http://www.no-sheet.com/temp/moai_forum/land_target_summary.gif" alt="Image" /><br /><br />Step 1 and 2 &gt; Select landscape orientations (and unselect portrait ones) in iPhone/iPod and iPad deployment info.<br />Step 3 &gt; Now that we are there, you probably want to change Bundle Identifier to your own AppID (see tutorials on provisionin profiles, appIDs and other Apple-related stuff that make head hurt)<br /><br />If you want portrait orientations, you should select portrait orientations here.<br /><br /><span style="font-weight: bold">2) Add IS_LANDSCAPE flag</span><br />This is a little thing we do to let the compiler know to compile only pieces of code that relate to landscape orientations.<br />Here's how to add the flag in question (and many others that we will use for other customizations):<br /><img src="http://www.no-sheet.com/temp/moai_forum/linker_flag.gif" alt="Image" /><br />1- Select MOAISample project<br />2- Build Settings tab<br />3- Type &quot;other C&quot; in search box to find the field we need ( <span style="font-weight: bold">Other C Flags</span>)<br />4- Double click the values of Other C Flags to open a popup<br />5- Click [+] button and write the following: &quot;-DIS_LANDSCAPE&quot;<br />(without quote marks, and please note that D letter is not a mistake)<br /><br />Likewise, if you want Portrait orientation, delete this line (-DIS_LANDSCAPE).<br /><br /><br />Now that these steps are done, you can go back to <span style="font-weight: bold">Example 1</span> and see how to handle Lua and viewport scale in order to work well in landscape mode.<br /><br /><br /><br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">How To Turn On/Off Gyroscope</span><br /><br />Disclaimer:<br />Since this host is made to work with distribution version of Moai (which doesn't support gyroscope out of the box), some compromises are made to avoid having to edit Moai source code. This in effect mean that the gyroscope event from system is wired to MOAIInputMgr.device.level ( the event that is normally used for tracking accelerator). This is a quick hack that will allow you to use gyroscope, but at the expense of not having accelerator events.<br />For the right way to do gyroscope, a new Moai event type with its own AKU call needs to be created (I can provide source code if someone needs it).<br /><br /><span style="font-weight: bold">Important:</span><br />This host uses gyroscope by default. However, if you are NOT going to use gyroscope in your application, it is very recommended to turn it off, because using gyroscope makes the battery go out faster.<br /><br /><br />In order to turn on gyroscope we need to add the USE_GYRO linker flag.<br />Go through the same steps as in the previous section and add the following line:<br />-DUSE_GYRO<br /><br />Likewise, if you want to turn gyro off, just delete that line.<br /><br /><span style="font-weight: bold">Gyroscope in Lua</span><br />Use the same code you would use for tracking accelerator to track the gyroscope. As I noted above, once you set -DUSE_GYRO flag, iOS host will no longer send accelerator gravity.x, .y and .z values, but gyroscope altitude roll, pitch and yaw instead.<br />Beware that roll, pitch and yaw values and the way they will affect the view greatly depends on device orientation, and it's not a trivial matter at all doing everything right.<br /><br />Example  2 is just a proof of concept, but since with out-of-the-box Moai we're not able to read device orientation, we can't correctly map roll, pitch and yaw to cameras' x, y and z rotation.<br /><br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">How To Turn On Location Services</span><br /><br />Now if you have been annoyed by the pop-up asking you permission to use location services, it is turned off by default in this host. However, if you want to use GPS/Compass, you'd want to turn it on.<br /><br />It's as easy as adding USE_LOCATION linker flag.<br />Go through the same steps as in the previous sections to add the following line to Other C Flags:<br />-DUSE_LOCATION<br /><br /><br /><br /><br />--------------------------------------------------------------------<br /><span style="font-weight: bold">How To Turn On UNTZ Sound System</span><br /><br />UNTZ is turned on by default in this host, so this section should better be called &quot;How to turn OFF...&quot;.<br />It's all done via &quot;Other C Flags&quot; again, and to disable UNTZ just delete the following line:<br />-DUSE_UNTZ<br /><br /><br />Ok, this is my first stab at a simple modifiable host, looking forward to hear your opinions and improvements!<br />Cheers,<br />Neko</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat May 11, 2013 10:10 am</strong></div>
				<div class="author">by <strong>ibisum</strong></div>
				<div class="content">You, sir, have attained God status in my opinion.  Very nicely documented, well done, and thank you very much!  I have nothing to add - you have been very complete in your details.  <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sat May 11, 2013 5:44 pm</strong></div>
				<div class="author">by <strong>rhoster</strong></div>
				<div class="content"><blockquote><div><cite>ibisum wrote:</cite>You, sir, have attained God status in my opinion.  Very nicely documented, well done, and thank you very much!  I have nothing to add - you have been very complete in your details.  <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div></blockquote><br /><br />+1</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun May 12, 2013 3:36 am</strong></div>
				<div class="author">by <strong>hatenames</strong></div>
				<div class="content">Words cannot describe your level of awesomeness =]</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun May 12, 2013 8:43 am</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">thanks, everyone. <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /><br />@ibisum, i think you should take a selected number of your posts in these forums and publish in a form of a poetry book <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Sun May 19, 2013 9:40 pm</strong></div>
				<div class="author">by <strong>rhoster</strong></div>
				<div class="content">Question about the landscape portrait thing.  We use two base layouts for our game based on the apsect ratio of the device:<br /><br />2:3 (mobile) portrait orientation<br />4:3 (tablet) landscape orientation<br /><br />What I've been doing up to this point is just rotate the Viewport for the tablet layout (because it is set to 3:4 by default since it's portrait).  Ideally, I'd be able to set the phones to use portrait and the tablets to use landscape (which you can do in Xcode).  My question if you know whether or not this will be an issue in MOAI based on your experiences in setting up landscape.<br /><br />The main issue I have with our current setup is that it doesn't flip-flop using the ios gryo properly (because it's rotated 90 degrees), and can act a bit goofy when you're holding the tablet. Thanks!</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 3:50 pm</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">@rhoster,<br />So far I didn't try to use different orientation for different devices. I am not sure from what you ask what the exact problem you have with your current setup. I assume you refer to your problem that when you rotate device 180 degrees (ie. from landscape left to landscape right), the openGL view doesn't rotate, but stays in place (which results in upside/down user experience).<br />If that's the case, the problem is that either Target Summary icons for both landscape orientaitons are not checked, or  MoaiVC.mm doesn't return TRUE in shouldAutorotateToInterfaceOrientation: method for some orientations).<br /><br />On host-side, you need to make sure that the application is allowed to change orientation, and is not locked into only one landscape or only one portrait, and make it conditional for different device type (iPad or iPhone). This is done via Target Summary icons, and also for iOS &lt; 6.0 you need to check the MoaiVC.mm shouldAutorotateToInterfaceOrientation <img src="images/smilies/icon_e_sad.gif" alt=":(" title="Sad" /> UIInterfaceOrientation ) method, and make sure that the TRUE is being returned for landscape orientations if iPad is the current device, or for portrait orientations if iPhone/iPod is the case (I'm not sure how to check the device in iOS, btw, but I'm sure you can easily google this). Something like:<br /><br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=11&amp;t=1844&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="c" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>device_is_not_iPad<span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span> interfaceOrientation <span style="color: #339933;">==</span> UIInterfaceOrientationPortrait <span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span> interfaceOrientation <span style="color: #339933;">==</span> UIInterfaceOrientationPortraitUpsideDown <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #b1b100;">return</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span> intefaceOrientation <span style="color: #339933;">==</span> UIInterfaceOrientationLandscapeLeft <span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <span style="color: #009900;">&#40;</span> intefaceOrientation <span style="color: #339933;">==</span> UIInterfaceOrientationLandscapeRight <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br />Please note that the above code is deprecated on iOS6 but still necessary for older versions.<br /><br />There's another piece you need to check in MoaiVC.mm, and it's updateOrientation method that is called by the system every time user changes orientation.<br />Currently the MoaiVC.mm that ships with Moai has the implementation of of updateOrientation that I find problematic to work with, because it kinda messes up the touch input coordinates (it resizes openGL window - which is cool, but without taking into account that the input touch coordinates has changed too). Since your application will never switch between landscape and portrait (it will only need , I suggest you delete all code inside of this method.<br /><br />What you want to do is make a check when application starts and before the openGL window is created, to see if application runs on iPad or iPhone. Then you want to create openGL window either horizontal or portrait one, depending on the device.<br />This should be done in MOAIAppDelegate.mm, method didFinishLaunchingWithOptions().<br />You may want to check out my host code, and check the above file/method.<br />Just below the line:<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=11&amp;t=1844&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="c" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #009900;">&#91;</span> application setStatusBarHidden<span style="color: #339933;">:</span><span style="color: #000000; font-weight: bold;">true</span> <span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></li><br /></ol></code></dd></dl><br />add your check and make it global, for example store it in a boolean called APP_RUNS_ON_IPAD.<br />Then you should simply replace all my flag conditionals with your own if/else checks based on APP_RUNS_ON_IPAD.<br />So instead of:<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=11&amp;t=1844&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="c" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;<span style="color: #339933;">#ifdef IS_LANDSCAPE</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; CGRect viewBounds<span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; viewBounds.<span style="color: #202020;">origin</span>.<span style="color: #202020;">x</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span> UIScreen mainScreen <span style="color: #009900;">&#93;</span>.<span style="color: #202020;">bounds</span>.<span style="color: #202020;">origin</span>.<span style="color: #202020;">x</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; viewBounds.<span style="color: #202020;">origin</span>.<span style="color: #202020;">y</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span> UIScreen mainScreen <span style="color: #009900;">&#93;</span>.<span style="color: #202020;">bounds</span>.<span style="color: #202020;">origin</span>.<span style="color: #202020;">y</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; viewBounds.<span style="color: #202020;">size</span>.<span style="color: #202020;">width</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span> UIScreen mainScreen <span style="color: #009900;">&#93;</span>.<span style="color: #202020;">bounds</span>.<span style="color: #202020;">size</span>.<span style="color: #202020;">height</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; viewBounds.<span style="color: #202020;">size</span>.<span style="color: #202020;">height</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span> UIScreen mainScreen <span style="color: #009900;">&#93;</span>.<span style="color: #202020;">bounds</span>.<span style="color: #202020;">size</span>.<span style="color: #202020;">width</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; </div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; mMoaiView <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span> MoaiView alloc <span style="color: #009900;">&#93;</span> initWithFrame<span style="color: #339933;">:</span>viewBounds <span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #339933;">#else</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; mMoaiView <span style="color: #339933;">=</span> <span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span> MoaiView alloc <span style="color: #009900;">&#93;</span> initWithFrame<span style="color: #339933;">:</span><span style="color: #009900;">&#91;</span> UIScreen mainScreen <span style="color: #009900;">&#93;</span>.<span style="color: #202020;">bounds</span> <span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #339933;">#endif</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />you'll have:<br /><dl class="codebox"><dt>Code: <a href="viewtopic.php%3Ff=11&amp;t=1844&amp;start=0&amp;view=print.html#" onclick="selectCode(this); return false;">Select all</a></dt><dd><code style="line-height: 30%;"><ol class="c" style="font-family:monospace;"><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;"><span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>APP_RUNS_ON_IPAD<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp; &nbsp; &nbsp; &nbsp; CGRect viewBounds<span style="color: #339933;">;</span></div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">etc...</div></li><br /><li style="line-height: 50%;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">&nbsp;</div></li><br /></ol></code></dd></dl><br /><br />The upside of this approach is that you don't need to rotate view 180 degrees, because host will create an openGL view of the correct size for you.<br /><br />Hum... maybe this was all confusing. Hope I pointed you to a good direction, let me know if I've been off target here <img src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 4:00 pm</strong></div>
				<div class="author">by <strong>rhoster</strong></div>
				<div class="content">This is awesome, thanks for the info - I'll be using this as reference when I try testing it out.  The problem is that the gyro gets tied to the orientation of the device in xcode (so if it's set to portrait, when you flip the phone upside down, it will do a 180 degree flip).  The problem is that you get some funky behavior when you rotate only 90 degrees.  This is due to the fact that the orientation for the flipping doesn't correspond to what is actually on the screen.  One solution is to just prevent any orientation flipping in xcode.  I'll post here with what I end up doing.  Thanks again,</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 4:41 pm</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">If you talk about the actual gyro values (ie. roll, pitch, yaw returned from CMAttitude), yes it's quite a mess as actually they are **not** tied to orientation.  So in effect if you have an iPhone in landscape left at a certain angle and then rotate it to landscape right, for example the yaw value will jump 180 degrees, the pitch will flip around 90 degrees and only the roll will not change. This is in a way natural, because the top of the device will be pointing to completely other side of the world, and therefore the values are different although for end user they are kinda holding the device the same way (ie. user might be holding the device, resting it on a table for a moment and picking it up inadveringly rotating it to another orientation, and suddenly everything will look wrong even though for user he is still holding the device the same way). Therefore same &quot;real life angles&quot; give different gyro values at different orientations, and every time you read gyro you should compensate manually so that the values of roll/pitch/yaw correspond well to your in-game world, depending not on the system orientation but on actual acelerometer angles... Sort of... I made countless sketches and read every post of StackOverflow regarding the gyro and still didn't quite figured it out...</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 4:47 pm</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">btw. here's a test I've done controlling 360VR video using gyro... But it only worked correctly in this particular orientation :S<br /><!-- m --><a class="postlink" href="https://vimeo.com/56117575">https://vimeo.com/56117575</a><!-- m --></div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 7:28 pm</strong></div>
				<div class="author">by <strong>scottwb</strong></div>
				<div class="content">Wow! Totally awesome post @nosheet ! This should be pinned or put somewhere special.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon May 20, 2013 10:56 pm</strong></div>
				<div class="author">by <strong>rhoster</strong></div>
				<div class="content"><blockquote><div><cite>nosheet wrote:</cite>If you talk about the actual gyro values (ie. roll, pitch, yaw returned from CMAttitude), yes it's quite a mess as actually they are **not** tied to orientation.  </div></blockquote><br /><br />I'm talking strictly the orientation of the device.  You can lay an ipad on a table and it is facing up towards you, with a rotated viewport -90 degrees (with the home button in the left middle side) - then when you pick the device up off the table with your right hand, you may accidentally rotate it a bit clockwise... which triggers the orientation flip because it still has your orientation fixed to the home button being on the bottom (not on the left with a rotated viewport).</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: Code Share: Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Tue May 21, 2013 4:32 pm</strong></div>
				<div class="author">by <strong>franciscotufro</strong></div>
				<div class="content">nosheet, is there a reason why we shouldn't ship this with Moai SDK?<br />If you all believe is a good fit for the SDK we can discuss about integrating it in the actual release.<br />Cheers!</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Tue May 21, 2013 4:35 pm</strong></div>
				<div class="author">by <strong>franciscotufro</strong></div>
				<div class="content">Trying to start working on the Community Contributions forum, I moved this topic as a CONTRIB proposal.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Tue May 21, 2013 4:52 pm</strong></div>
				<div class="author">by <strong>ibisum</strong></div>
				<div class="content">I vote for merging this in to the mainline MOAI sources, there doesn't seem to be much reason not to - I also think that a PDF with nosheets' instructions could be included in the $MOAI_SDK/hosts/xcode folder, or whatever, but thats just me ..</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Tue May 21, 2013 5:30 pm</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">@ibisum, @francisco, whatever way you find suitable to distribute this, it's all great with me. The host code and the instruction was meant to be shared as much as possible. I can make a slightly more polished PDF instructions, or we can put it on wiki. There is one shortcoming with my approach with this host, and that is there is no out of the box way to have both orientations, and that's something I'll probably (have to) work on very soon. In the meantime I still think this is good enough for 95% applications, as there is not many games that use all orientations.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu May 23, 2013 9:01 pm</strong></div>
				<div class="author">by <strong>franciscotufro</strong></div>
				<div class="content">One thing I'm not sure about is Gyro vs. Accelerometer.<br />I mean, they're two different things, why do you disable accelerometer to use gyroscope?</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Fri May 24, 2013 8:21 am</strong></div>
				<div class="author">by <strong>nosheet</strong></div>
				<div class="content">@francisco, you're right, thats why i called it a &quot;hack&quot;.  originally the gyro code was in there in the host i use personally, but it had its own event type that I made  by extending Moai source. However, for the host I share here, I didnt want it to be dependant on any particular  branch, so that users could work with a release version of Moai without tinkering with source. Therefore I could either have deleted the gyro code, or put it as a conditial to override the built-in accel behavior, and for some reason I opted for the later.<br />It might be better to delete it though, at least until I have the source code for &quot;real&quot; gyro event ready to submit.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Mon Aug 05, 2013 11:04 am</strong></div>
				<div class="author">by <strong>POPC</strong></div>
				<div class="content">@nosheet<br />Please make Gyroscope public API for both iOS and Android!<br />No Gyroscope, No Future.</div>
			</div>
			<hr />
		
			<div class="post">
				<h3>Re: [CONTRIB] Easy To Use iOS Host With Landscape and Gyro</h3>
				<div class="date"><img src="styles/proFormell/imageset/icon_post_target.gif" width="11" height="9" alt="Post" title="Post" />Posted: <strong>Thu Oct 03, 2013 9:41 am</strong></div>
				<div class="author">by <strong>n2oula</strong></div>
				<div class="content">@nosheet<br /><br />I am trying to run your host using the latest moai-dev branch on github.<br />I generated the new libraries running the script build-xcode-ios but I am unable to get all the AKU headers used in the step 5 of your guide: &quot;5) Set up paths to Moai libraries and headers to be included&quot;<br /><br />Any indications on how to proceed to get / generate the updated AKU headers compatible with new branches on github?<br /><br />I might be missing something in the whole process of adapting a new branch of moai-dev to your host.<br />It would be great if you could help us with a step-by-step guide to do so.<br />(correctly building the new libraries, finding the new headers to be included in the header path...)<br /><br /><br />Any help around this would be extremely appreciated as I've been struggling around this whole process for days and I could not find any well-documented walkthrough on the wiki / forums.<br /><br />I think this would bring a lot to newbies who are sometimes stuck at this level.<br /><br />Thanks a lot!</div>
			</div>
			<hr />
		
	</div>

	<div id="page-footer">
		<div class="page-number">All times are UTC <br />Page <strong>1</strong> of <strong>2</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Group<br />http://www.phpbb.com/</div>
	</div>
</div>

</body>
</html>