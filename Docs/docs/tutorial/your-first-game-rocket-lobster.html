<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Your First Game : Rocket Lobster</title>
 
    <!-- Bootstrap -->
    <link href="../../css/bootstrap.css" rel="stylesheet">
    
    
    
    
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="../../css/syntax.css" rel="stylesheet">
    <link href="../../css/styles.css" rel="stylesheet">
    <link href="../../css/doc-style.css" rel="stylesheet">
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    
    
  </head>
  <body>
  <nav class="navbar navbar-inverse navbar-static-top" role="navigation" >
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- You'll want to use a responsive image option so this logo looks good on devices - I recommend using something like retina.js (do a quick Google search for it and you'll find it) -->
            <a class="navbar-brand" href="../../index.html">MoaiForge - Community Docs</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">

           </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

    
    <div class="container">
<div class="row-fluid">
   
        <div id="navigation" class="col-md-3">
            
<ul id="nav-menu" class="nav nav-list">
    
    
  
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md does NOT contain pathseg /basics/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Moai Basics</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-two.html">Moai SDK Basics Part Two</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-one.html">Moai SDK Basics Part One</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md does NOT contain pathseg /sdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">The Moai SDK</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/what-is-moai-sdk.html">What is Moai SDK?</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-sdk-desktop-basics.html">Moai SDK Desktop Basics</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/the-moai-runtime.html">The Moai Runtime</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-hosts.html">Moai Hosts</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/structuring-your-moai-game-in-lua.html">Structuring Your Moai Game in Lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-project-setup.html">Moai Project Setup</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/extending-moai-sdk.html">Extending Moai SDK</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/protecting-your-lua-files.html">Protecting Your Lua Files</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/tools-that-work-with-moai.html">Tools that work with Moai</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md does NOT contain pathseg /buildsdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Build the SDK from Source</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/introduction.html">Introduction</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/installing-cmake.html">Installing CMake</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-libraries-for-android-ndk.html">Building Moai Libraries For Android</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-xcode.html">Building Moai From Source With Xcode</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-visual-studio.html">Building Moai From Source With Visual Studio</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-scons.html">Building Moai From Source With Scons</a></li>
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md does NOT contain pathseg /building/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Building Moai Games</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/setup-landscape-in-moai-games-for-ios-devices.html">Setup landscape in Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/cross-platform-development-with-moai.html">Cross Platform Development With Moai</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-ios-devices.html">Building Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-google-chrome.html">Building Moai Games for Google Chrome</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-android-devices.html">Building Moai Games For Android Devices</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md does NOT contain pathseg /reference/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Reference</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/moai-sdk-samples-guide.html">Moai SDK Samples Guide</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/cmake-basics.html">Crash Course on CMAKE</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/code-snips.html">Code snips</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/how-moai's-c-to-lua-binding-works.html">How Moai's C++ to Lua Binding Works</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="../reference/understanding-decks-and-props.html">Understanding Decks and Props</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/using-moaianim.html">Using MOAIAnim</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/wrapping-modes.html">Wrapping modes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-game-rocket-lobster.md contains pathseg /tutorial/ -->
        <li class="parent collapsibleListClosed">
        
          <div class="subtree-name">Tutorials</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li class="active" ><a href="your-first-game-rocket-lobster.html">Your First Game : Rocket Lobster</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="using-particlehelper.html">Using ParticleHelper</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="textboxes.html">Textboxes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="your-first-cloud-game-wolf-clicker.html">Your First Cloud Game : Wolf Clicker</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="setup-moai-sdk-on-windows-using-sublime2.html">Setup Moai SDK on Windows using Sublime2</a></li>
                
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="basic-prop-animations.html">Basic Prop Animations</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="bin2c-lua.html">Bin2c.lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="binding-c-apis-to-moai-using-moailuaobject.html">Binding C++ APIs to Moai using MOAILuaObject</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="build-on-steam-runtime.html">Building Moai with Steam Runtime</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="concatenate-your-lua-source-tree.html">Concatenate your Lua source tree</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="density-friction-and-restitution.html">Density, Friction And Restitution</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="getting-started-with-box2d.html">Getting Started With Box2D</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    

</ul>

<script src="../../js/collapsiblelists.min.js"> </script>
<script>
$(function() {
CollapsibleLists.applyTo(document.getElementById('nav-menu'));
});

</script>
        </div>

        <div id="content" class="col-md-9">
            <a href="https://github.com/moaiforge/moai-sdk/tree/gh-pages/_docs/tutorial/your-first-game-rocket-lobster.md" class="improve-docs btn"><i class="glyphicon glyphicon-edit">&nbsp;</i>Improve this doc</a>
            <h1>Your First Game : Rocket Lobster</h1>
            
            
            <p>This tutorial will take you through the beginnings of implementing a small game in Moai. The example game you&#39;ll build here is inspired by <a href="http://en.wikipedia.org/wiki/Missile_Command">Atari&#39;s Missile Command</a>, and should give you a basic grasp of some core gameplay features like randomly spawning enemies, player input, explosions, and a clear failure condition.</p>

<p>Enter: Rocket Lobster. The game consists of enemy missiles flying down from the top of the screen towards the player’s bases at the bottom. The player is tasked with shooting defensive missiles of their own up to stop the enemy missiles from reaching their lobster. Er, base.</p>

<p>This tutorial assumes the reader has at least a basic understanding of Lua and programming. It is suggested you read <a href="../basics/moai-sdk-basics-part-one.html">Moai SDK Basics Part One</a> and <a href="../basics/moai-sdk-basics-part-two.html">Moai SDK Basics Part Two</a> to become more familiar with a few of the Moai classes used in this tutorial.</p>

<p>In order to run the tutorial, first download the <a href="http://getmoai.com/images/getmoai/rocket_lobster/files%20for%20rocketlobster.zip">RocketLobster tutorial files</a>. This will contain the all the image files, the font file, and the completed code (as well as a blank .lua file).</p>

<p>Now that the introduction’s out of the way, it’s time to create your first game. The first thing to do is create the game window.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- This will print “Hello Moai” on the debug screen.</span>
<span class="nb">print</span> <span class="p">(</span> <span class="s2">"hello, moai!"</span> <span class="p">)</span>
<span class="c1">-- This opens up a window with the title of “Rocket Lobster” with</span>
<span class="c1">-- a width of 320 pixels and a height of 480 pixels.</span>
<span class="n">MOAISim</span><span class="p">.</span><span class="n">openWindow</span> <span class="p">(</span> <span class="s2">"Rocket Lobster"</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">480</span> <span class="p">)</span>
<span class="c1">--This will set the viewport and the layer for rendering.</span>
<span class="n">viewport</span> <span class="o">=</span> <span class="n">MOAIViewport</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">viewport</span><span class="p">:</span><span class="n">setScale</span> <span class="p">(</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">480</span> <span class="p">)</span>
<span class="n">viewport</span><span class="p">:</span><span class="n">setSize</span> <span class="p">(</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">480</span> <span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">MOAILayer2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">layer</span><span class="p">:</span><span class="n">setViewport</span> <span class="p">(</span> <span class="n">viewport</span> <span class="p">)</span>
<span class="n">MOAISim</span><span class="p">.</span><span class="n">pushRenderPass</span> <span class="p">(</span> <span class="n">layer</span> <span class="p">)</span>
</code></pre></div>
<p>More in depth information on viewports and layers can be found in the <a href="../basics/moai-sdk-basics-part-one.html">Moai SDK Basics Part One</a> article.</p>

<p>Go ahead and run the program so far and you should get:</p>

<p><img src="../../img/docs/RLobster1.jpg" alt=""></p>

<p>Now that the game window is set up, you&#39;re ready to start creating and inserting objects. Below the set up, go ahead and add in the following code.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">lobsterGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"openlobster.png"</span> <span class="p">)</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span> <span class="p">)</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">base</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">lobsterGfx</span> <span class="p">)</span>
<span class="n">base</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">240</span> <span class="p">)</span>

<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
</code></pre></div>
<p>This will create and insert the lobster base onto the game window.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- Creates a new GfxQuad with the name of lobsterGfx</span>
<span class="n">lobsterGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="c1">-- Assigns the texture "openlobster.png" to that lobsterGfx Quad</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"openlobster.png"</span> <span class="p">)</span>
<span class="c1">-- Sets the size of the quad</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span> <span class="p">)</span>

<span class="c1">-- Creates a new Prop with the name of base</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="c1">-- Assigns the lobsterGfx textured quad to the prop "base"</span>
<span class="n">base</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">lobsterGfx</span> <span class="p">)</span>
<span class="c1">-- Sets the location of the base</span>
<span class="n">base</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">240</span> <span class="p">)</span>

<span class="c1">-- Inserts the prop "base" into the layer so it can be seen.</span>
<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
</code></pre></div>
<p>Now that it’s all in there you should see the following:</p>

<p><img src="../../img/docs/RLobster2.jpg" alt=""></p>

<p>Now that the base is onscreen, it’s time to place a rocket.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">rocketGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"rocket.png"</span> <span class="p">)</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span> <span class="p">)</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">makeRocket</span> <span class="p">()</span>
 <span class="kd">local</span> <span class="n">rocket</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">rocket</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">rocketGfx</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span>
<span class="k">end</span>

<span class="n">makeRocket</span> <span class="p">()</span>
</code></pre></div>
<p>This should look fairly similar to the base making, with one major change.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">makeRocket</span> <span class="p">()</span>
 <span class="kd">local</span> <span class="n">rocket</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">rocket</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">rocketGfx</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span>
<span class="k">end</span>

<span class="n">makeRocket</span> <span class="p">()</span>
</code></pre></div>
<p>Since you will eventually want to make more than one rocket (unlike the base, where one is fine), it would make more sense to create a rocket making function. Later this function will be expanded somewhat, but for now, this will work.</p>

<p>After adding in the code and running the program, you should be presented with the following:</p>

<p><img src="../../img/docs/RLobster3.jpg" alt=""></p>

<p>The rocket has appeared onscreen, now it’s time to make it move. With this step, things are going to get a bit more complicated; This section introduce threads as well as functions within functions.</p>

<p>The next section will take the previous code and add a new function into the makeRocket function, and also change the coordinates of the base to a constant. For organization’s sake, place your constants at the top of the code, right above the window initialization.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">baseX</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">baseY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">240</span>
</code></pre></div>
<p>Now that the constants are in, change the base creation code to refer to them.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">base</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">base</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">lobsterGfx</span> <span class="p">)</span>
<span class="n">base</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">baseX</span><span class="p">,</span> <span class="n">baseY</span> <span class="p">)</span> <span class="c1">-- New base coordinates</span>

<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
</code></pre></div>
<p>This code just changed the way that the base gets its location. For clarity later on, you can just use baseX and baseY. Now to make the rocket move!</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">makeRocket</span> <span class="p">()</span>
 <span class="kd">local</span> <span class="n">rocket</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">rocket</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">rocketGfx</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span>

 <span class="c1">----------------</span>
 <span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">launch</span> <span class="p">()</span>

   <span class="n">self</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAIThread</span><span class="p">:</span><span class="n">new</span> <span class="p">()</span>

   <span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span>

     <span class="k">function</span> <span class="p">()</span>
       <span class="n">MOAIThread</span><span class="p">.</span><span class="n">blockOnAction</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">seekLoc</span> <span class="p">(</span> <span class="n">baseX</span><span class="p">,</span> <span class="n">baseY</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">MOAIEaseType</span><span class="p">.</span><span class="n">LINEAR</span> <span class="p">))</span>
     <span class="k">end</span>    
   <span class="p">)</span>
 <span class="k">end</span>

 <span class="k">return</span> <span class="n">rocket</span>
<span class="k">end</span>

<span class="n">rocket</span> <span class="o">=</span> <span class="n">makeRocket</span> <span class="p">()</span>
<span class="n">rocket</span><span class="p">:</span><span class="n">launch</span> <span class="p">()</span>
</code></pre></div>
<p>The main thing added in this step is the rocket:launch function.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">launch</span> <span class="p">()</span>

  <span class="n">self</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAIThread</span><span class="p">:</span><span class="n">new</span> <span class="p">()</span>

  <span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span>

    <span class="k">function</span> <span class="p">()</span>
      <span class="n">MOAIThread</span><span class="p">.</span><span class="n">blockOnAction</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">seekLoc</span> <span class="p">(</span> <span class="n">baseX</span><span class="p">,</span> <span class="n">baseY</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">MOAIEaseType</span><span class="p">.</span><span class="n">LINEAR</span> <span class="p">))</span>
    <span class="k">end</span> 
  <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>The rocket:launch function contains a MOAICoroutine.blockOnAction and inside that the rocket&#39;s movement starts.</p>

<p><code>self:seekLoc ( baseX, baseY, 3.0, MOAIEaseType.LINEAR ) )</code> will make the rocket (self) seek the location (seekLoc) of baseX (for x coords), baseY (for y coords) with a timer of 3.0 (3 seconds from start to finish), and an ease type of linear (meaning the speed goes at a constant speed.) These all get run in a thread as part of the rocket:launch function.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">rocket</span> <span class="o">=</span> <span class="n">makeRocket</span> <span class="p">()</span>  <span class="c1">-- Make the rocket</span>
<span class="n">rocket</span><span class="p">:</span><span class="n">launch</span> <span class="p">()</span>
</code></pre></div>
<p>Now after all those are in, running the game will get you this:</p>

<p><img src="../../img/docs/RLobster4.jpg" alt=""></p>

<p>Now that a rocket is flying towards the lobster/base with reckless abandon, it’s time to make it actually do something. Exploding sounds like a good idea. In order to do this, you will first need to create the explosion and then call it when the rocket hits its target. This step is two in one.</p>

<p>First step is to create the explosion. This will have to be inserted above the rocket creation, since the rocket will call the explosion.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">explosionGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">explosionGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"fire.png"</span> <span class="p">)</span>
<span class="n">explosionGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span> <span class="p">)</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">makeExplosion</span> <span class="p">()</span>

 <span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">explosion</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">explosionGfx</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>

 <span class="c1">----------------</span>

 <span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">explode</span> <span class="p">()</span>

   <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span> <span class="k">do</span>
     <span class="n">self</span><span class="p">:</span><span class="n">setScl</span> <span class="p">(</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">64</span> <span class="p">)</span>
     <span class="nb">coroutine.yield</span> <span class="p">()</span>
   <span class="k">end</span>

   <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>
 <span class="k">end</span>

 <span class="k">return</span> <span class="n">explosion</span>
<span class="k">end</span>
</code></pre></div>
<p>This should look very similar to the rocket. The explosionGfx is still created outside everything, and then inside a function calling that graphic onto the newly created prop, but now there is an explosion:explode function. Have a look at that for a moment.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">explode</span> <span class="p">()</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span> <span class="k">do</span>
    <span class="n">self</span><span class="p">:</span><span class="n">setScl</span> <span class="p">(</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">64</span> <span class="p">)</span>
    <span class="nb">coroutine.yield</span> <span class="p">()</span>
  <span class="k">end</span>

  <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">explosion</span>
</code></pre></div>
<p>In this for loop, the goal is to set the size of the explosion and slowly make it grow and to cycle through that until it is finished, then it will remove itself from the game. (layer:removeProp ( explosion ) )</p>

<p>Now that the explosion has been created, it’s time to add the explosion to the rocket. This bit of code will be added inside the rocket:launch function after “layer:removeProp.” Here is the newly updated rocket.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">launch</span> <span class="p">()</span>

 <span class="n">self</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAIThread</span><span class="p">:</span><span class="n">new</span> <span class="p">()</span>

 <span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span>

   <span class="k">function</span> <span class="p">()</span>

     <span class="n">MOAIThread</span><span class="p">.</span><span class="n">blockOnAction</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">seekLoc</span> <span class="p">(</span> <span class="n">baseX</span><span class="p">,</span> <span class="n">baseY</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">MOAIEaseType</span><span class="p">.</span><span class="n">LINEAR</span> <span class="p">))</span>

     <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>

     <span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">makeExplosion</span> <span class="p">()</span>
     <span class="n">explosion</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span> <span class="p">)</span>
     <span class="n">explosion</span><span class="p">:</span><span class="n">explode</span> <span class="p">()</span>

     <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
   <span class="k">end</span>  
 <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Running that, you should see:</p>

<p><img src="../../img/docs/RLobster5.jpg" alt=""></p>

<p>Now that the rocket explodes and blows up the base, the player is going to need a way to defend that base. Here comes the ally rocket. This step will be very involved, and you will have to code several things. Create the game loop, create an ally rocket and an enemy rocket type, assign a target for each rocket, create player input, change the direction the rocket points in, launch multiple enemy rockets, and change the size of the explosion depending on if it hits the base or not.</p>

<p>So get ready to jump in!</p>

<p>First things first, you&#39;re going to declare a few math utility functions. Nothing special here. They do, however, have to be declared above everything else, since they will be used in other functions, so just put them right below the setup constants.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">angle</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span>
 <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="n">atan2</span> <span class="p">(</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">180</span> <span class="o">/</span> <span class="nb">math.pi</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">----------------------------</span>

<span class="k">function</span> <span class="nf">distance</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span>
 <span class="k">return</span> <span class="nb">math.sqrt</span> <span class="p">(((</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="p">)</span> <span class="o">+</span> <span class="p">((</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="p">))</span>
<span class="k">end</span>
<span class="c1">--------------------------------</span>
</code></pre></div>
<p>Next we’ll change the size of the explosion.</p>

<p>OLD:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">explode</span> <span class="p">()</span>

 <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span> <span class="k">do</span>
   <span class="n">self</span><span class="p">:</span><span class="n">setScl</span> <span class="p">(</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">64</span> <span class="p">)</span>
   <span class="nb">coroutine.yield</span> <span class="p">()</span>
 <span class="k">end</span>

 <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>NEW:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="n">size</span> <span class="p">)</span>

 <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="k">do</span>
   <span class="n">self</span><span class="p">:</span><span class="n">setScl</span> <span class="p">(</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">64</span> <span class="p">)</span>
   <span class="nb">coroutine.yield</span> <span class="p">()</span>
 <span class="k">end</span>

 <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>You&#39;ll be plugging in a size variable into the explode function, and using that to determine the size of the explosion. Later on you will declare that size variable depending on which type of rocket you launch. Now it&#39;s time to add a considerable chunk to the rocket making function. First, however, you’ll need a few more constants; these will be used to determine rocket speed . Again, declare these with the other constants at the top of the code:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">MIN_ENEMY_SPEED</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">MAX_ENEMY_SPEED</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">ALLY_SPEED</span> <span class="o">=</span> <span class="mi">300</span>
</code></pre></div>
<p>Here’s the new one in its entirety.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">makeRocket</span> <span class="p">(</span> <span class="n">isAlly</span><span class="p">,</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">speed</span> <span class="p">)</span>

<span class="kd">local</span> <span class="n">travelDist</span> <span class="o">=</span> <span class="n">distance</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span>
<span class="kd">local</span> <span class="n">travelTime</span> <span class="o">=</span> <span class="n">travelDist</span> <span class="o">/</span> <span class="n">speed</span>
<span class="kd">local</span> <span class="n">rocket</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>

<span class="n">rocket</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">rocketGfx</span> <span class="p">)</span>
<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span>
<span class="n">rocket</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>
<span class="n">rocket</span><span class="p">:</span><span class="n">setRot</span> <span class="p">(</span> <span class="n">angle</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">90</span> <span class="p">)</span>
<span class="n">rocket</span><span class="p">.</span><span class="n">isAlly</span> <span class="o">=</span> <span class="n">isAlly</span>               <span class="c1">-- declare</span>

<span class="c1">----------------</span>

<span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="n">size</span> <span class="p">)</span>

<span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
<span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">makeExplosion</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span> <span class="p">)</span>
<span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>

<span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">stop</span> <span class="p">()</span>
<span class="k">end</span>

<span class="c1">----------------</span>

<span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">main</span> <span class="p">()</span>

<span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">blockOnAction</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">seekLoc</span> <span class="p">(</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">travelTime</span><span class="p">,</span>   <span class="n">MOAIEaseType</span><span class="p">.</span><span class="n">LINEAR</span> <span class="p">))</span>

<span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">isAlly</span> <span class="k">then</span>
<span class="n">self</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">64</span> <span class="p">)</span>
<span class="k">else</span>
<span class="n">self</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">128</span> <span class="p">)</span>
<span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
<span class="k">end</span>
<span class="k">end</span>

<span class="c1">----------------</span>

<span class="n">rocket</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">rocket</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span> <span class="n">rocket</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="n">rocket</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">------------------------</span>

<span class="k">function</span> <span class="nf">launchEnemyRocket</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>

<span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="nb">math.random</span> <span class="p">(</span>  <span class="n">MIN_ENEMY_SPEED</span><span class="p">,</span> <span class="n">MAX_ENEMY_SPEED</span> <span class="p">))</span>
<span class="k">end</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">launchAllyRocket</span> <span class="p">(</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span>

     <span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">true</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">ALLY_SPEED</span> <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>The first thing to notice is that the rockets&#39; speed are now conrolled using the variable travelTime instead of the number 3.0. Make sure you don’t miss adding it to MOAICoroutine.blockOnAction. Another major change to the makeRocket function is the “isAlly” variable. This will determine if the rocket is one of the friendly rockets, or an enemy rocket. You&#39;ll pass this variable through when you create the rocket and it will determine the spawn location.</p>

<p>First, go ahead and set up two different types of rockets.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">launchEnemyRocket</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>

 <span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="nb">math.random</span> <span class="p">(</span> <span class="n">MIN_ENEMY_SPEED</span><span class="p">,</span> <span class="n">MAX_ENEMY_SPEED</span> <span class="p">))</span>
<span class="k">end</span>
</code></pre></div>
<p>When the launchEnemyRocket function is called, a start location is run through it; it then plugs that into the makeRocket function, and also declares that isAlly = false. Finally, a rocket speed is determined with math.random and the constants declared earlier.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">launchAllyRocket</span> <span class="p">(</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span>

 <span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">true</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">ALLY_SPEED</span> <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Similar to the launchEnemyRocket, you plug the variables in, except this time you declare isAlly = true. Now that we have our new rocket launching functions, it’s time to create a game loop so that we can run them more than once!</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">mainThread</span> <span class="o">=</span> <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">mainThread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span>

 <span class="k">function</span> <span class="p">()</span>

   <span class="kd">local</span> <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">while</span> <span class="kc">true</span> <span class="k">do</span>
     <span class="nb">coroutine.yield</span> <span class="p">()</span>
     <span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
     <span class="k">if</span> <span class="n">frames</span> <span class="o">&gt;=</span> <span class="mi">90</span> <span class="k">then</span>
       <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
       <span class="n">launchEnemyRocket</span> <span class="p">(</span> <span class="nb">math.random</span> <span class="p">(</span> <span class="o">-</span><span class="mi">160</span><span class="p">,</span> <span class="mi">160</span> <span class="p">),</span> <span class="mi">300</span> <span class="p">)</span>
     <span class="k">end</span>
     <span class="k">if</span> <span class="n">MOAIInputMgr</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">mouseLeft</span><span class="p">:</span><span class="n">down</span> <span class="p">()</span> <span class="k">then</span>
       <span class="n">launchAllyRocket</span> <span class="p">(</span> <span class="n">layer</span><span class="p">:</span><span class="n">wndToWorld</span> <span class="p">(</span><span class="n">MOAIInputMgr</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">pointer</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span> <span class="p">))</span>
     <span class="k">end</span>
   <span class="k">end</span>
 <span class="k">end</span>
<span class="p">)</span>
</code></pre></div>
<p>So here it is, the game loop. Pretty small, pretty simple, but powerful. Let’s go through the sections of it.</p>

<p>First the main thread is declared ( mainThread = MOAICoroutine.new () ) and then that thread is run with the launch function inside.</p>

<p>That function first declares frames = 0, and then yields. During that yield, 1 is added to frame every cycle. Finally, when the frame count hits 90, it gets reset to 0 and then launchEnemyRocket is run with a Y value of 300 and an X value of (math.random ( -160, 160 ), allowing it to spawn at any spot along that line, to add some randomness to the rockets.</p>

<p>As well as spawning in the enemy rockets, you can now take in player input. “MOAIInputMgr.device.mouseLeft:down” means that when the mouseLeft button has been pressed, then the game will launchAllyRocket with the coordinates taken from ( layer:wndToWorld (MOAIInputMgr.device.pointer:getLoc ()) meaning that wherever the mouse pointer is at the moment of the button press, that location will be translated into coordinates that the game will use as the target location.</p>

<p>And here’s what the game looks like at this point:</p>

<p><img src="../../img/docs/RLobster7.jpg" alt=""></p>

<p>Now that we finally can launch our own rockets and they will explode, it’s time to make those explosions actually do something.</p>

<p>You&#39;re rounding the bases and almost finished with your first game! This step introduces hit detection on the explosions, and rearranges a few previous functions. First, you will need to create a table of enemy rockets that will be used to check if the explosion hit the rocket or not.</p>

<p>You can make that table right after you create the rocketGfx quad.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">rocketGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"rocket.png"</span> <span class="p">)</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span> <span class="p">)</span>

<span class="n">enemyRockets</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
<p>Now it’s time to start plugging the enemy rockets into this table. This is done by editing the makeRocket function and placing the following code right after “rocket.isAlly = isAlly”</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">rocket</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>
<span class="n">rocket</span><span class="p">:</span><span class="n">setRot</span> <span class="p">(</span> <span class="n">angle</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">90</span> <span class="p">)</span>
<span class="n">rocket</span><span class="p">.</span><span class="n">isAlly</span> <span class="o">=</span> <span class="n">isAlly</span>

<span class="o">&lt;</span><span class="n">source</span> <span class="n">lang</span><span class="o">=</span><span class="s2">"Lua"</span><span class="o">&gt;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">isAlly</span> <span class="k">then</span>
 <span class="n">enemyRockets</span> <span class="p">[</span> <span class="n">rocket</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rocket</span>
<span class="k">end</span>
</code></pre></div>
<p>And now the enemy rockets have been placed into a table! Now it&#39;s time to create a hit detection function for the rocket explosion. This will need to be placed inside the explosion:makeExplosion function, but above the explosion:main function.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">checkHit</span> <span class="p">(</span> <span class="n">prop</span> <span class="p">)</span>

 <span class="kd">local</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
 <span class="kd">local</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">prop</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
 <span class="k">return</span> <span class="n">distance</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
<span class="k">end</span>
</code></pre></div>
<p>This one looks small, but there’s a lot going on. The function itself takes in a prop (one of the enemy rockets) and compares the location of the explosion against the location of the prop. It then returns distance and if the location is less than or equal to the size of the prop, it will explode. Now you&#39;ll need to change the rocket:explode function to handle what happens when the rocket is told to explode. That&#39;s done by adding enemyRockets [ self] = nil to the function.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="n">size</span> <span class="p">)</span>

 <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
 <span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">makeExplosion</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>

 <span class="n">enemyRockets</span> <span class="p">[</span> <span class="n">self</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
 <span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">stop</span> <span class="p">()</span>
<span class="k">end</span>
</code></pre></div>
<p>After that, just edit the explosion:main function to run the new checkHit function.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">main</span> <span class="p">()</span>

 <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="k">do</span>
   <span class="n">self</span><span class="p">:</span><span class="n">setFrame</span> <span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span>
   <span class="k">for</span> <span class="n">rocket</span> <span class="k">in</span> <span class="nb">pairs</span> <span class="p">(</span> <span class="n">enemyRockets</span> <span class="p">)</span> <span class="k">do</span>
     <span class="k">if</span> <span class="n">self</span><span class="p">:</span><span class="n">checkHit</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span> <span class="k">then</span>
       <span class="n">rocket</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">64</span> <span class="p">)</span>
     <span class="k">end</span> 
   <span class="k">end</span>
   <span class="nb">coroutine.yield</span> <span class="p">()</span>
 <span class="k">end</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>And there we go, we are all finished with hit detection. An ally rocket that explodes will look like:</p>

<p><img src="../../img/docs/RLobster8.jpg" alt=""></p>

<p>This is the home stretch; the game loop is looping, rockets are flying in all directions, explosions can blow up other things, and the base goes away when it gets hit. The final missing piece is some sort of game over system. You’ll need to stop all rockets from launching after the base has been blown up, and also to create a game over message. Here are the final steps.</p>

<p>First, create a game over bool. You can just declare this right above the enemyRockets table.</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="n">gameOver</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">enemyRockets</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
<p>That’s easy enough. Now you’ll need the game to end once the base has been blown up and removed. That’s as easy as putting gameOver = true into the rocket:main thread, like so</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- hide the base</span>
<span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
<span class="c1">-- set the game over flag</span>
<span class="n">gameOver</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div>
<p>Now when the base gets blown up, gameOver will be set to true. But then what happens? Simple, you just stop running the main game loop.</p>

<p>OLD:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="p">()</span>

     <span class="kd">local</span> <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
     <span class="k">while</span> <span class="kc">true</span> <span class="k">do</span>
          <span class="nb">coroutine.yield</span> <span class="p">()</span>
          <span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>
<p>NEW:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="k">function</span> <span class="p">()</span>

     <span class="kd">local</span> <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
          <span class="c1">-- Once gameOver = true, the main thread stops running.</span>
          <span class="k">while</span> <span class="ow">not</span> <span class="n">gameOver</span> <span class="k">do</span>
               <span class="nb">coroutine.yield</span> <span class="p">()</span>
               <span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>
<p>And now, for the final step: placing a game over message onto the screen after the game ends. Right after the while loop ends, you can create a text box. Here is what that looks like:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- This creates a font and loads up the arialbd.tff file for that font.</span>
<span class="kd">local</span> <span class="n">font</span> <span class="o">=</span> <span class="n">MOAIFont</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">font</span><span class="p">:</span><span class="n">loadFromTTF</span> <span class="p">(</span> <span class="s2">"arialbd.ttf"</span><span class="p">,</span> 
  <span class="s2">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789,.?!"</span><span class="p">,</span> 
  <span class="mi">12</span><span class="p">,</span> <span class="mi">163</span> <span class="p">)</span>

<span class="kd">local</span> <span class="n">textbox</span> <span class="o">=</span> <span class="n">MOAITextBox</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setFont</span> <span class="p">(</span> <span class="n">font</span> <span class="p">)</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setTextSize</span> <span class="p">(</span> <span class="n">font</span><span class="p">:</span><span class="n">getScale</span> <span class="p">())</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">160</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">80</span> <span class="p">)</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setAlignment</span> <span class="p">(</span> <span class="n">MOAITextBox</span><span class="p">.</span><span class="n">CENTER_JUSTIFY</span> <span class="p">)</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setYFlip</span> <span class="p">(</span> <span class="kc">true</span> <span class="p">)</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">setString</span> <span class="p">(</span> <span class="s2">"You are dead!"</span> <span class="p">)</span> <span class="c1">--- All of these set the parameters of the textbox.</span>
<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">textbox</span> <span class="p">)</span>
<span class="n">textbox</span><span class="p">:</span><span class="n">spool</span> <span class="p">()</span> <span class="c1">--- And finally, this places the textbox into the layer, spooling it along one letter at a time.</span>
</code></pre></div>
<p>And that’s it! We finally have finished Rocket Lobster.</p>

<p><img src="../../img/docs/RLobster9.jpg" alt=""></p>

<p>In case you were interested, here&#39;s what the final code should look like:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">--==============================================================</span>
<span class="c1">-- Copyright (c) 2010-2011 Zipline Games, Inc.</span>
<span class="c1">-- All Rights Reserved.</span>
<span class="c1">-- http://getmoai.com</span>
<span class="c1">--==============================================================</span>
<span class="c1">--==============================================================</span>
<span class="c1">-- set up</span>
<span class="c1">--==============================================================</span>

<span class="nb">print</span> <span class="p">(</span> <span class="s2">"hello, moai!"</span> <span class="p">)</span>
<span class="n">SCREEN_UNITS_X</span> <span class="o">=</span> <span class="mi">320</span>
<span class="n">SCREEN_UNITS_Y</span> <span class="o">=</span> <span class="mi">480</span>
<span class="n">SCREEN_WIDTH</span> <span class="o">=</span> <span class="n">SCREEN_UNITS_X</span>
<span class="n">SCREEN_HEIGHT</span> <span class="o">=</span> <span class="n">SCREEN_UNITS_Y</span>

<span class="n">BASE_X</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">BASE_Y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">240</span>
<span class="n">MIN_ENEMY_SPEED</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">MAX_ENEMY_SPEED</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">ALLY_SPEED</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">MOAISim</span><span class="p">.</span><span class="n">openWindow</span> <span class="p">(</span> <span class="s2">"Rocket Lobster"</span><span class="p">,</span> <span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span> <span class="p">)</span>
<span class="n">viewport</span> <span class="o">=</span> <span class="n">MOAIViewport</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">viewport</span><span class="p">:</span><span class="n">setScale</span> <span class="p">(</span> <span class="n">SCREEN_UNITS_X</span><span class="p">,</span> <span class="n">SCREEN_UNITS_Y</span> <span class="p">)</span>
<span class="n">viewport</span><span class="p">:</span><span class="n">setSize</span> <span class="p">(</span> <span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span> <span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">MOAILayer2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">layer</span><span class="p">:</span><span class="n">setViewport</span> <span class="p">(</span> <span class="n">viewport</span> <span class="p">)</span>
<span class="n">MOAISim</span><span class="p">.</span><span class="n">pushRenderPass</span> <span class="p">(</span> <span class="n">layer</span> <span class="p">)</span>

<span class="c1">--==============================================================</span>
<span class="c1">-- utility functions</span>
<span class="c1">--==============================================================</span>

<span class="c1">--------------------------------</span>
<span class="k">function</span> <span class="nf">angle</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span>

 <span class="k">return</span> <span class="n">math</span><span class="p">.</span><span class="n">atan2</span> <span class="p">(</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">180</span> <span class="o">/</span> <span class="nb">math.pi</span> <span class="p">)</span>
<span class="k">end</span>
<span class="c1">--------------------------------</span>
<span class="k">function</span> <span class="nf">distance</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span>

 <span class="k">return</span> <span class="nb">math.sqrt</span> <span class="p">(((</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="p">)</span> <span class="o">+</span> <span class="p">((</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span> <span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="p">))</span>
<span class="k">end</span>
<span class="c1">--==============================================================</span>
<span class="c1">-- base</span>
<span class="c1">--==============================================================</span>

<span class="n">lobsterGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"openlobster.png"</span> <span class="p">)</span>
<span class="n">lobsterGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="o">-</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span> <span class="p">)</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">base</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">lobsterGfx</span> <span class="p">)</span>
<span class="n">base</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span> <span class="p">)</span>

<span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
<span class="c1">--==============================================================</span>
<span class="c1">-- explosion rig</span>
<span class="c1">--==============================================================</span>

<span class="n">explosionGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">explosionGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"fire.png"</span> <span class="p">)</span>
<span class="n">explosionGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span> <span class="p">)</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">makeExplosion</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span> <span class="p">)</span>

 <span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">explosion</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">explosionGfx</span> <span class="p">)</span>
 <span class="n">explosion</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
 <span class="n">explosion</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">explosion</span> <span class="p">)</span>

<span class="c1">----------------</span>

 <span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">checkHit</span> <span class="p">(</span> <span class="n">prop</span> <span class="p">)</span>

   <span class="kd">local</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
   <span class="kd">local</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">prop</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
   <span class="k">return</span> <span class="n">distance</span> <span class="p">(</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
 <span class="k">end</span>

<span class="c1">----------------</span>

 <span class="k">function</span> <span class="nf">explosion</span><span class="p">:</span><span class="n">main</span> <span class="p">()</span>

   <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="k">do</span>
     <span class="n">self</span><span class="p">:</span><span class="n">setFrame</span> <span class="p">(</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span>
     <span class="k">for</span> <span class="n">rocket</span> <span class="k">in</span> <span class="nb">pairs</span> <span class="p">(</span> <span class="n">enemyRockets</span> <span class="p">)</span> <span class="k">do</span>
       <span class="k">if</span> <span class="n">self</span><span class="p">:</span><span class="n">checkHit</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span> <span class="k">then</span>
         <span class="n">rocket</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">64</span> <span class="p">)</span>
       <span class="k">end</span>
     <span class="k">end</span>
     <span class="nb">coroutine.yield</span> <span class="p">()</span>
   <span class="k">end</span>
   <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>
 <span class="k">end</span>

 <span class="n">explosion</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">explosion</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span> <span class="n">explosion</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="n">explosion</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">--==============================================================</span>
<span class="c1">-- rocket</span>
<span class="c1">--==============================================================</span>

<span class="n">rocketGfx</span> <span class="o">=</span> <span class="n">MOAIGfxQuad2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setTexture</span> <span class="p">(</span> <span class="s2">"rocket.png"</span> <span class="p">)</span>
<span class="n">rocketGfx</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span> <span class="p">)</span>

<span class="n">gameOver</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">enemyRockets</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">makeRocket</span> <span class="p">(</span> <span class="n">isAlly</span><span class="p">,</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">speed</span> <span class="p">)</span>

 <span class="kd">local</span> <span class="n">travelDist</span> <span class="o">=</span> <span class="n">distance</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span>
 <span class="kd">local</span> <span class="n">travelTime</span> <span class="o">=</span> <span class="n">travelDist</span> <span class="o">/</span> <span class="n">speed</span>
 <span class="kd">local</span> <span class="n">rocket</span> <span class="o">=</span> <span class="n">MOAIProp2D</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>

 <span class="n">rocket</span><span class="p">:</span><span class="n">setDeck</span> <span class="p">(</span> <span class="n">rocketGfx</span> <span class="p">)</span>
 <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">rocket</span> <span class="p">)</span>
 <span class="n">rocket</span><span class="p">:</span><span class="n">setLoc</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>
   <span class="n">rocket</span><span class="p">:</span><span class="n">setRot</span> <span class="p">(</span> <span class="n">angle</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">90</span> <span class="p">)</span>

 <span class="n">rocket</span><span class="p">.</span><span class="n">isAlly</span> <span class="o">=</span> <span class="n">isAlly</span>
 <span class="k">if</span> <span class="ow">not</span> <span class="n">isAlly</span> <span class="k">then</span>
   <span class="n">enemyRockets</span> <span class="p">[</span> <span class="n">rocket</span> <span class="p">]</span> <span class="o">=</span> <span class="n">rocket</span>
 <span class="k">end</span>

 <span class="c1">----------------</span>

 <span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="n">size</span> <span class="p">)</span>

   <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span>
   <span class="kd">local</span> <span class="n">explosion</span> <span class="o">=</span> <span class="n">makeExplosion</span> <span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span> <span class="p">)</span>
   <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">self</span> <span class="p">)</span>
   <span class="n">enemyRockets</span> <span class="p">[</span> <span class="n">self</span> <span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
   <span class="n">self</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">stop</span> <span class="p">()</span>
 <span class="k">end</span>

 <span class="c1">----------------</span>

 <span class="k">function</span> <span class="nf">rocket</span><span class="p">:</span><span class="n">main</span> <span class="p">()</span>

   <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">blockOnAction</span> <span class="p">(</span> <span class="n">self</span><span class="p">:</span><span class="n">seekLoc</span> <span class="p">(</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">travelTime</span><span class="p">,</span> <span class="n">MOAIEaseType</span><span class="p">.</span><span class="n">LINEAR</span> <span class="p">))</span>
   <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">isAlly</span> <span class="k">then</span>
     <span class="n">self</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">64</span> <span class="p">)</span>
   <span class="k">else</span>
     <span class="n">self</span><span class="p">:</span><span class="n">explode</span> <span class="p">(</span> <span class="mi">128</span> <span class="p">)</span>
     <span class="n">gameOver</span> <span class="o">=</span> <span class="kc">true</span>
     <span class="n">layer</span><span class="p">:</span><span class="n">removeProp</span> <span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
   <span class="k">end</span>
 <span class="k">end</span>
 <span class="n">rocket</span><span class="p">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
 <span class="n">rocket</span><span class="p">.</span><span class="n">thread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span> <span class="n">rocket</span><span class="p">.</span><span class="n">main</span><span class="p">,</span> <span class="n">rocket</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">launchEnemyRocket</span> <span class="p">(</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span> <span class="p">)</span>

 <span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="n">startX</span><span class="p">,</span> <span class="n">startY</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="nb">math.random</span> <span class="p">(</span> <span class="n">MIN_ENEMY_SPEED</span><span class="p">,</span> <span class="n">MAX_ENEMY_SPEED</span> <span class="p">))</span>
<span class="k">end</span>

<span class="c1">--------------------------------</span>

<span class="k">function</span> <span class="nf">launchAllyRocket</span> <span class="p">(</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span> <span class="p">)</span>

 <span class="n">makeRocket</span> <span class="p">(</span> <span class="kc">true</span><span class="p">,</span> <span class="n">BASE_X</span><span class="p">,</span> <span class="n">BASE_Y</span><span class="p">,</span> <span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">ALLY_SPEED</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">--==============================================================</span>
<span class="c1">-- game loop</span>
<span class="c1">--==============================================================</span>

<span class="n">mainThread</span> <span class="o">=</span> <span class="n">MOAICoroutine</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
<span class="n">mainThread</span><span class="p">:</span><span class="n">run</span> <span class="p">(</span>

 <span class="k">function</span> <span class="p">()</span>

   <span class="kd">local</span> <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">while</span> <span class="ow">not</span> <span class="n">gameOver</span> <span class="k">do</span>
     <span class="nb">coroutine.yield</span> <span class="p">()</span>
     <span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="mi">1</span>
     <span class="k">if</span> <span class="n">frames</span> <span class="o">&lt;=</span> <span class="mi">90</span> <span class="k">then</span>
       <span class="n">frames</span> <span class="o">=</span> <span class="mi">0</span>
       <span class="n">launchEnemyRocket</span> <span class="p">(</span> <span class="nb">math.random</span> <span class="p">(</span> <span class="o">-</span><span class="mi">160</span><span class="p">,</span> <span class="mi">160</span> <span class="p">),</span> <span class="mi">300</span> <span class="p">)</span>
     <span class="k">end</span>
     <span class="k">if</span> <span class="n">MOAIInputMgr</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">mouseLeft</span><span class="p">:</span><span class="n">down</span> <span class="p">()</span> <span class="k">then</span>
       <span class="n">launchAllyRocket</span> <span class="p">(</span> <span class="n">layer</span><span class="p">:</span><span class="n">wndToWorld</span> <span class="p">(</span> <span class="n">MOAIInputMgr</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">pointer</span><span class="p">:</span><span class="n">getLoc</span> <span class="p">()</span> <span class="p">))</span>
     <span class="k">end</span>
   <span class="k">end</span>

   <span class="kd">local</span> <span class="n">font</span> <span class="o">=</span> <span class="n">MOAIFont</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
   <span class="n">font</span><span class="p">:</span><span class="n">loadFromTTF</span> <span class="p">(</span> <span class="s2">"arialbd.ttf"</span><span class="p">,</span> <span class="s2">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789,.?!"</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">163</span> <span class="p">)</span>

   <span class="kd">local</span> <span class="n">textbox</span> <span class="o">=</span> <span class="n">MOAITextBox</span><span class="p">.</span><span class="n">new</span> <span class="p">()</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setFont</span> <span class="p">(</span> <span class="n">font</span> <span class="p">)</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setTextSize</span> <span class="p">(</span> <span class="n">font</span><span class="p">:</span><span class="n">getScale</span> <span class="p">())</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setRect</span> <span class="p">(</span> <span class="o">-</span><span class="mi">160</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">80</span> <span class="p">)</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setAlignment</span> <span class="p">(</span> <span class="n">MOAITextBox</span><span class="p">.</span><span class="n">CENTER_JUSTIFY</span> <span class="p">)</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setYFlip</span> <span class="p">(</span> <span class="kc">true</span> <span class="p">)</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">setString</span> <span class="p">(</span> <span class="s2">"You are dead!"</span> <span class="p">)</span>
   <span class="n">layer</span><span class="p">:</span><span class="n">insertProp</span> <span class="p">(</span> <span class="n">textbox</span> <span class="p">)</span>
   <span class="n">textbox</span><span class="p">:</span><span class="n">spool</span> <span class="p">()</span>
 <span class="k">end</span>
<span class="p">)</span>
</code></pre></div>
        </div>
               
</div>
</div>


    <!-- SUB FOOTER-->
   <!-- <div class="subfooter">
      <div class="container">
        <div class="row">
          <div class="col-sm-4">
            <p class="text-center"><a href="http://getmoai.com/marketing/made-with-moai.html">License / Attribution</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/tools-partners.html">Useful Tools</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/partner-services.html">Partner Services</a></p>
          </div>
        </div>
      </div>
    </div>-->
    <!-- /SUB FOOTER-->
    <!-- FOOTER -->
    <footer>
      <div class="container">
       
        <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright &copy; David Pershouse 2024</p>
            </div>
        </div>
    </footer>

      </div>
    </footer>

      <script src="../../js/bootstrap.min.js"></script>
    
  </body>
</html>
