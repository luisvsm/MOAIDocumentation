<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Your First Cloud Game : Wolf Clicker</title>
 
    <!-- Bootstrap -->
    <link href="../../css/bootstrap.css" rel="stylesheet">
    
    
    
    
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="../../css/syntax.css" rel="stylesheet">
    <link href="../../css/styles.css" rel="stylesheet">
    <link href="../../css/doc-style.css" rel="stylesheet">
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    
    
  </head>
  <body>
  <nav class="navbar navbar-inverse navbar-static-top" role="navigation" >
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- You'll want to use a responsive image option so this logo looks good on devices - I recommend using something like retina.js (do a quick Google search for it and you'll find it) -->
            <a class="navbar-brand" href="../../index.html">MoaiForge - Community Docs</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">

           </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

    
    <div class="container">
<div class="row-fluid">
   
        <div id="navigation" class="col-md-3">
            
<ul id="nav-menu" class="nav nav-list">
    
    
  
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md does NOT contain pathseg /basics/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Moai Basics</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-two.html">Moai SDK Basics Part Two</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-one.html">Moai SDK Basics Part One</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md does NOT contain pathseg /sdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">The Moai SDK</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/what-is-moai-sdk.html">What is Moai SDK?</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-sdk-desktop-basics.html">Moai SDK Desktop Basics</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/the-moai-runtime.html">The Moai Runtime</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-hosts.html">Moai Hosts</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/structuring-your-moai-game-in-lua.html">Structuring Your Moai Game in Lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-project-setup.html">Moai Project Setup</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/extending-moai-sdk.html">Extending Moai SDK</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/protecting-your-lua-files.html">Protecting Your Lua Files</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/tools-that-work-with-moai.html">Tools that work with Moai</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md does NOT contain pathseg /buildsdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Build the SDK from Source</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/introduction.html">Introduction</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/installing-cmake.html">Installing CMake</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-libraries-for-android-ndk.html">Building Moai Libraries For Android</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-xcode.html">Building Moai From Source With Xcode</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-visual-studio.html">Building Moai From Source With Visual Studio</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-scons.html">Building Moai From Source With Scons</a></li>
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md does NOT contain pathseg /building/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Building Moai Games</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/setup-landscape-in-moai-games-for-ios-devices.html">Setup landscape in Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/cross-platform-development-with-moai.html">Cross Platform Development With Moai</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-ios-devices.html">Building Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-google-chrome.html">Building Moai Games for Google Chrome</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-android-devices.html">Building Moai Games For Android Devices</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md does NOT contain pathseg /reference/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Reference</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/moai-sdk-samples-guide.html">Moai SDK Samples Guide</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/cmake-basics.html">Crash Course on CMAKE</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/code-snips.html">Code snips</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/how-moai's-c-to-lua-binding-works.html">How Moai's C++ to Lua Binding Works</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="../reference/understanding-decks-and-props.html">Understanding Decks and Props</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/using-moaianim.html">Using MOAIAnim</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/wrapping-modes.html">Wrapping modes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/your-first-cloud-game-wolf-clicker.md contains pathseg /tutorial/ -->
        <li class="parent collapsibleListClosed">
        
          <div class="subtree-name">Tutorials</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="your-first-game-rocket-lobster.html">Your First Game : Rocket Lobster</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="using-particlehelper.html">Using ParticleHelper</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="textboxes.html">Textboxes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li class="active" ><a href="your-first-cloud-game-wolf-clicker.html">Your First Cloud Game : Wolf Clicker</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="setup-moai-sdk-on-windows-using-sublime2.html">Setup Moai SDK on Windows using Sublime2</a></li>
                
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="basic-prop-animations.html">Basic Prop Animations</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="bin2c-lua.html">Bin2c.lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="binding-c-apis-to-moai-using-moailuaobject.html">Binding C++ APIs to Moai using MOAILuaObject</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="build-on-steam-runtime.html">Building Moai with Steam Runtime</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="concatenate-your-lua-source-tree.html">Concatenate your Lua source tree</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="density-friction-and-restitution.html">Density, Friction And Restitution</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="getting-started-with-box2d.html">Getting Started With Box2D</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    

</ul>

<script src="../../js/collapsiblelists.min.js"> </script>
<script>
$(function() {
CollapsibleLists.applyTo(document.getElementById('nav-menu'));
});

</script>
        </div>

        <div id="content" class="col-md-9">
            <a href="https://github.com/moaiforge/moai-sdk/tree/gh-pages/_docs/tutorial/your-first-cloud-game-wolf-clicker.md" class="improve-docs btn"><i class="glyphicon glyphicon-edit">&nbsp;</i>Improve this doc</a>
            <h1>Your First Cloud Game : Wolf Clicker</h1>
            
            
            <p>This article will explain the basics of creating a simple app utilizing Moai Cloud as well as going over some techniques for Scene Management, Input, and Saving on various devices in a scalable way.</p>

<p>This tutorial assumes the reader has at intermediate understanding of Lua and programming.</p>

<p>This tutorial assumes you have read Moai SDK Basics Part One, Moai SDK Basics Part Two, Moai Cloud Basics Part One and Moai Cloud Basics Part Two.</p>

<hr>

<p>To start check out the WolfClicker sample in the SDK. To run the sample you need to pass &quot;platforms\platform-*.lua&quot; &quot;main.lua&quot;. Where * is either windows or osx. ( Note: adding other platforms is left as an exercise to the reader )</p>

<p>The basic idea is you can click the Wolf, but only every minute! The number of clicks is stored on the cloud, as well as the time until the user can click again. Clicking &quot;New Game&quot; will create a new user and on subsequent launches you will be allowed to continue.</p>

<h2>main.lua</h2>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="nb">require</span> <span class="s2">"elements"</span>
 <span class="nb">require</span> <span class="s2">"modules/cloud-manager"</span>  
 <span class="nb">require</span> <span class="s2">"modules/state-manager"</span>  
 <span class="nb">require</span> <span class="s2">"modules/input-manager"</span>  
 <span class="nb">require</span> <span class="s2">"modules/savefile-manager"</span>

 <span class="n">MOAISim</span><span class="p">.</span><span class="n">openWindow</span> <span class="p">(</span> <span class="s2">"Wolf Clicker"</span><span class="p">,</span> <span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span> <span class="p">)</span>

 <span class="n">viewport</span> <span class="o">=</span> <span class="n">MOAIViewport</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
 <span class="n">viewport</span><span class="p">:</span><span class="n">setSize</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SCREEN_WIDTH</span><span class="p">,</span> <span class="n">SCREEN_HEIGHT</span> <span class="p">)</span>
 <span class="n">viewport</span><span class="p">:</span><span class="n">setScale</span><span class="p">(</span> <span class="n">SCREEN_UNITS_X</span><span class="p">,</span> <span class="n">SCREEN_UNITS_Y</span> <span class="p">)</span>

 <span class="c1">-- seed random numbers</span>
 <span class="nb">math.randomseed</span><span class="p">(</span> <span class="nb">os.time</span> <span class="p">()</span> <span class="p">)</span>

 <span class="n">savefiles</span><span class="p">.</span><span class="n">get</span> <span class="s2">"user"</span> 
 <span class="n">globalData</span> <span class="o">=</span> <span class="p">{}</span>

 <span class="n">JUMP_TO</span> <span class="o">=</span> <span class="kc">nil</span>
 <span class="c1">----------------------------------------------------------------</span>
 <span class="k">if</span> <span class="n">JUMP_TO</span> <span class="k">then</span>
  <span class="n">statemgr</span><span class="p">.</span><span class="n">push</span><span class="p">(</span> <span class="n">JUMP_TO</span> <span class="p">)</span>
 <span class="c1">----------------------------------------------------------------</span>
 <span class="k">else</span>
  <span class="n">statemgr</span><span class="p">.</span><span class="n">push</span> <span class="s2">"states/state-splash.lua"</span>
 <span class="k">end</span>
 <span class="c1">----------------------------------------------------------------</span>

 <span class="c1">-- Start the game!</span>
 <span class="n">statemgr</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span>
</code></pre></div>
<p>The start adds in several modules that will be used ( More on each one later ) as well as defining the window. Besides the module calls ( savefiles and statemgr ) there isn&#39;t too much going on here. The key here is how &quot;platform-*.lua&quot; works here. By executing this file first, you can set device specific properties, such as the SCREEN_WIDTH and SCREEN_HEIGHT that are used later.</p>

<p>globalData in this file allows us to keep data between states.</p>

<h2>state-manager.lua</h2>

<p>Next up, lets take a look at &quot;state-manager.lua&quot;. I won&#39;t go over everything here, but the basic idea is to separate the game into various &#39;states&#39; (often called &#39;scenes&#39; as well). Each of these states are lua tables that have certain functions attached to them, which are called by the state manager at the appropriate time. These function are:</p>

<ul>
<li><p>onFocus, called whenever the state is moved to the top of the stack</p></li>
<li><p>onLoseFocus, called whenever the state is moved from the top of the stack</p></li>
<li><p>onInput, called when the state is at the top of the stack and input occurs</p></li>
<li><p>onLoad, called when the state is added to the stack</p></li>
<li><p>onUnload, called when the state is removed from the stack</p></li>
<li><p>onUpdate, called every frame while the state is on the top of the stack</p></li>
</ul>

<p>The basic use of the state manager is to call &quot;statemgr.push()&quot; ( As seen in main.lua ) to push a state file onto the stack, then &quot;statemgr.begin()&quot; to start running the state manager. From there, states can be managed with swap, push and pop. In Wolf Clicker these states are:</p>

<ul>
<li><p>Splash Screen</p></li>
<li><p>Main Menu</p></li>
<li><p>Game</p></li>
</ul>

<p>This is where most of the logic for the game is. The splash screen is very simple and gives you an idea of how a state can be made. From here we&#39;ll head to &quot;state-main-menu.lua&quot;</p>

<hr>

<p>We&#39;ll start in the OnLoad function since this is basically the first part of the state that is called. Here we make the simple title textbox and create the only button on the screen. You&#39;ll see a call to elements:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="n">playButton</span> <span class="o">=</span> <span class="n">elements</span><span class="p">.</span><span class="n">makeTextButton</span><span class="p">(</span> <span class="n">font</span><span class="p">,</span> <span class="s2">"resources/button.png"</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">60</span> <span class="p">)</span>

 <span class="n">playButton</span><span class="p">:</span><span class="n">setCallback</span><span class="p">(</span> <span class="k">function</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> 

  <span class="kd">local</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">MOAIThread</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
  <span class="n">thread</span><span class="p">:</span><span class="n">run</span><span class="p">(</span> <span class="n">mainMenu</span><span class="p">.</span><span class="n">StartGameCloud</span><span class="p">,</span> <span class="n">mainMenu</span><span class="p">.</span><span class="n">newGame</span> <span class="p">)</span>

<span class="k">end</span> <span class="p">)</span>
</code></pre></div>
<p>This is is a module ( &quot;elements.lua&quot; ) that is used to store the convenience functions.</p>

<p>&quot;elements.lua&quot; consists of two functions, a function to make a button and a function to make a button with text inside of it. This allows us to avoid rewriting common code for objects that appear multiple times.</p>

<h2>savefile-manager.lua</h2>

<p>Next up is the &quot;savefiles&quot; module &quot;savefile-manager.lua&quot;. This just contains some wrappers to make cross-platform save files easier to deal with. In this next section of code, it checks whether the user has a game already started</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="k">if</span> <span class="n">savefiles</span><span class="p">.</span><span class="n">get</span> <span class="s2">"user"</span> <span class="p">.</span><span class="n">fileexist</span> <span class="k">then</span> 
  <span class="n">playButton</span><span class="p">:</span><span class="n">setString</span> <span class="s2">"Continue"</span>
  <span class="n">playButton</span><span class="p">.</span><span class="n">newGame</span> <span class="o">=</span> <span class="kc">false</span>
 <span class="k">else</span>
  <span class="n">playButton</span><span class="p">:</span><span class="n">setString</span> <span class="s2">"New Game"</span>
  <span class="n">playButton</span><span class="p">.</span><span class="n">newGame</span> <span class="o">=</span> <span class="kc">true</span>
 <span class="k">end</span>
</code></pre></div>
<p>The main operation of &quot;savefiles&quot; is the &quot;get&quot; method which will allow us to get information about a file. &quot;fileexist&quot; tells us if the file was opened from disk. Other important properties are &quot;data&quot; which contains the data saved and &quot;saveGame&quot; which saves the data.</p>

<p>The &quot;onInput&quot; function is where input will take place. This one is fairly simple:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="n">mainMenu</span><span class="p">.</span><span class="n">onInput</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">inputmgr</span><span class="p">:</span><span class="n">up</span><span class="p">()</span> <span class="k">then</span>

    <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mainLayer</span><span class="p">:</span><span class="n">wndToWorld</span><span class="p">(</span> <span class="n">inputmgr</span><span class="p">:</span><span class="n">getTouch</span> <span class="p">()</span> <span class="p">)</span>

    <span class="n">playButton</span><span class="p">:</span><span class="n">updateClick</span><span class="p">(</span> <span class="kc">false</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>

  <span class="k">elseif</span> <span class="n">inputmgr</span><span class="p">:</span><span class="n">down</span><span class="p">()</span> <span class="k">then</span>

    <span class="kd">local</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mainLayer</span><span class="p">:</span><span class="n">wndToWorld</span><span class="p">(</span> <span class="n">inputmgr</span><span class="p">:</span><span class="n">getTouch</span> <span class="p">()</span> <span class="p">)</span>

    <span class="n">playButton</span><span class="p">:</span><span class="n">updateClick</span><span class="p">(</span> <span class="kc">true</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">)</span>
  <span class="k">end</span>

 <span class="k">end</span>
</code></pre></div>
<p>You&#39;ll notice it simply passes the input to the button, which handles the input, and calls the callback.</p>

<h2>state-game.lua</h2>

<p>We&#39;ll head over to &quot;state-game.lua&quot; now. You&#39;ll notice its very similar to &quot;state-main-menu.lua&quot;, the only major difference being the update function, which sets the time to the next click and the number of clicks. This is the &#39;game&#39; logic.</p>

<p>The next thing is the cloud interaction. From a higher level, the cloud is the only one that can determine if it is time to click. If we store this data on the client-side people could cheat by modifying it.</p>

<p>However, we need to know this information on the client-side and it would be wasteful to ask the cloud every second how much time is left. So, we keep track of this information on the client side, but never save the actual number of clicks.</p>

<p>If we go back to &quot;state-main-menu.lua&quot; there is a function called &quot;StartGameCloud&quot; at the top. This function uses the cloud module &quot;cloud-manager.lua&quot;. This file is mostly helper functions to assist with easily creating and debugging more complex cloud applications. There are a couple functions to help encode data into URLs at the top. Below are the key functions &quot;CreateGetTask&quot; and &quot;CreatePostTask&quot;. You can see their usage back in &quot;state-main-menu.lua&quot;:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="c1">--create a new user on the cloud if its a new game</span>
 <span class="k">if</span> <span class="n">isNewGame</span> <span class="k">then</span>
  <span class="n">task</span> <span class="o">=</span> <span class="n">cloud</span><span class="p">.</span><span class="n">createPostTask</span><span class="p">(</span> <span class="s2">"users"</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Adam"</span><span class="p">}</span> <span class="p">)</span>
  <span class="n">result</span><span class="p">,</span><span class="n">code</span> <span class="o">=</span> <span class="n">task</span><span class="p">:</span><span class="n">waitFinish</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">result</span> <span class="k">then</span>
    <span class="n">saveFile</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">result</span>
    <span class="n">saveFile</span><span class="p">:</span><span class="n">saveGame</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">"failed to create user, code "</span> <span class="o">..</span> <span class="n">code</span> <span class="p">)</span>
  <span class="k">end</span>   
 <span class="k">end</span>
</code></pre></div>
<p>The important thing to note is that this is create in a MOAIThread:</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"> <span class="kd">local</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">MOAIThread</span><span class="p">.</span><span class="n">new</span><span class="p">()</span>
 <span class="n">thread</span><span class="p">:</span><span class="n">run</span><span class="p">(</span> <span class="n">mainMenu</span><span class="p">.</span><span class="n">StartGameCloud</span><span class="p">,</span> <span class="n">mainMenu</span><span class="p">.</span><span class="n">newGame</span> <span class="p">)</span>
</code></pre></div>
<p>Why did I choose to do it this way? When using some APIs somtimes calls need to be chained together, one after another. Once you start having 5+ calls chained together, it can be difficult to visualize and debug them. If you look at &quot;StartGameCloud&quot; its easy to follow the logic flow.</p>

<p>Going over to &quot;state-game.lua&quot; you&#39;ll see a similar function at the top called &quot;ClickCloud&quot;. This handles the callbacks for the game, similar to the way the menu works.</p>

<h2>Server side logic</h2>

<p>Now we&#39;ll head over to the server side logic. It can be found in the _cloud directory &quot;main.lua&quot;</p>

<p>(UNDER CONSTRUCTION)</p>

        </div>
               
</div>
</div>


    <!-- SUB FOOTER-->
   <!-- <div class="subfooter">
      <div class="container">
        <div class="row">
          <div class="col-sm-4">
            <p class="text-center"><a href="http://getmoai.com/marketing/made-with-moai.html">License / Attribution</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/tools-partners.html">Useful Tools</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/partner-services.html">Partner Services</a></p>
          </div>
        </div>
      </div>
    </div>-->
    <!-- /SUB FOOTER-->
    <!-- FOOTER -->
    <footer>
      <div class="container">
       
        <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright &copy; David Pershouse 2024</p>
            </div>
        </div>
    </footer>

      </div>
    </footer>

      <script src="../../js/bootstrap.min.js"></script>
    
  </body>
</html>
