<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Concatenate your Lua source tree</title>
 
    <!-- Bootstrap -->
    <link href="../../css/bootstrap.css" rel="stylesheet">
    
    
    
    
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="../../css/syntax.css" rel="stylesheet">
    <link href="../../css/styles.css" rel="stylesheet">
    <link href="../../css/doc-style.css" rel="stylesheet">
    
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    
    
  </head>
  <body>
  <nav class="navbar navbar-inverse navbar-static-top" role="navigation" >
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!-- You'll want to use a responsive image option so this logo looks good on devices - I recommend using something like retina.js (do a quick Google search for it and you'll find it) -->
            <a class="navbar-brand" href="../../index.html">MoaiForge - Community Docs</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">

           </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

    
    <div class="container">
<div class="row-fluid">
   
        <div id="navigation" class="col-md-3">
            
<ul id="nav-menu" class="nav nav-list">
    
    
  
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md does NOT contain pathseg /basics/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Moai Basics</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-two.html">Moai SDK Basics Part Two</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../basics/moai-sdk-basics-part-one.html">Moai SDK Basics Part One</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md does NOT contain pathseg /sdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">The Moai SDK</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/what-is-moai-sdk.html">What is Moai SDK?</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-sdk-desktop-basics.html">Moai SDK Desktop Basics</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/the-moai-runtime.html">The Moai Runtime</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-hosts.html">Moai Hosts</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/structuring-your-moai-game-in-lua.html">Structuring Your Moai Game in Lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/moai-project-setup.html">Moai Project Setup</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/extending-moai-sdk.html">Extending Moai SDK</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/protecting-your-lua-files.html">Protecting Your Lua Files</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../sdk/tools-that-work-with-moai.html">Tools that work with Moai</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md does NOT contain pathseg /buildsdk/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Build the SDK from Source</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/introduction.html">Introduction</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/installing-cmake.html">Installing CMake</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-libraries-for-android-ndk.html">Building Moai Libraries For Android</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-xcode.html">Building Moai From Source With Xcode</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-visual-studio.html">Building Moai From Source With Visual Studio</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../buildsdk/building-moai-from-source-with-scons.html">Building Moai From Source With Scons</a></li>
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md does NOT contain pathseg /building/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Building Moai Games</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/setup-landscape-in-moai-games-for-ios-devices.html">Setup landscape in Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/cross-platform-development-with-moai.html">Cross Platform Development With Moai</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-ios-devices.html">Building Moai Games For iOS Devices</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-google-chrome.html">Building Moai Games for Google Chrome</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../building/building-moai-games-for-android-devices.html">Building Moai Games For Android Devices</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md does NOT contain pathseg /reference/ -->
        <li class="parent collapsibleListOpen"> 
        
          <div class="subtree-name">Reference</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/moai-sdk-samples-guide.html">Moai SDK Samples Guide</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/cmake-basics.html">Crash Course on CMAKE</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/code-snips.html">Code snips</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/how-moai's-c-to-lua-binding-works.html">How Moai's C++ to Lua Binding Works</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="../reference/understanding-decks-and-props.html">Understanding Decks and Props</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/using-moaianim.html">Using MOAIAnim</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="../reference/wrapping-modes.html">Wrapping modes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    
        
        
        
        
        
        
        
        
        <!-- DEBUG page relative path _docs/tutorial/concatenate-your-lua-source-tree.md contains pathseg /tutorial/ -->
        <li class="parent collapsibleListClosed">
        
          <div class="subtree-name">Tutorials</div>
        
        
        <ul class="nav nav-list">
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="your-first-game-rocket-lobster.html">Your First Game : Rocket Lobster</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="using-particlehelper.html">Using ParticleHelper</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="textboxes.html">Textboxes</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="your-first-cloud-game-wolf-clicker.html">Your First Cloud Game : Wolf Clicker</a></li>
                
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
                  <li  ><a href="setup-moai-sdk-on-windows-using-sublime2.html">Setup Moai SDK on Windows using Sublime2</a></li>
                
            
        
             
             
            
        
             
             
            
            
                
                  <li  ><a href="basic-prop-animations.html">Basic Prop Animations</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="bin2c-lua.html">Bin2c.lua</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="binding-c-apis-to-moai-using-moailuaobject.html">Binding C++ APIs to Moai using MOAILuaObject</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="build-on-steam-runtime.html">Building Moai with Steam Runtime</a></li>
                
            
        
             
             
            
            
                
                  <li class="active" ><a href="concatenate-your-lua-source-tree.html">Concatenate your Lua source tree</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="density-friction-and-restitution.html">Density, Friction And Restitution</a></li>
                
            
        
             
             
            
            
                
                  <li  ><a href="getting-started-with-box2d.html">Getting Started With Box2D</a></li>
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
             
             
            
            
                
            
        
        </ul>
      </li>
    

</ul>

<script src="../../js/collapsiblelists.min.js"> </script>
<script>
$(function() {
CollapsibleLists.applyTo(document.getElementById('nav-menu'));
});

</script>
        </div>

        <div id="content" class="col-md-9">
            <a href="https://github.com/moaiforge/moai-sdk/tree/gh-pages/_docs/tutorial/concatenate-your-lua-source-tree.md" class="improve-docs btn"><i class="glyphicon glyphicon-edit">&nbsp;</i>Improve this doc</a>
            <h1>Concatenate your Lua source tree</h1>
            
            
            <p>The following code packs your source tree into one single file, and prints it to stdout. Each file is actually wrapped in a function, and is only executed on <code>require()</code> or <code>dofile()</code>. <code>loadfile()</code> just returns the wrapper.</p>

<p>If present in the root directory, <code>main.lua</code> will be run when the aggregate file is loaded. If not, the packer assumes that you&#39;re packing libraries and doesn&#39;t run anything.</p>

<p><code>require()</code> works as expected, provided you use the dot notation for submodules <code>require&quot;module.submodule&quot;</code>.</p>

<p><code>dofile()</code> and <code>loadfile()</code> behave as if the current directory was the root of your source tree, and don&#39;t support <code>.</code> and <code>..</code> in paths.</p>

<h2>Usage</h2>
<div class="highlight"><pre><code class="language-" data-lang="">$ lua pack.lua path/to/your/source/tree &gt; out.lua
</code></pre></div>
<h2>Notes</h2>

<ul>
<li>  This script requires the <code>lfs</code> library, which can optionally be loaded with luarocks.</li>
<li>  For require to work, you must use the dot <code>&quot;.&quot;</code> as a submodule separator.

<ul>
<li>  good: <code>require &quot;module.submodule&quot;</code></li>
<li>  bad: <code>require &quot;module/submodule&quot;</code></li>
</ul></li>
<li>  Only <code>.lua</code> files are included.</li>
<li>  &quot;<code>require &quot;mod.submod&quot;</code>&quot; will look for &quot;<code>module/submodule.lua</code>&quot; then for &quot;<code>module/submodule/init.lua</code>&quot;. If you want to get that functionality without the packer, you must add your game root directory in the package.path as follows, for example at the top of main.lua or in a config.lua file loaded before main.lua:</li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang=""> package.path = "./?.lua;./?/init.lua" .. package.path:sub(8,-1)
</code></pre></div>
<p>:   This allows you to put Lua libraries that use &quot;<code>init.lua</code>&quot; as loader in your game tree. Packages in your local tree will shadow the ones installed system-wide (if any).</p>

<h2>Example</h2>

<p>Suppose that you have the following source tree:</p>
<div class="highlight"><pre><code class="language-" data-lang="">foo
 +-- bar.lua
 |     content: print "Bar"
 +-- baz
 |     +-- baz.lua
 |     |     content: print "Baz"
 |     +-- qux
 |          +-- init.lua
 |                content: print( ... )
 |                         return "Quux"   
 +-- main.lua
       content: require "bar" 
                dofile "baz/baz.lua"
                print( require "baz.qux" )
</code></pre></div>
<p>You use</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ lua pack.lua foo &gt; foo.lua
</code></pre></div>
<p>and get the following:</p>

<h3>Result</h3>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- foo.lua</span>
<span class="c1">--------------------------------------</span>
<span class="nb">package.preload</span><span class="p">[</span><span class="s1">'baz.qux'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="o">...</span> <span class="p">)</span>
<span class="k">return</span> <span class="s2">"Quux"</span>
<span class="k">end</span>

<span class="c1">--------------------------------------</span>
<span class="nb">package.preload</span><span class="p">[</span><span class="s1">'main'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">require</span> <span class="s2">"bar"</span> 
<span class="nb">dofile</span> <span class="s2">"baz/baz.lua"</span>
<span class="nb">print</span><span class="p">(</span> <span class="nb">require</span> <span class="s2">"baz.qux"</span> <span class="p">)</span>
<span class="k">end</span>

<span class="c1">--------------------------------------</span>
<span class="nb">package.preload</span><span class="p">[</span><span class="s1">'baz.baz'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="s2">"Baz"</span>
<span class="k">end</span>

<span class="c1">--------------------------------------</span>
<span class="nb">package.preload</span><span class="p">[</span><span class="s1">'bar'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nb">print</span><span class="s2">"Bar"</span>
<span class="k">end</span>
<span class="c1">-----------------------------------------------</span>

<span class="k">do</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">package</span><span class="p">.</span><span class="n">__loadfile</span> <span class="k">then</span>
    <span class="kd">local</span> <span class="n">original_loadfile</span> <span class="o">=</span> <span class="nb">loadfile</span>
    <span class="kd">local</span> <span class="k">function</span> <span class="nf">lf</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span>
      <span class="kd">local</span> <span class="n">hndl</span> <span class="o">=</span> <span class="n">file</span><span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"%.lua$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
                       <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"/"</span><span class="p">,</span> <span class="sr">"."</span> <span class="p">)</span>
                       <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"</span><span class="se">\\</span><span class="sr">"</span><span class="p">,</span> <span class="sr">"."</span> <span class="p">)</span>
                       <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"%.init$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
      <span class="k">return</span> <span class="nb">package.preload</span><span class="p">[</span><span class="n">hndl</span><span class="p">]</span> <span class="ow">or</span> <span class="n">original_loadfile</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
    <span class="k">end</span>

    <span class="k">function</span> <span class="nf">dofile</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">lf</span><span class="p">(</span> <span class="n">name</span> <span class="p">)()</span>
    <span class="k">end</span>

    <span class="nb">loadfile</span><span class="p">,</span> <span class="n">package</span><span class="p">.</span><span class="n">__loadfile</span> <span class="o">=</span> <span class="n">lf</span><span class="p">,</span> <span class="nb">loadfile</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">dofile</span><span class="s2">"main.lua"</span>
</code></pre></div>
<p>When run, <strong><code>moai foo.lua</code></strong> gives</p>
<div class="highlight"><pre><code class="language-" data-lang="">Bar 
Baz  
baz.qux
Quux
</code></pre></div>
<h2>The code</h2>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- pack.lua</span>
<span class="c1">-- released under the Romantic WTF Public License</span>
<span class="c1">-- http://getmoai.com/wiki/index.php?title=User:Pygy/Romantic_WTF_Public_License</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="c1">--require"luarocks.loader"</span>
<span class="n">fs</span> <span class="o">=</span> <span class="nb">require</span><span class="s2">"lfs"</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"/$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
              <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"</span><span class="se">\\</span><span class="sr">$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>

<span class="k">function</span> <span class="nf">scandir</span> <span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="c1">-- adapted from http://keplerproject.github.com/luafilesystem/examples.html</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="s2">""</span>
    <span class="k">for</span> <span class="n">file</span> <span class="k">in</span> <span class="n">fs</span><span class="p">.</span><span class="n">dir</span><span class="p">(</span> <span class="n">root</span><span class="o">..</span><span class="n">path</span> <span class="p">)</span> <span class="k">do</span>
        <span class="k">if</span> <span class="n">file</span> <span class="o">~=</span> <span class="s2">"."</span> <span class="ow">and</span> <span class="n">file</span> <span class="o">~=</span> <span class="s2">".."</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">f</span> <span class="o">=</span> <span class="n">path</span><span class="o">..</span><span class="s1">'/'</span><span class="o">..</span><span class="n">file</span>
            <span class="kd">local</span> <span class="n">attr</span> <span class="o">=</span> <span class="n">lfs</span><span class="p">.</span><span class="n">attributes</span><span class="p">(</span> <span class="n">root</span><span class="o">..</span><span class="n">f</span> <span class="p">)</span>
            <span class="nb">assert</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">attr</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">"table"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span><span class="p">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"directory"</span> <span class="k">then</span>
                <span class="n">scandir</span><span class="p">(</span> <span class="n">root</span><span class="p">,</span> <span class="n">f</span> <span class="p">)</span>
            <span class="k">else</span>
              <span class="k">if</span> <span class="n">file</span><span class="p">:</span><span class="n">find</span><span class="s2">"%.lua$"</span> <span class="k">then</span>
                <span class="n">hndl</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"%.lua$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
                                 <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"/"</span><span class="p">,</span> <span class="sr">"."</span> <span class="p">)</span>
                                 <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"</span><span class="se">\\</span><span class="sr">"</span><span class="p">,</span> <span class="sr">"."</span> <span class="p">)</span>
                                 <span class="p">:</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"^%."</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
                               <span class="p">):</span><span class="nb">gsub</span><span class="p">(</span> <span class="sr">"%.init$"</span><span class="p">,</span> <span class="sr">""</span> <span class="p">)</span>
                <span class="n">files</span><span class="p">[</span><span class="n">hndl</span><span class="p">]</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span> <span class="n">root</span><span class="o">..</span><span class="n">f</span> <span class="p">):</span><span class="n">read</span><span class="s2">"*a"</span>
              <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">scandir</span><span class="p">(</span> <span class="n">root</span> <span class="p">)</span>

<span class="n">acc</span><span class="o">=</span><span class="p">{}</span>

<span class="kd">local</span> <span class="n">wrapper</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">--------------------------------------\npackage.preload['"</span>
                <span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s2">"'] = function (...)\n"</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">end\n"</span> <span class="p">}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span> <span class="n">files</span> <span class="p">)</span> <span class="k">do</span>
  <span class="n">wrapper</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">wrapper</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
  <span class="nb">table.insert</span><span class="p">(</span> <span class="n">acc</span><span class="p">,</span> <span class="nb">table.concat</span><span class="p">(</span><span class="n">wrapper</span><span class="p">)</span> <span class="p">)</span>
<span class="k">end</span>

<span class="nb">table.insert</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="s">[[
-----------------------------------------------

do
  if not package.__loadfile then
    local original_loadfile = loadfile
    local function lf (file)
      local hndl = file:gsub( "%.lua$", "" )
                       :gsub( "/", "." )
                       :gsub( "\\", "." )
                       :gsub( "%.init$", "" )
      return package.preload[hndl] or original_loadfile( name )
    end

    function dofile (name)
      return lf( name )()
    end

    loadfile, package.__loadfile = lf, loadfile
  end
end
]]</span><span class="p">)</span>
<span class="k">if</span> <span class="n">files</span><span class="p">.</span><span class="n">main</span> <span class="k">then</span> <span class="nb">table.insert</span><span class="p">(</span> <span class="n">acc</span><span class="p">,</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">dofile"main.lua"'</span> <span class="p">)</span> <span class="k">end</span>
<span class="nb">print</span><span class="p">(</span> <span class="nb">table.concat</span><span class="p">(</span> <span class="n">acc</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div>
        </div>
               
</div>
</div>


    <!-- SUB FOOTER-->
   <!-- <div class="subfooter">
      <div class="container">
        <div class="row">
          <div class="col-sm-4">
            <p class="text-center"><a href="http://getmoai.com/marketing/made-with-moai.html">License / Attribution</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/tools-partners.html">Useful Tools</a></p>
          </div>
          <div class="col-sm-4">
            <p class="text-center"><a class="text-center" href="http://getmoai.com/partner-services.html">Partner Services</a></p>
          </div>
        </div>
      </div>
    </div>-->
    <!-- /SUB FOOTER-->
    <!-- FOOTER -->
    <footer>
      <div class="container">
       
        <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright &copy; David Pershouse 2024</p>
            </div>
        </div>
    </footer>

      </div>
    </footer>

      <script src="../../js/bootstrap.min.js"></script>
    
  </body>
</html>
